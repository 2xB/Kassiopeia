<!DOCTYPE html>




<html lang="en">
  <head>
    <meta charset="utf-8" />
    
    <title>Configuring Your Own Simulation &mdash; Kassiopeia 3.3 documentation</title>
    <meta name="description" content="">
    <meta name="author" content="">

    

<link rel="stylesheet" href="_static/css/basicstrap-base.css" type="text/css" />
<link rel="stylesheet" id="current-theme" href="_static/css/bootstrap3/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" id="current-adjust-theme" type="text/css" />

<link rel="stylesheet" href="_static/css/font-awesome.min.css">

<style type="text/css">
  body {
    padding-top: 60px;
    padding-bottom: 40px;
  }
</style>

<link rel="stylesheet" href="_static/css/basicstrap.css" type="text/css" />
<link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    './',
            VERSION:     '3.3',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
  };
</script>
    <script type="text/javascript" src="_static/js/jquery.min.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/bootstrap3.min.js"></script>
<script type="text/javascript" src="_static/js/jquery.cookie.min.js"></script>
<script type="text/javascript" src="_static/js/basicstrap.js"></script>
<script type="text/javascript">
</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="top" title="Kassiopeia 3.3 documentation" href="index.html" />
    <link rel="next" title="Basic Shapes in KGeoBag" href="kgeobag_basic.html" />
    <link rel="prev" title="Examples and Tests" href="examples.html" /> 
  </head>
  <body role="document">
    <div id="navbar-top" class="navbar navbar-fixed-top navbar-default" role="navigation" aria-label="top navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html">Kassiopeia 3.3 documentation</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
              <li class="dropdown visible-xs">
                <a role="button" id="localToc" data-toggle="dropdown" data-target="#" href="#">Table Of Contents <b class="caret"></b></a>
                <ul class="dropdown-menu localtoc sp-localtoc" role="menu" aria-labelledby="localToc">
                <ul>
<li><a class="reference internal" href="#">Configuring Your Own Simulation</a><ul>
<li><a class="reference internal" href="#overview-and-units">Overview and Units</a></li>
<li><a class="reference internal" href="#xml-parsing-and-features">XML Parsing and Features</a><ul>
<li><a class="reference internal" href="#variables">Variables</a></li>
<li><a class="reference internal" href="#including-external-files">Including external files</a></li>
<li><a class="reference internal" href="#expressions">Expressions</a></li>
<li><a class="reference internal" href="#conditional-expressions-and-looping">Conditional Expressions and Looping</a></li>
</ul>
</li>
<li><a class="reference internal" href="#messaging">Messaging</a></li>
<li><a class="reference internal" href="#geometry">Geometry</a><ul>
<li><a class="reference internal" href="#shapes-and-placement">Shapes and Placement</a></li>
<li><a class="reference internal" href="#extensions">Extensions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kassiopeia">Kassiopeia</a></li>
<li><a class="reference internal" href="#fields">Fields</a><ul>
<li><a class="reference internal" href="#electric">Electric</a></li>
<li><a class="reference internal" href="#magnetic">Magnetic</a></li>
</ul>
</li>
<li><a class="reference internal" href="#generation">Generation</a></li>
<li><a class="reference internal" href="#termination">Termination</a></li>
<li><a class="reference internal" href="#interactions">Interactions</a><ul>
<li><a class="reference internal" href="#volume-interactions">Volume Interactions</a></li>
<li><a class="reference internal" href="#surface-interactions">Surface Interactions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#output">Output</a><ul>
<li><a class="reference internal" href="#writers">Writers</a></li>
<li><a class="reference internal" href="#output-description">Output description</a></li>
</ul>
</li>
<li><a class="reference internal" href="#propagation">Propagation</a></li>
<li><a class="reference internal" href="#navigation">Navigation</a></li>
<li><a class="reference internal" href="#navigation-and-commands">Navigation and Commands</a></li>
<li><a class="reference internal" href="#simulation">Simulation</a></li>
<li><a class="reference internal" href="#visualization">Visualization</a></li>
<li><a class="reference internal" href="#common-pitfalls-and-problems">Common Pitfalls and Problems</a></li>
</ul>
</li>
</ul>

                </ul>
              </li>

            
              <li><a href="examples.html" title="Examples and Tests" accesskey="P">previous </a></li>
              <li><a href="kgeobag_basic.html" title="Basic Shapes in KGeoBag" accesskey="N">next </a></li>
              <li><a href="genindex.html" title="General Index" accesskey="I">index </a></li>
            
            <li class="visible-xs"><a href="_sources/configuration.txt" rel="nofollow">Show Source</a></li>

            <li class="visible-xs">
                <form class="search form-search form-inline navbar-form navbar-right sp-searchbox" action="search.html" method="get">
                  <div class="input-append input-group">
                    <input type="text" class="search-query form-control" name="q" placeholder="Search...">
                    <span class="input-group-btn">
                    <input type="submit" class="btn" value="Go" />
                    </span>
                  </div>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </li>

            

          </ul>

        </div>
      </div>
    </div>
    

    <!-- container -->
    <div class="container-fluid">

      <!-- row -->
      <div class="row">
         
<div class="col-md-3 hidden-xs" id="sidebar-wrapper">
  <div class="sidebar hidden-xs" role="navigation" aria-label="main navigation">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Configuring Your Own Simulation</a><ul>
<li><a class="reference internal" href="#overview-and-units">Overview and Units</a></li>
<li><a class="reference internal" href="#xml-parsing-and-features">XML Parsing and Features</a><ul>
<li><a class="reference internal" href="#variables">Variables</a></li>
<li><a class="reference internal" href="#including-external-files">Including external files</a></li>
<li><a class="reference internal" href="#expressions">Expressions</a></li>
<li><a class="reference internal" href="#conditional-expressions-and-looping">Conditional Expressions and Looping</a></li>
</ul>
</li>
<li><a class="reference internal" href="#messaging">Messaging</a></li>
<li><a class="reference internal" href="#geometry">Geometry</a><ul>
<li><a class="reference internal" href="#shapes-and-placement">Shapes and Placement</a></li>
<li><a class="reference internal" href="#extensions">Extensions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kassiopeia">Kassiopeia</a></li>
<li><a class="reference internal" href="#fields">Fields</a><ul>
<li><a class="reference internal" href="#electric">Electric</a></li>
<li><a class="reference internal" href="#magnetic">Magnetic</a></li>
</ul>
</li>
<li><a class="reference internal" href="#generation">Generation</a></li>
<li><a class="reference internal" href="#termination">Termination</a></li>
<li><a class="reference internal" href="#interactions">Interactions</a><ul>
<li><a class="reference internal" href="#volume-interactions">Volume Interactions</a></li>
<li><a class="reference internal" href="#surface-interactions">Surface Interactions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#output">Output</a><ul>
<li><a class="reference internal" href="#writers">Writers</a></li>
<li><a class="reference internal" href="#output-description">Output description</a></li>
</ul>
</li>
<li><a class="reference internal" href="#propagation">Propagation</a></li>
<li><a class="reference internal" href="#navigation">Navigation</a></li>
<li><a class="reference internal" href="#navigation-and-commands">Navigation and Commands</a></li>
<li><a class="reference internal" href="#simulation">Simulation</a></li>
<li><a class="reference internal" href="#visualization">Visualization</a></li>
<li><a class="reference internal" href="#common-pitfalls-and-problems">Common Pitfalls and Problems</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="examples.html"
                        title="previous chapter">Examples and Tests</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="kgeobag_basic.html"
                        title="next chapter">Basic Shapes in KGeoBag</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/configuration.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" role="search">
  <h3>Quick search</h3>
  <form class="search form-inline" action="search.html" method="get">
      <div class="input-append input-group">
        <input type="text" class="search-query form-control" name="q" placeholder="Search...">
        <span class="input-group-btn">
        <input type="submit" class="btn" value="Go" />
        </span>
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div> 
        

        <div class="col-md-9" id="content-wrapper">
          <div class="document" role="main">
            <div class="documentwrapper">
              <div class="bodywrapper">
                <div class="body">
                  
  <div class="section" id="configuring-your-own-simulation">
<h1>Configuring Your Own Simulation<a class="headerlink" href="#configuring-your-own-simulation" title="Permalink to this headline">¶</a></h1>
<p>This section gives a brief overview of what you need to know to configure your own <em>Kassiopeia</em>
simulation.</p>
<div class="section" id="overview-and-units">
<h2>Overview and Units<a class="headerlink" href="#overview-and-units" title="Permalink to this headline">¶</a></h2>
<p>The configuration of <em>Kassiopeia</em> is done in three main sections, plus an optional
fourth. These are the <code class="docutils literal"><span class="pre">&lt;messages&gt;</span></code> section which describes global message verbosity, the <code class="docutils literal"><span class="pre">&lt;geometry&gt;</span></code> section
which describes the system geometry and its extensions, and the <code class="docutils literal"><span class="pre">&lt;kassiopeia&gt;</span></code> section which
contains the elements needed for the particle tracking simulation. The optional fourth section
relates to the specification of a VTK or ROOT window for the visualization of aspects of a completed simulation.
A complete simulation file can thus be broken down into something which looks like the following:</p>
<div class="highlight-default"><div class="highlight"><pre>&lt;messages&gt;
    &lt;!-- specification of the messaging configuration here --&gt;
&lt;/messages&gt;

&lt;geometry&gt;
    &lt;!-- specification of the geometry and geometry extensions here --&gt;
&lt;/geometry&gt;

&lt;kassiopeia&gt;
    &lt;!-- specification of the simulation elements and parameters here --&gt;
&lt;/kassiopeia&gt;

&lt;!-- optional VTK window (requires VTK) --&gt;
&lt;vtk_window&gt;
    &lt;!-- specification of the VTK window display here --&gt;
&lt;/vtk_window&gt;

&lt;!-- optional ROOT window (requires ROOT) --&gt;
&lt;root_window&gt;
    &lt;!-- specification of a ROOT display window here
&lt;/root_window&gt;
</pre></div>
</div>
<p>The XML based interface of <em>Kassiopeia</em> allows for a very flexible way in which to modify and configure
particle tracking simulations. Throughout the geometry, field, and simulation configuration
all physical quantities are specified
using MKS and their derived units. The exception to this rule is energy, which is specified
using electron volts (eV). It should be noted that XML elements are parsed in order, and elements
which are referenced by other elements must be declared before their first use.</p>
</div>
<div class="section" id="xml-parsing-and-features">
<h2>XML Parsing and Features<a class="headerlink" href="#xml-parsing-and-features" title="Permalink to this headline">¶</a></h2>
<p>The document language used for describing a Kassiopeia simulation configuration is based on standard
XML, but has been augmented with several additional features to aid in complicated or repetitive tasks.
For a full description of this language and its features, see [1].</p>
<div class="section" id="variables">
<h3>Variables<a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h3>
<p>A local variable may be defined with a particular value
(integer,floating point type, string, etc.) with the following syntax:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">define</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;my_variable&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;1.3e-5&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>and may be reference by any other subsequent (using a local variable before it
is defined is not allowed) element in the document through
the use of the square brackets <code class="docutils literal"><span class="pre">[]</span></code> in the following manner:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">some_element</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;my_element&quot;</span> <span class="n">some_property</span><span class="o">=</span><span class="s">&quot;[my_variable]&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>Global variables which persist across any subsequently included files may be specified through:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">global_define</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;my_global_variable&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;an_important_value&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>Both local and global variables my be undefined (removed from the parser&#8217;s scope)
in the following manner:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">undefine</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;my_variable&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">global_undefine</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;my_global_variable&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>Occasionally the user may wish to specify a variable which can be modified from the command
line as an argument passed to <em>Kassiopeia</em>. To do this for a variable called <code class="docutils literal"><span class="pre">my_random_seed</span></code>
the syntax is:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">external_define</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;my_random_seed&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;123&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>This is useful for running large batches of similar simulations. For example, to simulate many
independent tracks the user might want to run the same simulation repeatedly, but use a different
random seed when starting the simulation. The value of <code class="docutils literal"><span class="pre">my_random_seed</span></code> can be changed
from its default value of 123 from the command line call to <em>Kassiopeia</em> in the following manner:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">Kassiopeia</span> <span class="o">./</span><span class="n">my_simulation</span><span class="o">.</span><span class="n">xml</span> <span class="o">-</span><span class="n">r</span> <span class="n">my_random_seed</span><span class="o">=</span><span class="mi">456</span>
</pre></div>
</div>
</div>
<div class="section" id="including-external-files">
<h3>Including external files<a class="headerlink" href="#including-external-files" title="Permalink to this headline">¶</a></h3>
<p>Including external XML files is also supported through a relatively simple syntax.
This is helpful when a simulation is too complex to be managed by a single file.
A separate XML file can be included using the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">include</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;/path/to/file/my_file.xml&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>This include expression may also be readily reconfigured through the use of a variable,
for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">external_define</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;my_file_name&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;my_file.xml&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">include</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;/path/to/file/[my_file_name]&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>could be modified to include an entirely different file by passing another file name
argument to <em>Kassiopeia</em> using:</p>
<blockquote>
<div>Kassiopeia ./my_simulation.xml -r my_file_name=my_other_file.xml</div></blockquote>
<p>This feature is particularly useful and enables the user to swap in an
entirely different configuration for some portion of the simulation
by passing a single command line variable.</p>
</div>
<div class="section" id="expressions">
<h3>Expressions<a class="headerlink" href="#expressions" title="Permalink to this headline">¶</a></h3>
<p>The ability to calculate in-line formulas is another useful feature. However, is only available when
<em>Kassiopeia</em> is linked against ROOT. Currently, the underlying implementation of the formula
processor relys on ROOT&#8217;s <a class="reference external" href="https://root.cern.ch/doc/master/classTFormula.html">TFormula</a> class, and as such can process any expression which is valid
syntax for a TFormula. In order to active the formula mode, the relevant expression must
be enclosed in curly braces <code class="docutils literal"><span class="pre">{}</span></code>. Variables may also be used within a formula.
An example of the formula syntax is given in
the following variable definition:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">define</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;my_variable&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;4.0&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">define</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;length&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;{2.3 + 2.0/sqrt([my_variable])}&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>This example results in the variable <code class="docutils literal"><span class="pre">[length]</span></code> taking the value of 3.3.</p>
</div>
<div class="section" id="conditional-expressions-and-looping">
<h3>Conditional Expressions and Looping<a class="headerlink" href="#conditional-expressions-and-looping" title="Permalink to this headline">¶</a></h3>
<p>In addition to mathematical expressions simple boolean conditions can be specified.
These are often helpful for swapping or toggling on/off different features. An
example showing the inclusion/exclusion of a brief section of XML is shown below:</p>
<div class="highlight-default"><div class="highlight"><pre>&lt;define name=&quot;var1&quot; value=&quot;1&quot;/&gt;
&lt;define name=&quot;var2&quot; value=&quot;0&quot;/&gt;
&lt;if condition=&quot;{[var1] eq [var2]&quot;&gt;
    &lt;!-- intervening section of xml to be included/excluded --&gt;
&lt;/if&gt;
</pre></div>
</div>
<p>Another feature which is indispensable when assembling complicated or repetitive geometries
is the the ability to insert multiple copies of an XML fragment with slight modifications.
This is called looping and is somewhat similar to the way a <code class="docutils literal"><span class="pre">for</span></code> loop functions in C++. It is
however, a purely static construct intended only to reduce the amount text needed to describe a
geometry or other feature. An example of its use can be found in the <code class="docutils literal"><span class="pre">DipoleTrapMeshedSpaceSimulation.xml</span></code>
example. The example of the loop syntax showing the placement of several copies of a surface
with the name <code class="docutils literal"><span class="pre">intermediate_z_surface</span></code> is given below:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">loop</span> <span class="n">variable</span><span class="o">=</span><span class="s">&quot;i&quot;</span> <span class="n">start</span><span class="o">=</span><span class="s">&quot;0&quot;</span> <span class="n">end</span><span class="o">=</span><span class="s">&quot;10&quot;</span> <span class="n">step</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">surface</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;intermediate_z[i]&quot;</span> <span class="n">node</span><span class="o">=</span><span class="s">&quot;intermediate_z_surface&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">transformation</span> <span class="n">displacement</span><span class="o">=</span><span class="s">&quot;0. 0. {-0.5 + [i]*(0.4/10.)}&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">surface</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">loop</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Loops may also be nested when needed.</p>
</div>
</div>
<div class="section" id="messaging">
<h2>Messaging<a class="headerlink" href="#messaging" title="Permalink to this headline">¶</a></h2>
<p><em>Kassiopeia</em> provides a very granular means of reporting and logging simulation details of interest.
This feature is particularly useful when modifying the code and debugging specific features.
For example, in the file <code class="docutils literal"><span class="pre">QuadrupoleTrapSimulation.xml</span></code> begins with a section describing the
verbosity of each simulation element and the location of the logging file (described by
the variable <code class="docutils literal"><span class="pre">log_path</span></code> and the <code class="docutils literal"><span class="pre">file</span></code> element):</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">define</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;log_path&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;[KASPERSYS]/log/Kassiopeia&quot;</span><span class="o">/&gt;</span>

<span class="o">&lt;</span><span class="n">messages</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">file</span> <span class="n">path</span><span class="o">=</span><span class="s">&quot;[log_path]&quot;</span> <span class="n">base</span><span class="o">=</span><span class="s">&quot;QuadrupoleTrapLog.txt&quot;</span><span class="o">/&gt;</span>

    <span class="o">&lt;</span><span class="n">message</span> <span class="n">key</span><span class="o">=</span><span class="s">&quot;k_file&quot;</span> <span class="n">terminal</span><span class="o">=</span><span class="s">&quot;normal&quot;</span> <span class="n">log</span><span class="o">=</span><span class="s">&quot;warning&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">message</span> <span class="n">key</span><span class="o">=</span><span class="s">&quot;k_initialization&quot;</span> <span class="n">terminal</span><span class="o">=</span><span class="s">&quot;normal&quot;</span> <span class="n">log</span><span class="o">=</span><span class="s">&quot;warning&quot;</span><span class="o">/&gt;</span>

    <span class="o">&lt;</span><span class="n">message</span> <span class="n">key</span><span class="o">=</span><span class="s">&quot;kg_core&quot;</span> <span class="n">terminal</span><span class="o">=</span><span class="s">&quot;normal&quot;</span> <span class="n">log</span><span class="o">=</span><span class="s">&quot;warning&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">message</span> <span class="n">key</span><span class="o">=</span><span class="s">&quot;kg_shape&quot;</span> <span class="n">terminal</span><span class="o">=</span><span class="s">&quot;normal&quot;</span> <span class="n">log</span><span class="o">=</span><span class="s">&quot;warning&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">message</span> <span class="n">key</span><span class="o">=</span><span class="s">&quot;kg_mesh&quot;</span> <span class="n">terminal</span><span class="o">=</span><span class="s">&quot;normal&quot;</span> <span class="n">log</span><span class="o">=</span><span class="s">&quot;warning&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">message</span> <span class="n">key</span><span class="o">=</span><span class="s">&quot;kg_axial_mesh&quot;</span> <span class="n">terminal</span><span class="o">=</span><span class="s">&quot;normal&quot;</span> <span class="n">log</span><span class="o">=</span><span class="s">&quot;warning&quot;</span><span class="o">/&gt;</span>

    <span class="o">&lt;</span><span class="n">message</span> <span class="n">key</span><span class="o">=</span><span class="s">&quot;ks_object&quot;</span> <span class="n">terminal</span><span class="o">=</span><span class="s">&quot;debug&quot;</span> <span class="n">log</span><span class="o">=</span><span class="s">&quot;normal&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">message</span> <span class="n">key</span><span class="o">=</span><span class="s">&quot;ks_operator&quot;</span> <span class="n">terminal</span><span class="o">=</span><span class="s">&quot;debug&quot;</span> <span class="n">log</span><span class="o">=</span><span class="s">&quot;normal&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">message</span> <span class="n">key</span><span class="o">=</span><span class="s">&quot;ks_field&quot;</span> <span class="n">terminal</span><span class="o">=</span><span class="s">&quot;debug&quot;</span> <span class="n">log</span><span class="o">=</span><span class="s">&quot;normal&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">message</span> <span class="n">key</span><span class="o">=</span><span class="s">&quot;ks_geometry&quot;</span> <span class="n">terminal</span><span class="o">=</span><span class="s">&quot;debug&quot;</span> <span class="n">log</span><span class="o">=</span><span class="s">&quot;normal&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">message</span> <span class="n">key</span><span class="o">=</span><span class="s">&quot;ks_generator&quot;</span> <span class="n">terminal</span><span class="o">=</span><span class="s">&quot;debug&quot;</span> <span class="n">log</span><span class="o">=</span><span class="s">&quot;normal&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">message</span> <span class="n">key</span><span class="o">=</span><span class="s">&quot;ks_trajectory&quot;</span> <span class="n">terminal</span><span class="o">=</span><span class="s">&quot;debug&quot;</span> <span class="n">log</span><span class="o">=</span><span class="s">&quot;normal&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">message</span> <span class="n">key</span><span class="o">=</span><span class="s">&quot;ks_interaction&quot;</span> <span class="n">terminal</span><span class="o">=</span><span class="s">&quot;debug&quot;</span> <span class="n">log</span><span class="o">=</span><span class="s">&quot;normal&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">message</span> <span class="n">key</span><span class="o">=</span><span class="s">&quot;ks_navigator&quot;</span> <span class="n">terminal</span><span class="o">=</span><span class="s">&quot;debug&quot;</span> <span class="n">log</span><span class="o">=</span><span class="s">&quot;normal&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">message</span> <span class="n">key</span><span class="o">=</span><span class="s">&quot;ks_terminator&quot;</span> <span class="n">terminal</span><span class="o">=</span><span class="s">&quot;debug&quot;</span> <span class="n">log</span><span class="o">=</span><span class="s">&quot;normal&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">message</span> <span class="n">key</span><span class="o">=</span><span class="s">&quot;ks_writer&quot;</span> <span class="n">terminal</span><span class="o">=</span><span class="s">&quot;debug&quot;</span> <span class="n">log</span><span class="o">=</span><span class="s">&quot;normal&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">message</span> <span class="n">key</span><span class="o">=</span><span class="s">&quot;ks_main&quot;</span> <span class="n">terminal</span><span class="o">=</span><span class="s">&quot;debug&quot;</span> <span class="n">log</span><span class="o">=</span><span class="s">&quot;normal&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">message</span> <span class="n">key</span><span class="o">=</span><span class="s">&quot;ks_run&quot;</span> <span class="n">terminal</span><span class="o">=</span><span class="s">&quot;debug&quot;</span> <span class="n">log</span><span class="o">=</span><span class="s">&quot;normal&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">message</span> <span class="n">key</span><span class="o">=</span><span class="s">&quot;ks_event&quot;</span> <span class="n">terminal</span><span class="o">=</span><span class="s">&quot;debug&quot;</span> <span class="n">log</span><span class="o">=</span><span class="s">&quot;normal&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">message</span> <span class="n">key</span><span class="o">=</span><span class="s">&quot;ks_track&quot;</span> <span class="n">terminal</span><span class="o">=</span><span class="s">&quot;debug&quot;</span> <span class="n">log</span><span class="o">=</span><span class="s">&quot;normal&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">message</span> <span class="n">key</span><span class="o">=</span><span class="s">&quot;ks_step&quot;</span> <span class="n">terminal</span><span class="o">=</span><span class="s">&quot;debug&quot;</span> <span class="n">log</span><span class="o">=</span><span class="s">&quot;normal&quot;</span><span class="o">/&gt;</span>

<span class="o">&lt;/</span><span class="n">messages</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For the verbosity settings, you can independently set the verbosity that you see
in the terminal and the verbosity that is put into log files.
Furthermore, you can do that for each different part of Kassiopeia.
That way, for example, if you want a lot of detail on what&#8217;s happening in
the navigation routines, you can increase the verbosity from only that part
of Kassiopeia, without being flooded with messages from everything else.
There are three possible verbosity levels, they are <code class="docutils literal"><span class="pre">debug</span></code>, <code class="docutils literal"><span class="pre">normal</span></code>, and <code class="docutils literal"><span class="pre">warning</span></code>.
Of the three, <code class="docutils literal"><span class="pre">warning</span></code> is the least verbose, only reporting on non-fatal errors that
may be encountered during tracking. The <code class="docutils literal"><span class="pre">normal</span></code> mode will include a relatively small
set of details in addition to any warnings, while <code class="docutils literal"><span class="pre">debug</span></code> will provide an extremely extensive
description of the state of the simulation as it progresses.</p>
<p>Since there is so much information provided by the <code class="docutils literal"><span class="pre">debug</span></code> setting it substantially
slows down the speed of the simulation. In fact, in order to avoid unnecessarily slowing
down <em>Kassiopeia</em>, this option is completely disabled unless it is explicitly compiled into
the code by enabling the cmake option <code class="docutils literal"><span class="pre">Kassiopeia_ENABLE_DEBUG</span></code> during configuration.</p>
</div>
<div class="section" id="geometry">
<h2>Geometry<a class="headerlink" href="#geometry" title="Permalink to this headline">¶</a></h2>
<p>The geometry section of the configuration file the first piece needed in order
to assemble a simulation. At its first and most basic level it is responsible for
defining all the different shapes that will be used, and placing them with respect
to one another in order to construct the arrangement that is needed.
For a full a description of all of the shape objects (surfaces and spaces)
which maybe constructed in <em>KGeoBag</em> see <a class="reference internal" href="kgeobag_basic.html#basic-kgeobag-label"><span class="std std-ref">Basic Shapes in KGeoBag</span></a> and <a class="reference internal" href="kgeobag_complex.html#complex-kgeobag-label"><span class="std std-ref">Complex Shapes in KGeoBag</span></a>.
The abstract base classes which serve as the interface between <em>KGeoBag</em> and <em>Kassiopiea</em>
are <a class="reference external" href="././_static/html/classKassiopeia_1_1KSSurface.html">KSSurface</a>, <a class="reference external" href="././_static/html/classKassiopeia_1_1KSSpace.html">KSSpace</a>, and <a class="reference external" href="././_static/html/classKassiopeia_1_1KSSide.html">KSSide</a>.</p>
<p>The second half of the geometry section is responsible for adding
&#8220;extended&#8221; information to the previously described geometry elements.
These extensions can be properties such as colors for visualization
or boundary conditions and meshing details for the electromagnetic simulations.</p>
<p>Every relevant to the geometry description is processed by KGeoBag and must appear
between the start and end brackets:</p>
<div class="highlight-default"><div class="highlight"><pre>&lt;geometry&gt;
&lt;!-- fill in geometry description here --&gt;
&lt;/geometry&gt;
</pre></div>
</div>
<p>It should be noted, that the full description of the geometry need not lie within the same
pair of <code class="docutils literal"><span class="pre">&lt;geometry&gt;</span></code> and <code class="docutils literal"><span class="pre">&lt;/geometry&gt;</span></code> brackets. This facilitates the description of
separate geometry pieces in different files which may then be included and used in the final
assembly.</p>
<div class="section" id="shapes-and-placement">
<h3>Shapes and Placement<a class="headerlink" href="#shapes-and-placement" title="Permalink to this headline">¶</a></h3>
<p>Of the example files provided, the <code class="docutils literal"><span class="pre">DipoleTrapSimulation.xml</span></code> has the simplest geometry. It
starts off with a description of each shapes involved:</p>
<div class="highlight-default"><div class="highlight"><pre>&lt;!-- world --&gt;

&lt;cylinder_space name=&quot;world_space&quot; z1=&quot;-2.&quot; z2=&quot;2.&quot; r=&quot;2.&quot;/&gt;

&lt;!-- solenoid --&gt;

&lt;tag name=&quot;magnet_tag&quot;&gt;
    &lt;cylinder_tube_space
        name=&quot;solenoid_space&quot;
        z1=&quot;-1.e-2&quot;
        z2=&quot;1.e-2&quot;
        r1=&quot;0.5e-2&quot;
        r2=&quot;1.5e-2&quot;
        radial_mesh_count=&quot;30&quot;
    /&gt;
&lt;/tag&gt;

&lt;!-- ring --&gt;

&lt;tag name=&quot;electrode_tag&quot;&gt;
    &lt;cylinder_surface
        name=&quot;ring_surface&quot;
        z1=&quot;-2.0e-2&quot;
        z2=&quot;2.0e-2&quot;
        r=&quot;2.5e-1&quot;
        longitudinal_mesh_count=&quot;200&quot;
        longitudinal_mesh_power=&quot;3.&quot;
        axial_mesh_count=&quot;128&quot;
    /&gt;
&lt;/tag&gt;

&lt;!-- tube --&gt;

&lt;tag name=&quot;electrode_tag&quot;&gt;
    &lt;cylinder_surface
        name=&quot;tube_surface&quot;
        z1=&quot;-1.e-2&quot;
        z2=&quot;1.e-2&quot;
        r=&quot;0.5e-2&quot;
        longitudinal_mesh_count=&quot;200&quot;
        longitudinal_mesh_power=&quot;3.&quot;
        axial_mesh_count=&quot;128&quot;
    /&gt;
&lt;/tag&gt;

&lt;!-- target --&gt;

&lt;tag name=&quot;target_tag&quot;&gt;
    &lt;disk_surface name=&quot;target_surface&quot; r=&quot;1.0e-2&quot; z=&quot;0.&quot;/&gt;
&lt;/tag&gt;

&lt;!-- center --&gt;

&lt;tag name=&quot;center_tag&quot;&gt;
    &lt;disk_surface name=&quot;center_surface&quot; r=&quot;2.5e-1&quot; z=&quot;0.&quot;/&gt;
&lt;/tag&gt;
</pre></div>
</div>
<p>These shapes are then placed into an assembly of the experiment
geometry. Geometric objects are placed by referencing each shape by its given (unique!!) name
and specifying a transformation (relative the assembly origin) defining the location
and orientation of each object. The transformation types are displacements (specified by
a vector), and rotations (specified by an axis-angle pair or a
series of Euler angles using the Z-Y&#8217;-Z&#8217;&#8217; convention):</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">space</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;dipole_trap_assembly&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">surface</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;ring&quot;</span> <span class="n">node</span><span class="o">=</span><span class="s">&quot;ring_surface&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">surface</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;center&quot;</span> <span class="n">node</span><span class="o">=</span><span class="s">&quot;center_surface&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">space</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;downstream_solenoid&quot;</span> <span class="n">node</span><span class="o">=</span><span class="s">&quot;solenoid_space&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">transformation</span> <span class="n">displacement</span><span class="o">=</span><span class="s">&quot;0. 0. -0.5&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">space</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">surface</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;downstream_tube&quot;</span> <span class="n">node</span><span class="o">=</span><span class="s">&quot;tube_surface&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">transformation</span> <span class="n">displacement</span><span class="o">=</span><span class="s">&quot;0. 0. -0.5&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">surface</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">surface</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;upstream_target&quot;</span> <span class="n">node</span><span class="o">=</span><span class="s">&quot;target_surface&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">transformation</span> <span class="n">displacement</span><span class="o">=</span><span class="s">&quot;0. 0. -0.48&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">surface</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">space</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;upstream_solenoid&quot;</span> <span class="n">node</span><span class="o">=</span><span class="s">&quot;solenoid_space&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">transformation</span> <span class="n">displacement</span><span class="o">=</span><span class="s">&quot;0. 0. 0.5&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">space</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">surface</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;upstream_tube&quot;</span> <span class="n">node</span><span class="o">=</span><span class="s">&quot;tube_surface&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">transformation</span> <span class="n">displacement</span><span class="o">=</span><span class="s">&quot;0. 0. 0.5&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">surface</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">surface</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;downstream_target&quot;</span> <span class="n">node</span><span class="o">=</span><span class="s">&quot;target_surface&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">transformation</span> <span class="n">displacement</span><span class="o">=</span><span class="s">&quot;0. 0. 0.48&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">surface</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">space</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Finally, the full assembly is placed within the world volume:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">space</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;world&quot;</span> <span class="n">node</span><span class="o">=</span><span class="s">&quot;world_space&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">space</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;dipole_trap&quot;</span> <span class="n">tree</span><span class="o">=</span><span class="s">&quot;dipole_trap_assembly&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">space</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>It should be noted that transformations applied to an assembly are collectively applied
to all of the geometric elements within the assembly. For example, placing
the dipole trap assembly within the world volume as:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">space</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;world&quot;</span> <span class="n">node</span><span class="o">=</span><span class="s">&quot;world_space&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">space</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;dipole_trap&quot;</span> <span class="n">tree</span><span class="o">=</span><span class="s">&quot;dipole_trap_assembly&quot;</span>
        <span class="o">&lt;</span><span class="n">transformation</span> <span class="n">rotation_euler</span><span class="o">=</span><span class="s">&quot;90. 0. 0.&quot;</span> <span class="n">displacement</span><span class="o">=</span><span class="s">&quot;0 0 1.0&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">space</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">space</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>which would rotate the whole assembly by 90 degrees about the z-axis, and then displace it by 1 meter
along the z-axis. Assemblies may be nested within each other and the coordinate transformations
which are associated with the placement each assembly will be appropriately
applied to all of the elements they contain.</p>
</div>
<div class="section" id="extensions">
<h3>Extensions<a class="headerlink" href="#extensions" title="Permalink to this headline">¶</a></h3>
<p>In order to give physical properties to the geometry elements that have been constructed
and placed they must be associated with extensions. The currently available extensions are
axial (rotationally symmetric) or non-symmetric meshing, visualization properties, electrostatic
boundary conditions (Dirichlet or Neuman surfaces), and electromagnet properties such as current density.</p>
<p>A simple extension example is specifying the color and opacity
of a shape for its display in a VTK visualization window is as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">appearance</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;app_magnet&quot;</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;0 255 127 127&quot;</span> <span class="n">arc</span><span class="o">=</span><span class="s">&quot;72&quot;</span> <span class="n">surfaces</span><span class="o">=</span><span class="s">&quot;world/dipole_trap/@magnet_tag&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>This example tells the visualization that any shape given the tag <code class="docutils literal"><span class="pre">magnet_tag</span></code> should be colored
with an RGBA color value of (0,255,127,127). If you have VTK enabled you may wish to experiment
with the changes introduced by modifying these parameters.</p>
<p>Extensions may be attached to a shape object, either by specifying its name or location within
the geometry tree, or by giving a tag that is associated with it. The location of objects within
the geometry tree uses an XPath like syntax augmented with tagging. The tagging feature is very useful
for applying properties to many different elements at once. To do this, each element which is to
receive the same extension must share the same tag. There is no limit to the number of tags an geometric
element may be given, and tags may be nested. For example, given the dipole trap geometry as specified, one
may associate an axially symmetric mesh with all elements that share the tag <code class="docutils literal"><span class="pre">electrode_tag</span></code> with:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">axial_mesh</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;mesh_electrode&quot;</span> <span class="n">surfaces</span><span class="o">=</span><span class="s">&quot;world/dipole_trap/@electrode_tag&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">&#64;</span></code> symbol signifies that any geometric shape with the tag <code class="docutils literal"><span class="pre">electrode_tag</span></code>
that is found within <code class="docutils literal"><span class="pre">world/dipole</span></code> trap should be giving an axial mesh extension (i.e. it will
be divided into a collection of axially symmetric objects, cones, cylinders, etc.). The axial mesh
will be later used by the field solving routines. However, a tag is not strictly necessary to
apply an extension, for example, if we wished to generate an axial mesh for everything within the world
we would write:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">axial_mesh</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;mesh_electrode&quot;</span> <span class="n">surfaces</span><span class="o">=</span><span class="s">&quot;world/@&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>or, if we wished to single out the <code class="docutils literal"><span class="pre">ring_surface</span></code> shape exactly we would write:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">axial_mesh</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;mesh_electrode&quot;</span> <span class="n">surfaces</span><span class="o">=</span><span class="s">&quot;world/dipole_trap/ring&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>Meshing is critical for any problem with involves electrostatic fields. The type of mesh depends on
the symmetry of the geometry. For completely axially-symmetric geometries, the <code class="docutils literal"><span class="pre">axial_mesh</span></code> is recommended
so that the zonal harmonics field computation method may be used. For completely non-symmetric (3D) geometries
the mesh type would be specified as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">mesh</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;mesh_electrode&quot;</span> <span class="n">surfaces</span><span class="o">=</span><span class="s">&quot;world/dipole_trap/@electrode_tag&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>Because of the very shape-specific nature of the deterministic meshing which is provided by KGeoBag,
parameters (<code class="docutils literal"><span class="pre">mesh_count</span></code> and <code class="docutils literal"><span class="pre">mesh_power</span></code>) describing how the mesh is to be constructed
are given when specifying the shapes themselves. That being said, the mesh associated with a
specific shape will not be constructed unless the extension statement is present.</p>
<p>Another important extension for field solving is the specification of boundary conditions. For example
when solving the Laplace boundary value problem, one may specify that a particular surface exhibit
Dirichlet boundary conditions with a particular voltage through the use of the following extension:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">electrostatic_dirichlet</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;electrode_ring&quot;</span> <span class="n">surfaces</span><span class="o">=</span><span class="s">&quot;world/dipole_trap/ring&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;-10.&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>Where <code class="docutils literal"><span class="pre">value=&quot;-10&quot;</span></code> signifies that this surface has a potential of -10 volts.</p>
<p>For further demonstrations of the possible geometry extensions please see the provided example XML files.</p>
</div>
</div>
<div class="section" id="kassiopeia">
<h2>Kassiopeia<a class="headerlink" href="#kassiopeia" title="Permalink to this headline">¶</a></h2>
<p>The remaining elements all live within the <em>Kassiopeia</em> element and must be placed with
start and end tags of the form:</p>
<div class="highlight-default"><div class="highlight"><pre>&lt;kassiopeia&gt;
&lt;!-- complete description of the kassiopeia simulation element here --&gt;
&lt;/kassiopeia&gt;
</pre></div>
</div>
<p>The elements which must be described within the <em>Kassiopeia</em> namespace include the specification
of the fields, propagation, interactions, termination, navigation, output, and simulation.</p>
</div>
<div class="section" id="fields">
<h2>Fields<a class="headerlink" href="#fields" title="Permalink to this headline">¶</a></h2>
<p>Once the simulation geometry has been specified the user may describe the types of electric and
magnetic fields they wish associate with each geometric object. The field package <em>KEMField</em>
takes care of solving the boundary value problem and computing the fields for electrostatic problems.
It also handles the magnetic field computation from static current distributions. Fast field calculation
methods are available for axially symmetric (zonal harmonics) and
three dimensional problems (fast multipole method). The abstract base classes responsible for
electric and magnetic fields in <em>Kassiopeia</em> are <a class="reference external" href="././_static/html/classKassiopeia_1_1KSElectricField.html">KSElectricField</a> and
<a class="reference external" href="././_static/html/classKassiopeia_1_1KSMagneticField.html">KSMagneticField</a> respectively.</p>
<p>For example, in the <code class="docutils literal"><span class="pre">DipoleTrapSimulation.xml</span></code> example the electric and magnetic fields are axially
symmetric and can be computed using the zonal harmonics expansion.</p>
<div class="section" id="electric">
<h3>Electric<a class="headerlink" href="#electric" title="Permalink to this headline">¶</a></h3>
<p>To specify the electric field, the geometric surfaces which are electrically
active must be listed in the <code class="docutils literal"><span class="pre">surfaces</span></code> element. It is important that the surfaces which are specified have a mesh extension
and a boundary type extension. If either of these extensions are missing from the specified
surface, they will not be included in the electrostatics problem. A boundary element
mesh is needed to solve the Laplace equation using the boundary element method. Each element
of the mesh inherits its parent surface&#8217;s boundary condition type.</p>
<p>Both a method to solve the Laplace boundary value problem (a <code class="docutils literal"><span class="pre">bem_solver</span></code>), and a method by which to compute
the fields from the resulting charge densities must be given (a <code class="docutils literal"><span class="pre">field_sovler</span></code>). In
the following example we use a <code class="docutils literal"><span class="pre">robin_hood_bem_solver</span></code> and a <code class="docutils literal"><span class="pre">zonal_harmonic_field_solver</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">ksfield_electrostatic</span>
    <span class="n">name</span><span class="o">=</span><span class="s">&quot;field_electrostatic&quot;</span>
    <span class="n">directory</span><span class="o">=</span><span class="s">&quot;[KEMFIELD_CACHE]&quot;</span>
    <span class="n">file</span><span class="o">=</span><span class="s">&quot;DipoleTrapElectrodes.kbd&quot;</span>
    <span class="n">system</span><span class="o">=</span><span class="s">&quot;world/dipole_trap&quot;</span>
    <span class="n">surfaces</span><span class="o">=</span><span class="s">&quot;world/dipole_trap/@electrode_tag&quot;</span>
    <span class="n">symmetry</span><span class="o">=</span><span class="s">&quot;axial&quot;</span>
<span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">robin_hood_bem_solver</span>
        <span class="n">tolerance</span><span class="o">=</span><span class="s">&quot;1.e-10&quot;</span>
        <span class="n">check_sub_interval</span><span class="o">=</span><span class="s">&quot;100&quot;</span>
        <span class="n">display_interval</span><span class="o">=</span><span class="s">&quot;1&quot;</span>
        <span class="n">cache_matrix_elements</span><span class="o">=</span><span class="s">&quot;true&quot;</span>
    <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">zonal_harmonic_field_solver</span>
        <span class="n">number_of_bifurcations</span><span class="o">=</span><span class="s">&quot;-1&quot;</span>
        <span class="n">convergence_ratio</span><span class="o">=</span><span class="s">&quot;.99&quot;</span>
        <span class="n">convergence_parameter</span><span class="o">=</span><span class="s">&quot;1.e-15&quot;</span>
        <span class="n">proximity_to_sourcepoint</span><span class="o">=</span><span class="s">&quot;1.e-12&quot;</span>
        <span class="n">number_of_central_coefficients</span><span class="o">=</span><span class="s">&quot;500&quot;</span>
        <span class="n">use_fractional_central_sourcepoint_spacing</span><span class="o">=</span><span class="s">&quot;false&quot;</span>
        <span class="n">central_sourcepoint_spacing</span><span class="o">=</span><span class="s">&quot;1.e-3&quot;</span>
        <span class="n">central_sourcepoint_start</span><span class="o">=</span><span class="s">&quot;-5.2e-1&quot;</span>
        <span class="n">central_sourcepoint_end</span><span class="o">=</span><span class="s">&quot;5.2e-1&quot;</span>
        <span class="n">number_of_remote_coefficients</span><span class="o">=</span><span class="s">&quot;200&quot;</span>
        <span class="n">remote_sourcepoint_start</span><span class="o">=</span><span class="s">&quot;-5.e-2&quot;</span>
        <span class="n">remote_sourcepoint_end</span><span class="o">=</span><span class="s">&quot;5.e-2&quot;</span>
    <span class="o">/&gt;</span>
</pre></div>
</div>
<p>It is also important that geometric elements be meshed appropriately with respect to symmetry.
In the case that the user wishes to use zonal harmonic field calculation routines,
an <code class="docutils literal"><span class="pre">axial_mesh</span></code> must be used.
If a normal (3D) mesh is used, zonal harmonics cannot function. Different mesh/symmetry
types cannot be combined within the same electric field solving element.</p>
<p>In the three-dimensional mesh case, either an integrating field solver, or a fast multipole field solver
may be used. The integrating field solver may be specified through inclusion of the
element:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">integrating_field_solver</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>within the the <code class="docutils literal"><span class="pre">ksfield_electrostatic</span></code> element. As the integrating field solver
is quite simple, it does not require additional parameters.
The fast multipole field solver on the other hand is
somewhat more complex and requires a relatively large set of additional parameters to be specified in
order to configure its use according to the user&#8217;s desired level of accuracy and computational effort.</p>
<p>For a complete list and description of the XML bindings available for the electric field solving routines,
navigate to the directory <code class="docutils literal"><span class="pre">$KASPERSYS/config/KEMField/Complete</span></code>. The file <code class="docutils literal"><span class="pre">ElectricFields.xml</span></code>
has examples of the binding for initializing electric field problems.</p>
</div>
<div class="section" id="magnetic">
<h3>Magnetic<a class="headerlink" href="#magnetic" title="Permalink to this headline">¶</a></h3>
<p>The specification of the magnetic field solving routines is considerably simpler since there is no
need to solve a boundary value problem before hand. There are essentially two choices for solving magnetic
fields from static current distributions. These are; the zonal harmonics method for use with axially
symmetric current sources, and the integrating magnetic field solver which can be used on geometries
with more arbitrary distributions of current. Unlike electric fields, magnetic fields can
contain components with both axially symmetric and non-axially symmetric elements
within the same region with no adverse effects.</p>
<p>A complete list and set of examples of the XML bindings for magnetic fields can be found
in the file <code class="docutils literal"><span class="pre">$KASPERSYS/config/KEMField/Complete/MagneticFields.xml</span></code>.</p>
<p>Further documentation on the exact methods and parameters
used in <em>KEMField</em> can be found in [2] and [3].</p>
</div>
</div>
<div class="section" id="generation">
<h2>Generation<a class="headerlink" href="#generation" title="Permalink to this headline">¶</a></h2>
<p>The intial state of particle&#8217;s to be tracked is set up using the generator mechanism. The
abstract base class of all particle generators is <a class="reference external" href="././_static/html/classKassiopeia_1_1KSGenerator.html">KSGenerator</a>.
When generating a particle, there are five important initial parameters:</p>
<ul class="simple">
<li>PID: What is the particle type? For particle ID values, see the <a class="reference external" href="http://pdg.lbl.gov/mc_particle_id_contents.html">PDG</a> numbering scheme.</li>
<li>Energy: What is the initial energy of the particle?</li>
<li>Position: What is the initial position of the particle?</li>
<li>Direction: In what direction is the particle traveling?</li>
<li>Time: How is the production of particles distributed in time during the simulation?</li>
</ul>
<p>Each of the dynamic components (energy, position, direction, time) can be draw
from a selected probability distribution. In some scenarios a dedicated particle generator
may be need which produces with a very specific and well defined particle state as the
result of some physical process (e.g. electron shake off in Radon decay). However,
as is often the case, the user may wish to modify each dynamic component in a specific
way in order to see what effect this has on the rest of the simulation. To
draw each dynamic component from an independent distribution a composite
generator is used. This type of generator combines a set of user selected distributions
to produce the initial energy, position, direction, and time parameters.
The following composite generator example is taken from the DipoleTrapSimulation.xml:</p>
<div class="highlight-default"><div class="highlight"><pre>&lt;!-- pid=11 implies that electrons will be generated --&gt;
&lt;ksgen_generator_composite name=&quot;generator_uniform&quot; pid=&quot;11&quot;&gt;
    &lt;energy_composite&gt;
        &lt;energy_fix value=&quot;1.&quot;/&gt;
    &lt;/energy_composite&gt;
    &lt;position_cylindrical_composite surface=&quot;world/dipole_trap/center&quot;&gt;
        &lt;r_cylindrical radius_min=&quot;0.&quot; radius_max=&quot;2.0e-1&quot;/&gt;
        &lt;phi_uniform value_min=&quot;0.&quot; value_max=&quot;360.&quot;/&gt;
        &lt;z_fix value=&quot;0.&quot;/&gt;
    &lt;/position_cylindrical_composite&gt;
    &lt;direction_spherical_composite surface=&quot;world/dipole_trap/center&quot;&gt;
        &lt;theta_fix value=&quot;0.&quot;/&gt;
        &lt;phi_uniform value_min=&quot;0.&quot; value_max=&quot;360&quot;/&gt;
    &lt;/direction_spherical_composite&gt;
    &lt;time_composite&gt;
        &lt;time_fix value=&quot;0.&quot;/&gt;
    &lt;/time_composite&gt;
&lt;/ksgen_generator_composite&gt;
</pre></div>
</div>
<p>In this example of the composite generator, the initial kinetic
energy of the particle is fixed to 1 eV and its position is drawn uniformly within a cylindrical
volume. Its initial starting time is fixed to zero, while its initial momentum direction is fixed
along the z-axis. All of the fixed values used in this composite generator may be replaced by
probability distributions. The available probability distributions depend on the quantity they are
intended to generator, but included uniform, gaussian, pareto, cosine, etc. Also available
is the ability to generate values at fix intervals throughout a limited range. For example
this can be done for energy as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">energy_composite</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">energy_set</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;e_set&quot;</span> <span class="n">value_start</span><span class="o">=</span><span class="s">&quot;1&quot;</span> <span class="n">value_stop</span><span class="o">=</span><span class="s">&quot;10&quot;</span> <span class="n">value_count</span><span class="o">=</span><span class="s">&quot;3&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">energy_composite</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>which would generate 3 electrons with energies equally spaced between 1 and 10 eV.
Alternatively, as specific list of values can also be used:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">energy_composite</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">energy_list</span>
       <span class="n">add_value</span><span class="o">=</span><span class="s">&quot;11.8&quot;</span>
       <span class="n">add_value</span><span class="o">=</span><span class="s">&quot;20.5&quot;</span>
       <span class="n">add_value</span><span class="o">=</span><span class="s">&quot;33.1&quot;</span>
    <span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">energy_composite</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Keep in mind that if a <code class="docutils literal"><span class="pre">list</span></code> of <code class="docutils literal"><span class="pre">set</span></code> is used within a composite generator, the number of particles
produced in an &#8220;event&#8221; will be equal to multiplicative combination of all possible particle states.
For example, the following generator specification:</p>
<div class="highlight-default"><div class="highlight"><pre>    <span class="o">&lt;</span><span class="n">ksgen_generator_composite</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;generator_uniform&quot;</span> <span class="n">pid</span><span class="o">=</span><span class="s">&quot;11&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">energy_composite</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">energy_set</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;e_set&quot;</span> <span class="n">value_start</span><span class="o">=</span><span class="s">&quot;1&quot;</span> <span class="n">value_stop</span><span class="o">=</span><span class="s">&quot;200&quot;</span> <span class="n">value_count</span><span class="o">=</span><span class="s">&quot;10&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">energy_composite</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">position_cylindrical_composite</span> <span class="n">surface</span><span class="o">=</span><span class="s">&quot;world/dipole_trap/center&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">r_cylindrical</span> <span class="n">radius_min</span><span class="o">=</span><span class="s">&quot;0.&quot;</span> <span class="n">radius_max</span><span class="o">=</span><span class="s">&quot;2.0e-1&quot;</span><span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">phi_uniform</span> <span class="n">value_min</span><span class="o">=</span><span class="s">&quot;0.&quot;</span> <span class="n">value_max</span><span class="o">=</span><span class="s">&quot;360.&quot;</span><span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">z_fix</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;0.&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">position_cylindrical_composite</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">direction_spherical_composite</span> <span class="n">surface</span><span class="o">=</span><span class="s">&quot;world/dipole_trap/center&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">theta_set</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;e_set&quot;</span> <span class="n">value_start</span><span class="o">=</span><span class="s">&quot;0&quot;</span> <span class="n">value_stop</span><span class="o">=</span><span class="s">&quot;90&quot;</span> <span class="n">values_count</span><span class="o">=</span><span class="s">&quot;10&quot;</span><span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">phi_uniform</span> <span class="n">value_min</span><span class="o">=</span><span class="s">&quot;0.&quot;</span> <span class="n">value_max</span><span class="o">=</span><span class="s">&quot;360&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">direction_spherical_composite</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">time_composite</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">time_fix</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;0.&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">time_composite</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">ksgen_generator_composite</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>results in a total of 100 particles being generated in a single event (as a combination of
possible energies and momentum direction theta coordinate). To see other generator examples please
see the included example XML files.</p>
</div>
<div class="section" id="termination">
<h2>Termination<a class="headerlink" href="#termination" title="Permalink to this headline">¶</a></h2>
<p>The converse to particle generation is termination. The abstract base class of
all particle terminators is <a class="reference external" href="././_static/html/classKassiopeia_1_1KSTerminator.html">KSTerminator</a>. Terminators are used to kill particle tracks
in situations where further simulation of the particle is of no further interest. Terminators
typically operate on very simple conditional logic. For example, a particle track may be terminated
if the particle&#8217;s kinetic energy drops below some set value, or if it intersects a particular surface.</p>
<p>An example of a terminator which kills particle tracks which exceed a certain number (1000)
of allowed steps is given as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">ksterm_max_steps</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;term_max_steps&quot;</span> <span class="n">steps</span><span class="o">=</span><span class="s">&quot;1000&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>A pair of terminators which will kill a particle that exceeds an allowed range
for the z-coordinate is given in the following example:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">ksterm_max_z</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;term_max_z&quot;</span> <span class="n">z</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">ksterm_min_z</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;term_min_z&quot;</span> <span class="n">z</span><span class="o">=</span><span class="s">&quot;-1.0&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>There are a wide variety of terminators currently avaiable, and the user is encourages to peruse
the XML example files as well as the source code to determine what (if any)
type of pre-existing terminator might be useful for their purpose.</p>
</div>
<div class="section" id="interactions">
<h2>Interactions<a class="headerlink" href="#interactions" title="Permalink to this headline">¶</a></h2>
<p>In between generation and termination discrete stochastic interactions involving
the particle of interest may be applied during tracking. These interactions are divided
according to whether they are active in a volume, or on a surface.</p>
<div class="section" id="volume-interactions">
<h3>Volume Interactions<a class="headerlink" href="#volume-interactions" title="Permalink to this headline">¶</a></h3>
<p>Volume interactions typically involve scattering off of a gas. The
abstract base class of all volume interactions is <a class="reference external" href="././_static/html/classKassiopeia_1_1KSSpaceInteraction.html">KSSpaceInteraction</a>.
Simple situations where the scattering interactions is treated
approximately by a constant density and cross section can be
constructed as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">ksint_scattering</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;int_scattering&quot;</span> <span class="n">split</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">density_constant</span> <span class="n">temperature</span><span class="o">=</span><span class="s">&quot;300.&quot;</span> <span class="n">pressure</span><span class="o">=</span><span class="s">&quot;3.e0&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">calculator_constant</span> <span class="n">cross_section</span><span class="o">=</span><span class="s">&quot;1.e-18&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">ksint_scattering</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>In this example the density is computed according to the ideal gas law from the temperature (Kelvin)
and pressure (Pascal) and the cross section is treated as a constant (independent of particle energy).
For more complicated interaction (e.g. involving differential or energy dependent cross sections) the user
may need to devise their own interaction class. Volume interactions must be associated with a particular
volume when describing the simulation structure.</p>
</div>
<div class="section" id="surface-interactions">
<h3>Surface Interactions<a class="headerlink" href="#surface-interactions" title="Permalink to this headline">¶</a></h3>
<p>Surface interactions are much more limited in their scope and only
occur when the track of a particle passes through a surface. The
abstract base class of all surface interactions is <a class="reference external" href="././_static/html/classKassiopeia_1_1KSSurfaceInteraction.html">KSSurfaceInteraction</a>.</p>
<p>For example, to cause a particle to be reflected diffusely (Lambertian)
from a surface the user can specify an interaction of the following type:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">ksint_surface_diffuse</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;int_surface_diffuse&quot;</span> <span class="n">probability</span><span class="o">=</span><span class="s">&quot;.3&quot;</span> <span class="n">reflection_loss</span><span class="o">=</span><span class="s">&quot;0.&quot;</span> <span class="n">transmission_loss</span><span class="o">=</span><span class="s">&quot;1.&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>In order for this interaction to operate on any particles it must be associated with a surface
in the simulation command structure.</p>
</div>
</div>
<div class="section" id="output">
<h2>Output<a class="headerlink" href="#output" title="Permalink to this headline">¶</a></h2>
<p>The data which is saved as output from the simulation requires two pieces: a file writer
and a description of the data to be saved. The abstract base class of all
file writers is <a class="reference external" href="././_static/html/classKassiopeia_1_1KSWriter.html">KSWriter</a>.</p>
<div class="section" id="writers">
<h3>Writers<a class="headerlink" href="#writers" title="Permalink to this headline">¶</a></h3>
<p>The file writer is responsible for buffering and writing the desired information to disk. The default writer
is based on <a class="reference external" href="https://root.cern.ch/">ROOT</a>, and stores the output in a TTree:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">kswrite_root</span>
    <span class="n">name</span><span class="o">=</span><span class="s">&quot;write_root&quot;</span>
    <span class="n">path</span><span class="o">=</span><span class="s">&quot;/path/to/desired/output/directory&quot;</span>
    <span class="n">base</span><span class="o">=</span><span class="s">&quot;my_filename.root&quot;</span>
<span class="o">/&gt;</span>
</pre></div>
</div>
<p>If <em>Kassiopeia</em> is linked against VTK, an additional writer will be made available which can save
track and step information to a .vtp (VTK polydata file). This data is useful for visualalization
in external tools such as <a class="reference external" href="http://www.paraview.org">Paraview</a>. This write may be created using the following statement:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">kswrite_vtk</span>
    <span class="n">name</span><span class="o">=</span><span class="s">&quot;write_vtk&quot;</span>
    <span class="n">path</span><span class="o">=</span><span class="s">&quot;/path/to/desired/output/directory&quot;</span>
    <span class="n">base</span><span class="o">=</span><span class="s">&quot;my_filename_base.vtp&quot;</span>
<span class="o">/&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="output-description">
<h3>Output description<a class="headerlink" href="#output-description" title="Permalink to this headline">¶</a></h3>
<p>The user may tailor the data written to disk to keep precisely the quantities of interest
and no more. To do this a description of the data components to be kept at the track
and step level must be given. An example of this (taken from the QuadrupoleTrapSimulation.xml example)
is shown below:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">ks_component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;component_step_final_particle&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;final_particle&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;step&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">ks_component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;component_step_position&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;position&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_step_final_particle&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">ks_component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;component_step_length&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;length&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_step_final_particle&quot;</span><span class="o">/&gt;</span>

<span class="o">&lt;</span><span class="n">ks_component_group</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;component_step_world&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;step_id&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;step_id&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;step&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;continuous_time&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;continuous_time&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;step&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;continuous_length&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;continuous_length&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;step&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;time&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;time&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_step_final_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;position&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;position&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_step_final_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;momentum&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;momentum&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_step_final_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;magnetic_field&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;magnetic_field&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_step_final_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;electric_field&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;electric_field&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_step_final_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;electric_potential&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;electric_potential&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_step_final_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;kinetic_energy&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;kinetic_energy_ev&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_step_final_particle&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">ks_component_group</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">ks_component_group</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;component_step_cell&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;polar_angle_to_z&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;polar_angle_to_z&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_step_final_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;polar_angle_to_b&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;polar_angle_to_b&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_step_final_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;guiding_center_position&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;guiding_center_position&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_step_final_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;orbital_magnetic_moment&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;orbital_magnetic_moment&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_step_final_particle&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">ks_component_group</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">ks_component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;component_track_initial_particle&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;initial_particle&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;track&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">ks_component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;component_track_final_particle&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;final_particle&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;track&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">ks_component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;component_track_position&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;position&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_track_final_particle&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">ks_component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;component_track_length&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;length&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_track_final_particle&quot;</span><span class="o">/&gt;</span>

<span class="o">&lt;</span><span class="n">ks_component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;z_length&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;continuous_length&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;step&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">ks_component_group</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;component_track_world&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;creator_name&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;creator_name&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;track&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;terminator_name&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;terminator_name&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;track&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;total_steps&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;total_steps&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;track&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;initial_time&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;time&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_track_initial_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;initial_position&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;position&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_track_initial_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;initial_momentum&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;momentum&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_track_initial_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;initial_magnetic_field&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;magnetic_field&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_track_initial_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;initial_electric_field&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;electric_field&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_track_initial_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;initial_electric_potential&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;electric_potential&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_track_initial_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;initial_kinetic_energy&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;kinetic_energy_ev&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_track_initial_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;initial_polar_angle_to_z&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;polar_angle_to_z&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_track_initial_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;initial_azimuthal_angle_to_x&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;azimuthal_angle_to_x&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_track_initial_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;initial_polar_angle_to_b&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;polar_angle_to_b&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_track_initial_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;initial_orbital_magnetic_moment&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;orbital_magnetic_moment&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_track_initial_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;final_time&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;time&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_track_final_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;final_position&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;position&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_track_final_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;final_momentum&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;momentum&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_track_final_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;final_magnetic_field&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;magnetic_field&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_track_final_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;final_electric_field&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;electric_field&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_track_final_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;final_electric_potential&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;electric_potential&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_track_final_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;final_kinetic_energy&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;kinetic_energy_ev&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_track_final_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;final_polar_angle_to_z&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;polar_angle_to_z&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_track_final_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;final_azimuthal_angle_to_x&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;azimuthal_angle_to_x&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_track_final_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;final_polar_angle_to_b&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;polar_angle_to_b&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_track_final_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;final_orbital_magnetic_moment&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;orbital_magnetic_moment&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;component_track_final_particle&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_member</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;z_length_internal&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;continuous_length&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;track&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">component_integral</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;z_length_integral&quot;</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;z_length&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">ks_component_group</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="propagation">
<h2>Propagation<a class="headerlink" href="#propagation" title="Permalink to this headline">¶</a></h2>
<p>The propagation section is used to describe the physical process which is associated
with the movement of a particle, and also the means by which the equations of motion are solved.
The equations of motions are solved numerically with various control methods for the time step
used during integration of a specific particle trajectory. The
abstract base class of all particle trajectories is <a class="reference external" href="././_static/html/classKassiopeia_1_1KSTrajectory.html">KSTrajectory</a>.</p>
<p>There are essential four different equations of motion (trajectories) available for particle tracking in <em>Kassiopeia</em>.
These are, exact, adiabatic, electric, and magnetic.</p>
<p>The first trajectory type is the so-called exact method, which solves the Lorentz equation for charged
particles exactly without approximations. The second method is the adiabatic method, which is useful
for solving charged particle motion in the presence of smoothly varying magnetic fields. The last two
types, electric and magnetic, are used for tracing the field lines of static electric and
magnetic fields respectively.</p>
<p>The exact tracking method can be used where accuracy is of the utmost importance, but requires
a large number of steps in order propagate a particle for a long time or distance. An example
of its use is given below:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">kstraj_trajectory_exact</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;trajectory_exact&quot;</span> <span class="n">attempt_limit</span><span class="o">=</span><span class="s">&quot;8&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">interpolator_crk</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;interpolator_crk&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">integrator_rkdp853</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;integrator_rkdp853&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">term_propagation</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;term_propagation&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">control_position_error</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;control_position_error&quot;</span> <span class="n">absolute_position_error</span><span class="o">=</span><span class="s">&quot;1e-12&quot;</span> <span class="n">safety_factor</span><span class="o">=</span><span class="s">&quot;0.75&quot;</span> <span class="n">solver_order</span><span class="o">=</span><span class="s">&quot;8&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">control_length</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;stepsizelength&quot;</span> <span class="n">length</span><span class="o">=</span><span class="s">&quot;1e-4&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">control_time</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;stepsizetime&quot;</span> <span class="n">time</span><span class="o">=</span><span class="s">&quot;1e-6&quot;</span> <span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">kstraj_trajectory_exact</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>In the above example, the integrator type specified <code class="docutils literal"><span class="pre">integrator_rkdp853</span></code> is an 8-th order Runge-Kutta
integrator with a 7-th order dense output interpolant (specified by <code class="docutils literal"><span class="pre">interpolator_crk</span></code>). The step-size
control is accomplished through the combination of three different methods. Two of them <code class="docutils literal"><span class="pre">control_length</span></code>
and <code class="docutils literal"><span class="pre">control_time</span></code> place a fixed limit on the step-size, while the third <code class="docutils literal"><span class="pre">control_position_error</span></code> dynamically
attempts to limit the local numerical error on the particle&#8217;s position below some limit.</p>
<p>All of the trajectories take an optional parameter <code class="docutils literal"><span class="pre">attempt_limit</span></code> which limits the
number of tries an integration step will be re-attempted if a step-size control determines
that the step has failed. The default number of maximum number of attempts is 32. If a trajectory
makes no progress after the maximum number of allowed attempts, the track will be terminated
with a <code class="docutils literal"><span class="pre">trajectory_fail</span></code> flag.</p>
<p>An example of the adiabatic trajectory is specified in the following:</p>
<div class="highlight-default"><div class="highlight"><pre>&lt;!--  adiabatic trajectory --&gt;
&lt;kstraj_trajectory_adiabatic name=&quot;trajectory_adiabatic&quot; piecewise_tolerance=&quot;1e-6&quot; max_segments=&quot;130&quot; use_true_position=&quot;true&quot; cyclotron_fraction=&quot;{1.0/64.0}&quot; attempt_limit=&quot;8&quot;&gt;
    &lt;interpolator_crk name=&quot;interpolator_crk&quot;/&gt;
    &lt;integrator_rkdp853 name=&quot;integrator_rkdp853&quot;/&gt;
    &lt;term_propagation name=&quot;term_propagation&quot;/&gt;
    &lt;term_drift name=&quot;term_drift&quot;/&gt;
    &lt;term_gyration name=&quot;term_gyration&quot;/&gt;
    &lt;control_time name=&quot;control_time_adiab&quot; time=&quot;1e-6&quot;/&gt;
    &lt;control_position_error name=&quot;control_position_error&quot; absolute_position_error=&quot;1e-9&quot; safety_factor=&quot;0.75&quot; solver_order=&quot;8&quot;/&gt;
&lt;/kstraj_trajectory_adiabatic&gt;
</pre></div>
</div>
<p>In this example, both the motion of the particle&#8217;s guiding center drift (<code class="docutils literal"><span class="pre">term_drift</span></code>) and the
particle&#8217;s local gyration (<code class="docutils literal"><span class="pre">term_gyration</span></code>) itself are included in the equations of motion and computed.
It is important to note that the adiabatic trajectory cannot be use if there is no magnetic field present.</p>
<p>The last two trajectory types can be specfified as follows:</p>
<div class="highlight-default"><div class="highlight"><pre>&lt;!--  magnetic trajectory --&gt;
&lt;kstraj_trajectory_magnetic name=&quot;trajectory_magnetic&quot; piecewise_tolerance=&quot;1e-12&quot; max_segments=&quot;128&quot;&gt;
    &lt;interpolator_crk name=&quot;interpolator_crk&quot;/&gt;
    &lt;integrator_rkdp54 name=&quot;integrator_rkdp54&quot;/&gt;
    &lt;term_propagation name=&quot;term_propagation&quot; direction=&quot;forward&quot;/&gt;
    &lt;control_time name=&quot;control_time&quot; time=&quot;1.e-4&quot;/&gt;
    &lt;control_length name=&quot;control_length&quot; length=&quot;1e-2&quot;/&gt;
&lt;/kstraj_trajectory_magnetic&gt;

&lt;!--  electric trajectory --&gt;
&lt;kstraj_trajectory_electric name=&quot;trajectory_electric&quot; piecewise_tolerance=&quot;1e-12&quot; max_segments=&quot;128&quot;&gt;
    &lt;interpolator_crk name=&quot;interpolator_crk&quot;/&gt;
    &lt;integrator_rkdp54 name=&quot;integrator_rkdp54&quot;/&gt;
    &lt;term_propagation name=&quot;term_propagation&quot; direction=&quot;backward&quot;/&gt;
    &lt;control_time name=&quot;control_time&quot; time=&quot;1.e-4&quot;/&gt;
    &lt;control_length name=&quot;control_length&quot; length=&quot;1e-2&quot;/&gt;
&lt;/kstraj_trajectory_electric&gt;
</pre></div>
</div>
<p>The electric and magnetic field line trajectories are useful for visualization and during
the design stages of an experiment or simulation. Note that in the above examples we have used a faster but less
accurate Runge-Kutta integrator <code class="docutils literal"><span class="pre">integrator_rkdp54</span></code>. The property <code class="docutils literal"><span class="pre">direction</span></code> in <code class="docutils literal"><span class="pre">term_propagation</span></code>
can be used to specify the direction in which field lines are tracked (positive-to-negative or north-to-south).</p>
<p>In all of the trajectories (exact, adiabatic, electric, magnetic) the parameters <code class="docutils literal"><span class="pre">piecewise_tolerance</span></code> and <code class="docutils literal"><span class="pre">max_segments</span></code> are optional.
They dictate how a particles trajectory (in between steps) should be approximated by piecewise linear segments
when determining surface and volume intersections. These parameters are only used
when the <code class="docutils literal"><span class="pre">ksnav_meshed_space</span></code> navigator is in use, and determine how accurately intersections
are found. The default <code class="docutils literal"><span class="pre">ksnav_space</span></code> navigator ignores these parameters, since it
uses a faster but less accurate approximation by linearly interpolating a
particle&#8217;s intermediate state and position.</p>
<p>The adiabatic trajectory also takes the additional parameters
<code class="docutils literal"><span class="pre">use_true_position</span></code> and <code class="docutils literal"><span class="pre">cyclotron_fraction</span></code> when the <code class="docutils literal"><span class="pre">mesh_spaced_navigator</span></code>
is in use. The parameter <code class="docutils literal"><span class="pre">use_true_position</span></code> determines whether the particle or its
guiding center position is used for the purpose of finding intersections. If the particle&#8217;s
true position is used, then the parameter <code class="docutils literal"><span class="pre">cyclotron_fraction</span></code> dictates the number of linear
segments the semi-helical path is broken into.</p>
</div>
<div class="section" id="navigation">
<h2>Navigation<a class="headerlink" href="#navigation" title="Permalink to this headline">¶</a></h2>
<p>The navigation of a particle is split into two components, surface navigation and space
navigation. Surface navigation is very simple and only takes place when a particle
has intersected an active surface. The surface navigator determines whether the state
of the particle is modified on the surface and whether it is reflected or transmitted.
It is very simple and can be made available for use with the declaration:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">ksnav_surface</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;nav_surface&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>The space navigator more complex since it is responsible for determine the location of the particle
and any possible intersections it may have with real of virtual boundaries. It
is also responsible for ensuring that the current simulation state matches the configuration
specified by the user. The spaces that the navigator considers may be real objects (such as a vacuum chamber wall) or
virtual (which only modify the state of the simulation, e.g. exchanging a trajectory method).</p>
<p>For space navigation there are two options. The first is the default <code class="docutils literal"><span class="pre">ksnav_space</span></code> navigator
which can be specified as below:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">ksnav_space</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;nav_space&quot;</span> <span class="n">enter_split</span><span class="o">=</span><span class="s">&quot;false&quot;</span> <span class="n">exit_split</span><span class="o">=</span><span class="s">&quot;false&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>As this navigator is very simple, it does not take many additional parameters.
The parameters <code class="docutils literal"><span class="pre">enter_split</span></code> and <code class="docutils literal"><span class="pre">exit_split</span></code> determine whether or not a track
is split in two (for the purposes of output/saving data) upon entrance or exit of a geometric space.</p>
<p>The second is the <code class="docutils literal"><span class="pre">ksnav_meshed_space</span></code> navigator which is intended to be used
in complex three-dimensional geometries where it has better performance over the default navigator.
An example of this is shown in the PhotoMultplierTube.xml file. Its configuration is somewhat
more complicated as it performs the navigations on the meshed boundaries of spaces and surfaces.
This navigation method requires the construction of an octree spatial partition (which is cached for later
re-use). The use must specify the depth of the octree (<code class="docutils literal"><span class="pre">max_octree_depth</span></code>) and the number of elements
allowed in a octree node before a subdivision is required (<code class="docutils literal"><span class="pre">n_allowed_elements</span></code>). In addition,
the root of the geometry tree must also be specified with the parameter <code class="docutils literal"><span class="pre">root_space</span></code>,
this is typically the world volume:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">ksnav_meshed_space</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;nav_meshed_space&quot;</span> <span class="n">root_space</span><span class="o">=</span><span class="s">&quot;space_world&quot;</span> <span class="n">max_octree_depth</span><span class="o">=</span><span class="s">&quot;9&quot;</span> <span class="n">n_allowed_elements</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>Though they are not shown (they default to false) the exit and entrance split
parameters may also be set for the <code class="docutils literal"><span class="pre">ksnav_meshed_space</span></code> navigator.
Because the <code class="docutils literal"><span class="pre">ksnav_meshed_space</span></code> navigator requires a boundary mesh in
order to operate, all geometric objects (spaces, sufaces)
which have navigation commands attached to them must also have a mesh extension in the geometry specification.
Furthermore, since <code class="docutils literal"><span class="pre">ksnav_meshed_space</span></code> requires access to the root space <code class="docutils literal"><span class="pre">space_world</span></code>
and all of the navigation commands associated with the shapes it contains,
it must be declared after the definition of the simulation command structure element <code class="docutils literal"><span class="pre">ksgeo_space</span></code>.</p>
</div>
<div class="section" id="navigation-and-commands">
<h2>Navigation and Commands<a class="headerlink" href="#navigation-and-commands" title="Permalink to this headline">¶</a></h2>
<p>The commands which are associated with particular surfaces and spaces are what governs
the state of a <em>Kassiopeia</em> simulation as a particle is tracked. They are declared
through the specification of a <code class="docutils literal"><span class="pre">ksgeo_space</span></code>. A very simple example of the declaration
of the command structure can be seen in the DipoleTrapSimulation.xml as shown below:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">ksgeo_space</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;space_world&quot;</span> <span class="n">spaces</span><span class="o">=</span><span class="s">&quot;world&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">command</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;root_terminator&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;add_terminator&quot;</span> <span class="n">child</span><span class="o">=</span><span class="s">&quot;term_max_steps&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">command</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;root_terminator&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;remove_terminator&quot;</span> <span class="n">child</span><span class="o">=</span><span class="s">&quot;term_world&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">command</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;write_root&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;add_track_output&quot;</span> <span class="n">child</span><span class="o">=</span><span class="s">&quot;component_track_world&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">command</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;write_root&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;add_step_output&quot;</span> <span class="n">child</span><span class="o">=</span><span class="s">&quot;component_step_world&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">geo_surface</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;surface_upstream_target&quot;</span> <span class="n">surfaces</span><span class="o">=</span><span class="s">&quot;world/dipole_trap/upstream_target&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">command</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;root_terminator&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;add_terminator&quot;</span> <span class="n">child</span><span class="o">=</span><span class="s">&quot;term_upstream_target&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">geo_surface</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">geo_surface</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;surface_downstream_target&quot;</span> <span class="n">surfaces</span><span class="o">=</span><span class="s">&quot;world/dipole_trap/downstream_target&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">command</span> <span class="n">parent</span><span class="o">=</span><span class="s">&quot;root_terminator&quot;</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;add_terminator&quot;</span> <span class="n">child</span><span class="o">=</span><span class="s">&quot;term_downstream_target&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">geo_surface</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">geo_surface</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;surface_center&quot;</span> <span class="n">surfaces</span><span class="o">=</span><span class="s">&quot;world/dipole_trap/center&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">ksgeo_space</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>In this example we create a <code class="docutils literal"><span class="pre">ksgeo_space</span></code> navigation space using the <code class="docutils literal"><span class="pre">world</span></code> space
geometric object. Inside of this world volume we declare a series of command which will be
executed any time a particle enters or is initialized within the world volume. The first two
commands add and remove specific terminators, while the next two declare what sort of output
should be written down within the world volume. Following that, there are commands which are
attached to specific surfaces which are present. For example, attaching the terminator <code class="docutils literal"><span class="pre">term_upstream_target</span></code>
ensures that a particle impinging on the surface <code class="docutils literal"><span class="pre">surface_upstream_target</span></code> will be killed.
Commands can used to change the active field calculation method,
swap trajectory types, or add/remove interactions, etc. Various spaces and
their associated commands can be nested within each other allowing for a very
flexible and dynamic simulation configuration.</p>
</div>
<div class="section" id="simulation">
<h2>Simulation<a class="headerlink" href="#simulation" title="Permalink to this headline">¶</a></h2>
<p>The final object to be declared within <code class="docutils literal"><span class="pre">&lt;kassiopeia&gt;</span></code> is the simulation element. This describes
the simulation object <a class="reference external" href="././_static/html/classKassiopeia_1_1KSSimulation.html">KSSimulation</a>, which is then executed by <a class="reference external" href="././_static/html/classKassiopeia_1_1KSRoot.html">KSRoot</a>.
The simulation element specifies the global and initial properties of the simulation as a whole.
For example in the QuadrupoleTrapSimulation.xml example, the simulation element
is declared as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">ks_simulation</span>
    <span class="n">name</span><span class="o">=</span><span class="s">&quot;quadrupole_trap_simulation&quot;</span>
    <span class="n">run</span><span class="o">=</span><span class="s">&quot;1&quot;</span>
    <span class="n">seed</span><span class="o">=</span><span class="s">&quot;51385&quot;</span>
    <span class="n">events</span><span class="o">=</span><span class="s">&quot;10&quot;</span>
    <span class="n">magnetic_field</span><span class="o">=</span><span class="s">&quot;field_electromagnet&quot;</span>
    <span class="n">electric_field</span><span class="o">=</span><span class="s">&quot;field_electrostatic&quot;</span>
    <span class="n">space</span><span class="o">=</span><span class="s">&quot;space_world&quot;</span>
    <span class="n">generator</span><span class="o">=</span><span class="s">&quot;generator_uniform&quot;</span>
    <span class="n">trajectory</span><span class="o">=</span><span class="s">&quot;trajectory_exact&quot;</span>
    <span class="n">space_navigator</span><span class="o">=</span><span class="s">&quot;nav_space&quot;</span>
    <span class="n">surface_navigator</span><span class="o">=</span><span class="s">&quot;nav_surface&quot;</span>
    <span class="n">writer</span><span class="o">=</span><span class="s">&quot;write_root&quot;</span>
<span class="o">/&gt;</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">run</span></code> is simply a user provided identifier. The <code class="docutils literal"><span class="pre">seed</span></code> is the value provided to
the global (singleton) random number generator. Simulations with the same configuration and same seed
should provide identical results. If the user is interested in running <em>Kassiopeia</em> on many machines
in order to achieve high throughput particle tracking,
care must be taken to ensure that the <code class="docutils literal"><span class="pre">seed</span></code> value is different
for each run of the simulation. The parameter <code class="docutils literal"><span class="pre">events</span></code> determines the total number of times that
the generator is run (but this is not necessarily the number of particles that will be tracked).
The remaining parameters <code class="docutils literal"><span class="pre">magnetic_field</span></code>, <code class="docutils literal"><span class="pre">space</span></code>, <code class="docutils literal"><span class="pre">generator</span></code>, etc. all specify the default
objects to be used for the initial state of the simulation (commands specified within <code class="docutils literal"><span class="pre">ksgeo_space</span></code>)
may modify the actual objects used during the course of a simulation.</p>
<p>Following the declaration of <code class="docutils literal"><span class="pre">ks_simulation</span></code>, the closing tag <code class="docutils literal"><span class="pre">&lt;/kassiopeia&gt;</span></code> is placed
to complete the simulation configuration. When this tag is encountered by the XML parser, it triggers
the simulation to run.</p>
</div>
<div class="section" id="visualization">
<h2>Visualization<a class="headerlink" href="#visualization" title="Permalink to this headline">¶</a></h2>
<p>If <em>Kassiopeia</em> has been linked against, simple visualization of the simulation may be made available.
By adding the <cite>vtk_window</cite> tag we enable a VTK window that will open when the simulation is complete.
This element needs a <code class="docutils literal"><span class="pre">vtk_geometry_painter</span></code> and the <code class="docutils literal"><span class="pre">`vtk_track_painter</span></code> to draw the geometry
and tracks, respectively. An example of this type of visualization from the
QuadurpoleTrapSimulation.xml file is a follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">vtk_window</span>
    <span class="n">name</span><span class="o">=</span><span class="s">&quot;vtk_window&quot;</span>
    <span class="n">enable_display</span><span class="o">=</span><span class="s">&quot;true&quot;</span>
    <span class="n">enable_write</span><span class="o">=</span><span class="s">&quot;true&quot;</span>
    <span class="n">frame_title</span><span class="o">=</span><span class="s">&quot;KGeoBag Visualization&quot;</span>
    <span class="n">frame_size_x</span><span class="o">=</span><span class="s">&quot;1024&quot;</span>
    <span class="n">frame_size_y</span><span class="o">=</span><span class="s">&quot;768&quot;</span>
    <span class="n">frame_color_red</span><span class="o">=</span><span class="s">&quot;.2&quot;</span>
    <span class="n">frame_color_green</span><span class="o">=</span><span class="s">&quot;.2&quot;</span>
    <span class="n">frame_color_blue</span><span class="o">=</span><span class="s">&quot;.2&quot;</span>
    <span class="n">view_angle</span><span class="o">=</span><span class="s">&quot;45&quot;</span>
    <span class="n">eye_angle</span><span class="o">=</span><span class="s">&quot;0.5&quot;</span>
    <span class="n">multi_samples</span><span class="o">=</span><span class="s">&quot;4&quot;</span>
    <span class="n">depth_peeling</span><span class="o">=</span><span class="s">&quot;10&quot;</span>
<span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">vtk_geometry_painter</span>
        <span class="n">name</span><span class="o">=</span><span class="s">&quot;geometry_painter&quot;</span>
        <span class="n">surfaces</span><span class="o">=</span><span class="s">&quot;world/quadrupole_trap/#&quot;</span>
    <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">vtk_track_painter</span>
        <span class="n">name</span><span class="o">=</span><span class="s">&quot;track_painter&quot;</span>
        <span class="n">path</span><span class="o">=</span><span class="s">&quot;[output_path]&quot;</span>
        <span class="n">file</span><span class="o">=</span><span class="s">&quot;QuadrupoleTrapSimulation.root&quot;</span>
        <span class="n">point_object</span><span class="o">=</span><span class="s">&quot;component_step_world&quot;</span>
        <span class="n">point_variable</span><span class="o">=</span><span class="s">&quot;position&quot;</span>
        <span class="n">color_object</span><span class="o">=</span><span class="s">&quot;component_step_cell&quot;</span>
        <span class="n">color_variable</span><span class="o">=</span><span class="s">&quot;polar_angle_to_b&quot;</span>
    <span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">vtk_window</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Note that the visualization window must be placed outside of the <code class="docutils literal"><span class="pre">&lt;kassiopeia&gt;</span></code>...``&lt;/kassiopiea&gt;``
environment tags.</p>
</div>
<div class="section" id="common-pitfalls-and-problems">
<h2>Common Pitfalls and Problems<a class="headerlink" href="#common-pitfalls-and-problems" title="Permalink to this headline">¶</a></h2>
<p>The XML parse does have some ability to recognize simple errors in a configuration file
and will generally report the location of an element which it is not able to process.</p>
<p>Some errors which might occur if a file is improperly configured are:</p>
<ul class="simple">
<li>Multiple objects which share the same name at the same scope.</li>
<li>Misspelled element types.</li>
<li>Missing closing brackets.</li>
<li>Undefined variables.</li>
<li>Undeclared (but used) elements.</li>
</ul>
<p>In the case of more than one copy of the same object with the name &lt;X&gt;, the XML parser will fail with
with an error along the lines of:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="p">[</span><span class="n">INITIALIZATION</span> <span class="n">ERROR</span> <span class="n">MESSAGE</span><span class="p">]</span> <span class="n">Multiple</span> <span class="n">instances</span> <span class="n">of</span> <span class="nb">object</span> <span class="k">with</span> <span class="n">name</span> <span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;.</span>
</pre></div>
</div>
<p>In the case where an element&#8217;s type name is misspelled the parser will fail with
an unreconized element error. For example if we misspelled <code class="docutils literal"><span class="pre">ksterm_max_z</span></code> as <code class="docutils literal"><span class="pre">kterm_max_z</span></code>
we would recieve the following error:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="p">[</span><span class="n">INITIALIZATION</span> <span class="n">ERROR</span> <span class="n">MESSAGE</span><span class="p">]</span> <span class="n">nothing</span> <span class="n">registered</span> <span class="k">for</span> <span class="n">element</span> <span class="o">&lt;</span><span class="n">kterm_max_z</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="n">element</span> <span class="o">&lt;</span><span class="n">kassiopeia</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>If there is a mis-matched bracket the intialization will usually fail with an unrecongnized
character error, such as:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="p">[</span><span class="n">INITIALIZATION</span> <span class="n">ERROR</span> <span class="n">MESSAGE</span><span class="p">]</span> <span class="n">element</span> <span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;</span> <span class="n">encountered</span> <span class="n">an</span> <span class="n">error</span> <span class="o">&lt;</span><span class="n">got</span> <span class="n">unknown</span> <span class="n">character</span> <span class="o">&lt;&lt;&gt;&gt;</span>
</pre></div>
</div>
<p>If a variable &#8220;[X]&#8221; is used without being previously defined, and undefined error will be reported
as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="p">[</span><span class="n">INITIALIZATION</span> <span class="n">ERROR</span> <span class="n">MESSAGE</span><span class="p">]</span> <span class="n">variable</span> <span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">defined</span>
</pre></div>
</div>
<p>If there is an attempt to retrieve/reference and element which has not been declared the
the simulation will fail with the message:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="p">[</span><span class="n">INITIALIZATION</span> <span class="n">WARNING</span> <span class="n">MESSAGE</span><span class="p">]</span> <span class="n">No</span> <span class="n">suitable</span> <span class="n">Object</span> <span class="n">called</span> <span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="n">Toolbox</span>
</pre></div>
</div>
<p class="rubric">Footnotes</p>
<p>[1] Daniel Lawrence Furse. Techniques for direct neutrino mass measurement utilizing tritium [beta]-decay. PhD thesis, Massachusetts Institute of Technology, 2015.</p>
<p>[2] Thomas Corona. Methodology and application of high performance electrostatic field simulation in the KATRIN experiment. PhD thesis, University of North Carolina, Chapel Hill, 2014.</p>
<p>[3] John P. Barrett. A Spatially Resolved Study of the KATRIN Main Spectrometer Using a Novel Fast Multipole Method. PhD thesis, Massachusetts Institute of Technology, 2016.</p>
</div>
</div>


                </div>
              </div>
            </div>
          </div>
        </div>
        
        
      </div><!-- /row -->

      <!-- row -->
      <div class="row footer-relbar">
<div id="navbar-related" class=" related navbar navbar-default" role="navigation" aria-label="related navigation">
  <div class="navbar-inner">
    <ul class="nav navbar-nav ">
        <li><a href="index.html">Kassiopeia 3.3 documentation</a></li>
    </ul>
<ul class="nav navbar-nav pull-right hidden-xs hidden-sm">
      
        <li><a href="examples.html" title="Examples and Tests" >previous</a></li>
        <li><a href="kgeobag_basic.html" title="Basic Shapes in KGeoBag" >next</a></li>
        <li><a href="genindex.html" title="General Index" >index</a></li>
        <li><a href="#">top</a></li> 
      
    </ul>
  </div>
</div>
      </div><!-- /row -->

      <!-- footer -->
      <footer role="contentinfo">
          &copy; Copyright 2016, Daniel Furse, Stefan Groh, Nikolaus Trost, Martin Babutzka, John P. Barrett, Jan Behrens, Nicholas Buzinksy, Thomas Corona, Sanshiro Enomoto, Moritz Erhard, Joseph A. Formaggio, Ferenc Glueck, Fabian Harms, Florian Heizmann, Daniel Hilk, Wolfgang Kaefer, Marco Kleesiek, Benjamin Leiber, Susanne Mertens, Noah S. Oblath, Pascal Renschler, Johannes Schwarz, Penny L. Slocum, Nancy Wandkowsky, Kevin Wierman and Michael Zacher.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.8.
      </footer>
      <!-- /footer -->

    </div>
    <!-- /container -->

  </body>
</html>