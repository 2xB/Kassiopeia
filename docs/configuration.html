
  

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="utf-8" />
    
      <title>Configuring Your Own Simulation | Kassiopeia 3.8 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" />
      <link rel="stylesheet" href="_static/theme.33684ae9923d01874503.css" />
      <link rel="stylesheet" href="_static/graphviz.css" />
        <link rel="search" title="Search" href="search.html" />
        <link rel="index" title="Index" href="genindex.html" />
        <link rel="next" title="Basic Shapes in KGeoBag" href="kgeobag_basic.html" />
        <link rel="prev" title="Examples and Tests" href="examples.html" />
  </head>

  <body class="antialiased text-gray scroll-smooth">
    <div
      id="page"
      data-controller="sidebar search"
      data-action="keydown@window->search#focus"
      class="h-screen xl:grid xl:grid-layout"
    >
      <a class="block text-xl bg-white py-4 z-20 absolute top-0 h-14 inset-x-0 text-center transform -translate-y-full focus:translate-y-0 focus:outline-none transition-transform duration-75" href="#configuring-your-own-simulation" title="Skip navigation links">Skip to content</a>

      <header class="grid-area-header z-10 h-14">
        <div class="bg-gray-dark shadow-md flex items-center h-full xl:px-2 relative"><div class="flex items-center">
      <button
    data-action="sidebar#open"
    data-sidebar-target="hamburger"
    class="xl:hidden h-14 w-14 leading-14 text-gray-100 hover:bg-gray-700 hover:text-brand focus:outline-none focus:bg-gray-700 focus:text-brand">
  <span class="sr-only">Open navigation menu</span>
  <svg aria-hidden="true" class="fill-current h-8 w-8" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</button><a class="hover:bg-gray-700 focus:bg-gray-700 focus:outline-none tooltipped tooltipped-sw"
   href="index.html"
   aria-label="Back to homepage"><img class="h-14 w-14 p-3 inline-block" src="_static/KassiopeiaLogo_1_cropped_bb.png" alt="Logo" /><span class="hidden lg:inline-block shrink-0 font-medium text-gray-100 mx-5 leading-14 tracking-wider">Kassiopeia 3.8 documentation</span>
</a></div><div class="flex justify-end items-center flex-1"><form
  id="searchbox"
  action="search.html"
  data-action="click->search#focusSearchInput"
  method="get"
  class="flex print:hidden justify-between items-center leading-14 md:ml-4 bg-gray-dark text-gray-300 focus-within:bg-gray-50 focus-within:text-gray-800 focus-within:absolute focus-within:inset-x-0 focus-within:top-0 md:focus-within:w-full md:focus-within:static">

  <button
    class="text-inherit h-14 w-14"
    aria-label="Get search results"
    tabindex="-1"
  >
    <svg aria-hidden="true" class="fill-current stroke-current h-8 w-8" stroke-width="0.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
  </button>

  <input
    name="q"
    id="search-input"
    data-search-target="searchInput"
    type="search"
    aria-label="Search the docs"
    placeholder="Search the docs"
    class="pr-2 bg-transparent text-inherit focus:outline-none w-0 md:w-auto focus:w-full transition-all duration-100"
  />
</form></div>
</div>
      </header>

      
  <aside data-sidebar-target="sidebar" class="grid-area-sidebar h-full fixed xl:relative inset-y-0 left-0 z-20 xl:z-0 print:hidden overflow-y-auto transition-all transform transform-gpu -translate-x-full opacity-0 duration-300 xl:translate-x-0 xl:opacity-100">
    <nav
  role="navigation"
  class="h-full overflow-y-auto bg-white text-gray-600 pt-8 flex flex-col"
>
  <div class="nav-toc flex-1 pl-6"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html"> Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#the-kasper-framework">The Kasper framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#extending-functionality">Extending Functionality</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="external_documentation.html"> External Documentation, Citation and Contact</a><ul>
<li class="toctree-l2"><a class="reference internal" href="external_documentation.html#external-references">External references</a></li>
<li class="toctree-l2"><a class="reference internal" href="external_documentation.html#developer-contact">Developer contact</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="compiling.html"> Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="compiling.html#downloading-the-code">Downloading the code</a></li>
<li class="toctree-l2"><a class="reference internal" href="compiling.html#supported-operating-systems-and-hardware-requirements">Supported operating systems and hardware requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="compiling.html#docker-image">Docker image</a></li>
<li class="toctree-l2"><a class="reference internal" href="compiling.html#required-software-dependencies">Required software dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="compiling.html#minimum-requirements">Minimum requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="compiling.html#required-dependencies">Required dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="compiling.html#optional-dependencies">Optional dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="compiling.html#external-libraries">External libraries</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="compiling.html#compiling-the-code-using-cmake">Compiling the code using CMake</a><ul>
<li class="toctree-l3"><a class="reference internal" href="compiling.html#environment-variables">Environment variables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="compiling.html#directory-structure-and-environmental-variables">Directory structure and environmental variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="compiling.html#executing-kassiopeia">Executing Kassiopeia</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="compiling.html#configuring-optional-dependencies">Configuring optional dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="compiling.html#build-options">Build options</a></li>
<li class="toctree-l3"><a class="reference internal" href="compiling.html#kassiopeia-module">Kassiopeia module</a></li>
<li class="toctree-l3"><a class="reference internal" href="compiling.html#kemfield-module">KEMField module</a></li>
<li class="toctree-l3"><a class="reference internal" href="compiling.html#kgeobag-module">KGeoBag module</a></li>
<li class="toctree-l3"><a class="reference internal" href="compiling.html#kommon-module">Kommon module</a></li>
<li class="toctree-l3"><a class="reference internal" href="compiling.html#miscellaneous-options">Miscellaneous options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html"> Examples and Tests</a><ul>
<li class="toctree-l2"><a class="reference internal" href="examples.html#running-kassiopeia">Running Kassiopeia</a><ul>
<li class="toctree-l3"><a class="reference internal" href="examples.html#verbosity-levels">Verbosity levels</a></li>
<li class="toctree-l3"><a class="reference internal" href="examples.html#output-files">Output files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#example-configurations">Example configurations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="examples.html#the-dipole-trap-example">The Dipole Trap Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="examples.html#the-quadrupole-trap-example">The Quadrupole Trap Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="examples.html#the-photomultiplier-tube-example">The Photomultiplier Tube Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="examples.html#the-mesh-simulation-example">The Mesh Simulation Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="examples.html#other-examples">Other Examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"> Configuring Your Own Simulation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview-and-units">Overview and Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="#xml-parsing-and-features">XML Parsing and Features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#variables">Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#including-external-files">Including external files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#print-statements">Print statements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#formula-expressions">Formula Expressions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#conditional-expressions-and-looping">Conditional Expressions and Looping</a></li>
<li class="toctree-l3"><a class="reference internal" href="#comments">Comments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#messaging-system">Messaging System</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#verbosity-levels">Verbosity levels</a></li>
<li class="toctree-l3"><a class="reference internal" href="#additional-logging">Additional logging</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#geometry">Geometry</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#shapes-and-assemblies">Shapes and assemblies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tagging-system">Tagging system</a></li>
<li class="toctree-l3"><a class="reference internal" href="#assembling-elements">Assembling elements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transformations">Transformations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#extensions">Extensions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#kemfield">KEMField</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fields">Fields</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#electric">Electric</a></li>
<li class="toctree-l3"><a class="reference internal" href="#magnetic">Magnetic</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#kassiopeia">Kassiopeia</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generation">Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#termination">Termination</a></li>
<li class="toctree-l2"><a class="reference internal" href="#propagation">Propagation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#interactions">Interactions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#volume-interactions">Volume Interactions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#surface-interactions">Surface Interactions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#output">Output</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#writers">Writers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#output-description">Output description</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#navigation">Navigation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#navigation-and-commands">Navigation and Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simulation">Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#visualization">Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#common-pitfalls-and-problems">Common Pitfalls and Problems</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="kgeobag_basic.html"> Basic KGeoBag Shapes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="kgeobag_basic.html#basic-elements">Basic elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="kgeobag_basic.html#poly-loop">Poly-loop</a></li>
<li class="toctree-l2"><a class="reference internal" href="kgeobag_basic.html#poly-line">Poly-line</a></li>
<li class="toctree-l2"><a class="reference internal" href="kgeobag_basic.html#surfaces">Surfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#flattened-circle-surface">Flattened circle surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#flattened-poly-loop-surface">Flattened poly-loop surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#rotated-surfaces">Rotated Surfaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#rotated-line-segment-surface">Rotated line segment surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#rotated-arc-segment-surface">Rotated arc segment surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#rotated-poly-line-surface">Rotated poly-line surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#rotated-circle-surface">Rotated circle surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#rotated-poly-loop-surface">Rotated poly loop surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#shell-surfaces">Shell Surfaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#shell-line-segment-surface">Shell line segment surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#shell-arc-segment-surface">Shell arc segment surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#shell-poly-line-surface">Shell poly-line surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#shell-circle-surface">Shell circle surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#shell-poly-loop-surface">Shell poly-loop surface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="kgeobag_basic.html#extruded-surfaces">Extruded Surfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#extruded-poly-line-surface">Extruded poly-line surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#extruded-circle-surface">Extruded circle surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#extruded-poly-loop-surface">Extruded poly-loop surface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="kgeobag_basic.html#special-surfaces">Special Surfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#disk-surface">Disk surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#annulus-surface">Annulus surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#cylinder-surface">Cylinder surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#cone-surface">Cone Surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#cut-cone-surface">Cut Cone Surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#torus-surface">Torus Surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#cut-torus-surface">Cut Torus Surface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="kgeobag_basic.html#spaces">Spaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="kgeobag_basic.html#extruded-spaces">Extruded Spaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#extruded-circle-space">Extruded Circle Space</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#extruded-poly-loop-space">Extruded Poly-Loop Space</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="kgeobag_basic.html#rotated-spaces">Rotated Spaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#rotated-line-segment">Rotated Line Segment</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#rotated-arc-segment">Rotated Arc Segment</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#rotated-poly-line-space">Rotated Poly-Line Space</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#rotated-circle-space">Rotated Circle Space</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#rotated-poly-loop-space">Rotated Poly-Loop Space</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="kgeobag_basic.html#special-spaces">Special Spaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#cylinder-space">Cylinder Space</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#cone-space">Cone Space</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#cut-cone-space">Cut Cone Space</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#torus-space">Torus Space</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#cylinder-tube-space">Cylinder Tube Space</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#cut-cone-tube-space">Cut Cone Tube Space</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_basic.html#box-space">Box Space</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="kgeobag_complex.html">Complex Shapes in KGeoBag</a><ul>
<li class="toctree-l2"><a class="reference internal" href="kgeobag_complex.html#surfaces">Surfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_complex.html#pump-port">Pump Port</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_complex.html#conic-section-pump-port">Conic section pump port</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_complex.html#beam">Beam</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_complex.html#rod">Rod</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_complex.html#extruded-surfaces-with-holes">Extruded surfaces with holes</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_complex.html#rotated-surface">Rotated surface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="kgeobag_complex.html#spaces">Spaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_complex.html#pump-port-space">Pump Port Space</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_complex.html#conic-section-pump-port-space">Conic Section Pump Port Space</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_complex.html#beam-space">Beam Space</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_complex.html#rod-space">Rod Space</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_complex.html#extruded-space">Extruded Space</a></li>
<li class="toctree-l3"><a class="reference internal" href="kgeobag_complex.html#rotated-space">Rotated Space</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="kgeobag_complex.html#external-shapes-in-kgeobag">External Shapes in KGeoBag</a></li>
<li class="toctree-l1"><a class="reference internal" href="output.html"> Understanding Simulation Output</a><ul>
<li class="toctree-l2"><a class="reference internal" href="output.html#output-configuration">Output configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="output.html#groups-and-fields">Groups and fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="output.html#output-structure">Output structure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="output.html#root-output-files">ROOT output files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="output.html#data-structure">Data structure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="output.html#accessing-simulation-data">Accessing simulation data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="output.html#using-kassiopeia">Using Kassiopeia</a></li>
<li class="toctree-l3"><a class="reference internal" href="output.html#using-root">Using ROOT</a></li>
<li class="toctree-l3"><a class="reference internal" href="output.html#using-python">Using Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="output.html#kassiopeiareader">KassiopeiaReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="output.html#uproot-pandas">uproot / Pandas</a></li>
<li class="toctree-l3"><a class="reference internal" href="output.html#python-notebook">Python notebook</a></li>
<li class="toctree-l3"><a class="reference internal" href="output.html#geometry-visualization">Geometry visualization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="output.html#vtk-output-files">VTK output files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="output.html#id13">Data structure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="output.html#id14">Accessing simulation data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="output.html#using-paraview">Using ParaView</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="output.html#ascii-output-files">ASCII output files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tools.html"> Additional Simulation Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tools.html#geometry-viewers">Geometry viewers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools.html#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#advanced-visualization">Advanced visualization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#mesh-viewers">Mesh viewers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id1">Usage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#field-calculation">Field calculation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id2">Usage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#simulation-tools">Simulation tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="visualization.html"> Visualization Techniques</a><ul>
<li class="toctree-l2"><a class="reference internal" href="visualization.html#kgeobag-visualization">KGeoBag visualization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="visualization.html#python">Python</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="visualization.html#kassiopieia-visualization">Kassiopieia visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="visualization.html#kemfield-visualization">KEMField visualization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="visualization.html#field-maps">Field maps</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="bindings_full.html"> XML Bindings</a><ul>
<li class="toctree-l2"><a class="reference internal" href="bindings_full.html#kapplicationrunner">KApplicationRunner</a><ul>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#knamedreference">KNamedReference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="bindings_full.html#kdummyrandom">KDummyRandom</a></li>
<li class="toctree-l2"><a class="reference internal" href="bindings_full.html#kemroot">KEMRoot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kelectricquadrupolefield">KElectricQuadrupoleField</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kelectrostaticconstantfield">KElectrostaticConstantField</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kelectrostaticlinearfield">KElectrostaticLinearField</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kelectrostaticpotentialmap">KElectrostaticPotentialmap</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kelectrostaticpotentialmapcalculator">KElectrostaticPotentialmapCalculator</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgstaticelectromagnetfield">KGStaticElectromagnetField</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kinducedazimuthalelectricfield">KInducedAzimuthalElectricField</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kmagneticdipolefield">KMagneticDipoleField</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kmagneticsuperpositionfield">KMagneticSuperpositionField</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kmagnetostaticconstantfield">KMagnetostaticConstantField</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kmagnetostaticfieldmap">KMagnetostaticFieldmap</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kmagnetostaticfieldmapcalculator">KMagnetostaticFieldmapCalculator</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#krampedelectric2field">KRampedElectric2Field</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#krampedelectricfield">KRampedElectricField</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#krampedmagneticfield">KRampedMagneticField</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="bindings_full.html#kggeometryprinter">KGGeometryPrinter</a></li>
<li class="toctree-l2"><a class="reference internal" href="bindings_full.html#kginterface">KGInterface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgannulussurface">KGAnnulusSurface</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgappearanceattributor">KGAppearanceAttributor</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgaxialmeshattributor">KGAxialMeshAttributor</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgboxspace">KGBoxSpace</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgconespace">KGConeSpace</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgconesurface">KGConeSurface</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgcutconespace">KGCutConeSpace</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgcutconesurface">KGCutConeSurface</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgcutconetubespace">KGCutConeTubeSpace</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgcuttorussurface">KGCutTorusSurface</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgcylinderspace">KGCylinderSpace</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgcylindersurface">KGCylinderSurface</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgcylindertubespace">KGCylinderTubeSpace</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgdiscreterotationalmeshattributor">KGDiscreteRotationalMeshAttributor</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgdisksurface">KGDiskSurface</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgelectromagnetattributor">KGElectromagnetAttributor</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgextrudedarcsegmentsurface">KGExtrudedArcSegmentSurface</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgextrudedcirclespace">KGExtrudedCircleSpace</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgextrudedcirclesurface">KGExtrudedCircleSurface</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgextrudedlinesegmentsurface">KGExtrudedLineSegmentSurface</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgextrudedpolylinesurface">KGExtrudedPolyLineSurface</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgextrudedpolyloopspace">KGExtrudedPolyLoopSpace</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgextrudedpolyloopsurface">KGExtrudedPolyLoopSurface</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgflattenedcirclesurface">KGFlattenedCircleSurface</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgflattenedpolyloopsurface">KGFlattenedPolyLoopSurface</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgmeshattributor">KGMeshAttributor</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgmeshdeformer">KGMeshDeformer</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgmeshrefiner">KGMeshRefiner</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgrotatedarcsegmentspace">KGRotatedArcSegmentSpace</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgrotatedarcsegmentsurface">KGRotatedArcSegmentSurface</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgrotatedcirclespace">KGRotatedCircleSpace</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgrotatedcirclesurface">KGRotatedCircleSurface</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgrotatedlinesegmentspace">KGRotatedLineSegmentSpace</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgrotatedlinesegmentsurface">KGRotatedLineSegmentSurface</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgrotatedpolylinespace">KGRotatedPolyLineSpace</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgrotatedpolylinesurface">KGRotatedPolyLineSurface</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgrotatedpolyloopspace">KGRotatedPolyLoopSpace</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgrotatedpolyloopsurface">KGRotatedPolyLoopSurface</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgshellarcsegmentsurface">KGShellArcSegmentSurface</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgshellcirclesurface">KGShellCircleSurface</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgshelllinesegmentsurface">KGShellLineSegmentSurface</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgshellpolylinesurface">KGShellPolyLineSurface</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgshellpolyloopsurface">KGShellPolyLoopSurface</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgspace">KGSpace</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgtorusspace">KGTorusSpace</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgtorussurface">KGTorusSurface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="bindings_full.html#kmessagetable">KMessageTable</a><ul>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kmessagedata">KMessageData</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="bindings_full.html#krootwindow">KROOTWindow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgrootgeometrypainter">KGROOTGeometryPainter</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#krootpad">KROOTPad</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id17">KSROOTMagFieldPainter</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id18">KSROOTPotentialPainter</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id19">KSROOTTrackPainter</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id20">KSROOTZonalHarmonicsPainter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="bindings_full.html#ksroot">KSRoot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kesselasticelsepa">KESSElasticElsepa</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kessinelasticbethefano">KESSInelasticBetheFano</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kessinelasticpenn">KESSInelasticPenn</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kesssurfaceinteraction">KESSSurfaceInteraction</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id21">KElectricQuadrupoleField</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id22">KElectrostaticConstantField</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id23">KElectrostaticPotentialmap</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id24">KInducedAzimuthalElectricField</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id25">KMagneticDipoleField</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id26">KMagnetostaticConstantField</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id27">KMagnetostaticFieldmap</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id28">KRampedElectric2Field</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id29">KRampedElectricField</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id30">KRampedMagneticField</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kscommandgroup">KSCommandGroup</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kscommandmemberdata">KSCommandMemberData</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kscomponentdeltadata">KSComponentDeltaData</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kscomponentintegraldata">KSComponentIntegralData</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kscomponentmathdata">KSComponentMathData</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kscomponentmaximumatdata">KSComponentMaximumAtData</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kscomponentmaximumdata">KSComponentMaximumData</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kscomponentmemberdata">KSComponentMemberData</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kscomponentminimumatdata">KSComponentMinimumAtData</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kscomponentminimumdata">KSComponentMinimumData</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksgendirectionsphericalcomposite">KSGenDirectionSphericalComposite</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksgendirectionsphericalmagneticfield">KSGenDirectionSphericalMagneticField</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksgendirectionsurfacecomposite">KSGenDirectionSurfaceComposite</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksgenenergybetadecay">KSGenEnergyBetaDecay</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksgenenergybetarecoil">KSGenEnergyBetaRecoil</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksgenenergycomposite">KSGenEnergyComposite</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksgenenergykryptonevent">KSGenEnergyKryptonEvent</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksgenenergyleadevent">KSGenEnergyLeadEvent</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksgenenergyradonevent">KSGenEnergyRadonEvent</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksgenenergyrydberg">KSGenEnergyRydberg</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksgengeneratorcomposite">KSGenGeneratorComposite</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksgengeneratorsimulation">KSGenGeneratorSimulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksgengeneratortextfile">KSGenGeneratorTextFile</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id73">KSGenLStatistical</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id74">KSGenLUniformMaxN</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id75">KSGenPositionHomogeneousFluxTube</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id76">KSGenPositionMeshSurfaceRandom</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id77">KSGenPositionSpaceRandom</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id78">KSGenPositionSurfaceAdjustmentStep</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id79">KSGenPositionSurfaceRandom</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id80">KSGenValueAngleCosine</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id81">KSGenValueAngleSpherical</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id82">KSGenValueBoltzmann</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id83">KSGenValueFix</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id84">KSGenValueFormula</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id85">KSGenValueGauss</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id86">KSGenValueGeneralizedGauss</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id87">KSGenValueHistogram</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id88">KSGenValueList</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id89">KSGenValuePareto</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksgenvalueradiuscylindrical">KSGenValueRadiusCylindrical</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksgenvalueradiusfraction">KSGenValueRadiusFraction</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksgenvalueradiusspherical">KSGenValueRadiusSpherical</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id90">KSGenValueSet</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id91">KSGenValueUniform</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksgenvaluezfrustrum">KSGenValueZFrustrum</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksgeoside">KSGeoSide</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksgeospace">KSGeoSpace</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksintcalculatorconstant">KSIntCalculatorConstant</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksintcalculatorion">KSIntCalculatorIon</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksintdecay">KSIntDecay</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id94">KSIntDecayCalculatorDeathConstRate</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id95">KSIntDecayCalculatorFerencBBRTransition</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id96">KSIntDecayCalculatorFerencIonisation</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id97">KSIntDecayCalculatorFerencSpontaneous</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id98">KSIntDecayCalculatorGlukhovDeExcitation</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id99">KSIntDecayCalculatorGlukhovExcitation</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id100">KSIntDecayCalculatorGlukhovIonisation</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#id101">KSIntDecayCalculatorGlukhovSpontaneous</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksintdensityconstant">KSIntDensityConstant</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksintscattering">KSIntScattering</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksintspinflip">KSIntSpinFlip</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksintspinflippulse">KSIntSpinFlipPulse</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksintspinrotateypulse">KSIntSpinRotateYPulse</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksintsurfacediffuse">KSIntSurfaceDiffuse</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksintsurfacemultiplication">KSIntSurfaceMultiplication</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksintsurfacespecular">KSIntSurfaceSpecular</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksintsurfacespinflip">KSIntSurfaceSpinFlip</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksintsurfaceucn">KSIntSurfaceUCN</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksmoddynamicenhancement">KSModDynamicEnhancement</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksmodeventreport">KSModEventReport</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksmodsplitonturn">KSModSplitOnTurn</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksnavmeshedspace">KSNavMeshedSpace</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksnavspace">KSNavSpace</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksnavsurface">KSNavSurface</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksrootelectricfield">KSRootElectricField</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksrooteventmodifier">KSRootEventModifier</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksrootgenerator">KSRootGenerator</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksrootmagneticfield">KSRootMagneticField</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksrootrunmodifier">KSRootRunModifier</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksrootspaceinteraction">KSRootSpaceInteraction</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksrootspacenavigator">KSRootSpaceNavigator</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksrootstepmodifier">KSRootStepModifier</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksrootsurfaceinteraction">KSRootSurfaceInteraction</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksrootsurfacenavigator">KSRootSurfaceNavigator</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksrootterminator">KSRootTerminator</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksroottrackmodifier">KSRootTrackModifier</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksroottrajectory">KSRootTrajectory</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksrootwriter">KSRootWriter</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kssimulation">KSSimulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstermdeath">KSTermDeath</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstermmagnetron">KSTermMagnetron</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstermmaxenergy">KSTermMaxEnergy</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstermmaxlength">KSTermMaxLength</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstermmaxlongenergy">KSTermMaxLongEnergy</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstermmaxr">KSTermMaxR</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstermmaxsteptime">KSTermMaxStepTime</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstermmaxsteps">KSTermMaxSteps</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstermmaxtime">KSTermMaxTime</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstermmaxtotaltime">KSTermMaxTotalTime</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstermmaxz">KSTermMaxZ</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstermmindistance">KSTermMinDistance</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstermminenergy">KSTermMinEnergy</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstermminlongenergy">KSTermMinLongEnergy</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstermminr">KSTermMinR</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstermminz">KSTermMinZ</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstermoutputdata">KSTermOutputData</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstermsecondaries">KSTermSecondaries</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstermstepsize">KSTermStepsize</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstermtrapped">KSTermTrapped</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajcontrolbchange">KSTrajControlBChange</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajcontrolcyclotron">KSTrajControlCyclotron</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajcontrolenergy">KSTrajControlEnergy</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajcontrollength">KSTrajControlLength</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajcontrolmdot">KSTrajControlMDot</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajcontrolmagneticmoment">KSTrajControlMagneticMoment</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajcontrolmomentumnumericalerror">KSTrajControlMomentumNumericalError</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajcontrolpositionnumericalerror">KSTrajControlPositionNumericalError</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajcontrolspinprecession">KSTrajControlSpinPrecession</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajcontroltime">KSTrajControlTime</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajintegratorrk54">KSTrajIntegratorRK54</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajintegratorrk65">KSTrajIntegratorRK65</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajintegratorrk8">KSTrajIntegratorRK8</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajintegratorrk86">KSTrajIntegratorRK86</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajintegratorrk87">KSTrajIntegratorRK87</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajintegratorrkdp54">KSTrajIntegratorRKDP54</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajintegratorrkdp853">KSTrajIntegratorRKDP853</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajintegratorsym4">KSTrajIntegratorSym4</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajinterpolatorcontinuousrungekutta">KSTrajInterpolatorContinuousRungeKutta</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajinterpolatorfast">KSTrajInterpolatorFast</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajinterpolatorhermite">KSTrajInterpolatorHermite</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajtermconstantforcepropagation">KSTrajTermConstantForcePropagation</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajtermdrift">KSTrajTermDrift</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajtermgravity">KSTrajTermGravity</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajtermgyration">KSTrajTermGyration</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajtermpropagation">KSTrajTermPropagation</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajtermsynchrotron">KSTrajTermSynchrotron</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajtrajectoryadiabatic">KSTrajTrajectoryAdiabatic</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajtrajectoryadiabaticspin">KSTrajTrajectoryAdiabaticSpin</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajtrajectoryelectric">KSTrajTrajectoryElectric</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajtrajectoryexact">KSTrajTrajectoryExact</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajtrajectoryexactspin">KSTrajTrajectoryExactSpin</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajtrajectoryexacttrapped">KSTrajTrajectoryExactTrapped</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajtrajectorylinear">KSTrajTrajectoryLinear</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kstrajtrajectorymagnetic">KSTrajTrajectoryMagnetic</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kswriteascii">KSWriteASCII</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kswriteroot">KSWriteROOT</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kswriterootconditionoutputdata">KSWriteROOTConditionOutputData</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kswriterootconditionperiodicdata">KSWriteROOTConditionPeriodicData</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kswriterootconditionstepdata">KSWriteROOTConditionStepData</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kswriterootconditionterminatordata">KSWriteROOTConditionTerminatorData</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kswritevtk">KSWriteVTK</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="bindings_full.html#kvtkwindow">KVTKWindow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgvtkaxialmeshpainter">KGVTKAxialMeshPainter</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgvtkdistancetester">KGVTKDistanceTester</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgvtkgeometrypainter">KGVTKGeometryPainter</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgvtkmeshpainter">KGVTKMeshPainter</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgvtknormaltester">KGVTKNormalTester</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgvtkoutsidetester">KGVTKOutsideTester</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgvtkpointtester">KGVTKPointTester</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#kgvtkrandompointtester">KGVTKRandomPointTester</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksvtkgeneratorpainter">KSVTKGeneratorPainter</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksvtktrackpainter">KSVTKTrackPainter</a></li>
<li class="toctree-l3"><a class="reference internal" href="bindings_full.html#ksvtktrackterminatorpainter">KSVTKTrackTerminatorPainter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="bindings_full.html#kommonnamedrandomgenerator">KommonNamedRandomGenerator</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="license.html"> License</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html"> Authors</a></li>
</ul>
</div>

  <button
      data-action=""
      title="Close navigation menu"
      class="text-4xl text-gray-800 p-4 bottom-0 hover:text-brand xl:hidden focus:text-brand self-center">
    <span class="sr-only">Close navigation menu</span>
    <svg aria-hidden="true" class="fill-current stroke-current h-6 w-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
  </button>
</nav>
  </aside>

  <main
    data-controller="scroll"
    data-action="scroll->scroll#showButton"
    class="px-4 xl:ml-fluid grid-area-main overflow-y-auto flex flex-col h-full mx-0 md:mx-auto xl:mr-0"
  ><nav role="navigation"
     aria-label="breadcrumbs"
     class="print:hidden mt-12 text-sm text-gray-light">
  <a class="text-gray-light text-sm hover:text-gray-dark font-medium focus:text-gray-dark" href="index.html">Kassiopeia 3.8 documentation</a>
  <span class="mr-1"> • </span><span aria-current="page">Configuring Your Own Simulation</span>
</nav>
    <article role="main" class="flex-1">
      
  <div class="section" id="configuring-your-own-simulation">
<span id="configuration-label"></span><h1>Configuring Your Own Simulation<a class="headerlink" href="#configuring-your-own-simulation" title="Permalink to this headline">¶</a></h1>
<p>This section gives a brief overview of what you need to know to configure your own <em>Kassiopeia</em> simulation.</p>
<div class="section" id="overview-and-units">
<h2>Overview and Units<a class="headerlink" href="#overview-and-units" title="Permalink to this headline">¶</a></h2>
<p>The configuration of <em>Kassiopeia</em> is done in three main sections, plus an optional fourth. These are the <code class="docutils literal notranslate"><span class="pre">&lt;messages&gt;</span></code>
section which describes global message verbosity, the <code class="docutils literal notranslate"><span class="pre">&lt;geometry&gt;</span></code> section which describes the system geometry and its
extensions, the <code class="docutils literal notranslate"><span class="pre">&lt;kemfield&gt;</span></code> section which defines the electromagnetic field elements, and the <code class="docutils literal notranslate"><span class="pre">&lt;kassiopeia&gt;</span></code>
section which contains the elements needed for the particle tracking simulation. The optional fourth section relates to
the specification of a <a class="reference external" href="http://www.vtk.org/">VTK</a> or <a class="reference external" href="https://root.cern.ch/">ROOT</a> window for the visualization of aspects of a completed simulation. A complete
simulation file can thus be broken down into something which looks like the following:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;messages&gt;</span>
    <span class="cm">&lt;!-- specification of the messaging configuration here --&gt;</span>
<span class="nt">&lt;/messages&gt;</span>

<span class="nt">&lt;geometry&gt;</span>
    <span class="cm">&lt;!-- specification of the geometry and geometry extensions here --&gt;</span>
<span class="nt">&lt;/geometry&gt;</span>

<span class="nt">&lt;kemfield&gt;</span>
    <span class="cm">&lt;!-- specification of the field elements and parameters here --&gt;</span>
<span class="nt">&lt;/kemfield&gt;</span>

<span class="nt">&lt;kassiopeia&gt;</span>
    <span class="cm">&lt;!-- specification of the simulation elements and parameters here --&gt;</span>
<span class="nt">&lt;/kassiopeia&gt;</span>

<span class="cm">&lt;!-- optional VTK window (requires VTK) --&gt;</span>
<span class="nt">&lt;vtk_window&gt;</span>
    <span class="cm">&lt;!-- specification of the VTK window display here --&gt;</span>
<span class="nt">&lt;/vtk_window&gt;</span>

<span class="cm">&lt;!-- optional ROOT window (requires ROOT) --&gt;</span>
<span class="nt">&lt;root_window&gt;</span>
    <span class="cp">&lt;!-- specification of a ROOT display window here</span>
<span class="cp">&lt;/root_window&gt;</span>
</code></pre></div></div>
<p>The XML based interface of <em>Kassiopeia</em> allows for a very flexible way in which to modify and configure particle
tracking simulations. Throughout the geometry, field, and simulation configuration all physical quantities are specified
using <a class="reference external" href="https://scienceworld.wolfram.com/physics/MKS.html">MKS</a> and their derived units. The exception to this rule is energy, which is specified using electron volts (eV).
It should be noted that XML elements are parsed in order, and elements which are referenced by other elements must be
declared before their first use.</p>
</div>
<div class="section" id="xml-parsing-and-features">
<h2>XML Parsing and Features<a class="headerlink" href="#xml-parsing-and-features" title="Permalink to this headline">¶</a></h2>
<p>The document language used for describing a Kassiopeia simulation configuration is based on standard <a class="reference external" href="https://www.w3.org/TR/xml11/">XML</a>, but has been
augmented with several additional features to aid in complicated or repetitive tasks. For a full description of this
language and its features, see [1].</p>
<p>The general XML syntax is:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;element</span> <span class="na">atrribute1=</span><span class="s">&quot;value1&quot;</span> <span class="na">atrribute2=</span><span class="s">&quot;value2&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;child_element</span> <span class="na">atrribute=</span><span class="s">&quot;value&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/element&gt;</span>
</code></pre></div></div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;element&gt;</span></code> defines an <cite>element</cite> that corresponds to an object of <em>Kassiopeia</em> or one of the other modules. Each
element can have an unlimited number of <cite>attrbutes</cite>, each with its own <cite>value</cite>. Attributes are passed on to the
corresponding object during initialization. XML allows nesting of elements, and therefore some elements can have child
elements with the same syntax.</p>
<p>All elements must end with a closing statement, like <code class="docutils literal notranslate"><span class="pre">&lt;element&gt;</span> <span class="pre">...</span> <span class="pre">&lt;/element&gt;</span></code>. For elements without children, the
syntax can be shortened to the single statement <code class="docutils literal notranslate"><span class="pre">&lt;element</span> <span class="pre">...</span> <span class="pre">/&gt;</span></code>.</p>
<div class="section" id="variables">
<h3>Variables<a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h3>
<p>A local variable may be defined with a particular value (integer,floating point type, string, etc.) with the following
syntax:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">&quot;my_variable&quot;</span> <span class="na">value=</span><span class="s">&quot;1.3e-5&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>and may be reference by any other subsequent (using a local variable before it is defined is not allowed) element in the
document through the use of the square brackets <code class="docutils literal notranslate"><span class="pre">[...]</span></code> in the following manner:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;some_element</span> <span class="na">name=</span><span class="s">&quot;my_element&quot;</span> <span class="na">some_property=</span><span class="s">&quot;[my_variable]&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>Note that all variables are defined as strings, but can be interpreted as other types (such as numbers, lists, etc.)
by during initialization of the element. The details depend on the element’s implementation.</p>
<p>Normal variables are defined only for the scope of the current file. Global variables, on the other hand, persist across
any subsequently included files. These may be specified through:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;global_define</span> <span class="na">name=</span><span class="s">&quot;my_global_variable&quot;</span> <span class="na">value=</span><span class="s">&quot;an_important_value&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>Both local and global variables my be undefined (removed from the parser’s scope) in the following manner:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;undefine</span> <span class="na">name=</span><span class="s">&quot;my_variable&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;global_undefine</span> <span class="na">name=</span><span class="s">&quot;my_global_variable&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>It is also possible to reassign a variable (changing their value) with the syntax:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;redefine</span> <span class="na">name=</span><span class="s">&quot;my_variable&quot;</span> <span class="na">value=</span><span class="s">&quot;1.35e-5&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;global_redefine</span> <span class="na">name=</span><span class="s">&quot;my_global_variable&quot;</span> <span class="na">value=</span><span class="s">&quot;another_important_value&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>Occasionally the user may wish to specify a variable which can be modified from the command line as an argument passed
to <em>Kassiopeia</em>. These variables are called <cite>external variables</cite> and they behave in the same way as global variables,
except that their first definition sets their value and other definitions are ignored. Hence, if an external variable
is defined in multiple included files, only the first occurence matters. If the variable is defined on the command line,
its definition precedes any of the included files.</p>
<p>To define an external variable called <code class="docutils literal notranslate"><span class="pre">my_random_seed</span></code> the syntax is:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;external_define</span> <span class="na">name=</span><span class="s">&quot;my_random_seed&quot;</span> <span class="na">value=</span><span class="s">&quot;123&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>This particular example is useful for running large batches of similar simulations. For example, to simulate many
independent tracks the user might want to run the same simulation repeatedly, but use a different random seed when
starting the simulation. The value of <code class="docutils literal notranslate"><span class="pre">my_random_seed</span></code> can be changed from its default value of 123 from the command
line call to <em>Kassiopeia</em> in the following manner:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><code>Kassiopeia ./my_simulation.xml -r <span class="nv">my_random_seed</span><span class="o">=</span><span class="m">456</span>
</code></pre></div></div>
<p>or with the alternate syntax:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><code>Kassiopeia ./my_simulation.xml --my_random_seed<span class="o">=</span><span class="m">456</span>
</code></pre></div></div>
<p>Note that this applies to other applications that belong to <em>Kassiopeia</em> or the other modules as well.</p>
</div>
<div class="section" id="including-external-files">
<h3>Including external files<a class="headerlink" href="#including-external-files" title="Permalink to this headline">¶</a></h3>
<p>Including external XML files is also supported through a relatively simple syntax. This is helpful when a simulation is
too complex to be managed by a single file. A separate XML file can be included using the following:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;include</span> <span class="na">name=</span><span class="s">&quot;/path/to/file/my_file.xml&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>This include expression may also be configured dynamically through the use of a variable, for example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;external_define</span> <span class="na">name=</span><span class="s">&quot;my_file_name&quot;</span> <span class="na">value=</span><span class="s">&quot;my_file.xml&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;include</span> <span class="na">name=</span><span class="s">&quot;/path/to/file/[my_file_name]&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>could be modified to include an entirely different file by passing another file name argument to <em>Kassiopeia</em> using:</p>
<div class="highlight- notranslate"><div class="highlight"><pre><code>Kassiopeia ./my_simulation.xml -r my_file_name=my_other_file.xml
</code></pre></div></div>
<p>This feature is particularly useful and enables the user to swap in an entirely different configuration for some portion
of the simulation by passing a single command line variable.</p>
<p>Lastly, it is possible to mark an included file as optional so that no error will be thrown if the files does not exist.
This is sometimes useful when a file with variable definitions should be included before the main configuration. The
syntax in this case is:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;include</span> <span class="na">name=</span><span class="s">&quot;/path/to/file/another_file.xml&quot;</span> <span class="na">optional=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
</div>
<div class="section" id="print-statements">
<h3>Print statements<a class="headerlink" href="#print-statements" title="Permalink to this headline">¶</a></h3>
<p>The XML initializer allows to print the current value of a variable, or any sort of text message. The message will be
shown during XML initialization, and it is useful for debugging and checking correct initialization. The syntax is:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">&quot;my_variable&quot;</span> <span class="na">value=</span><span class="s">&quot;42&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;print</span> <span class="na">name=</span><span class="s">&quot;my_variable&quot;</span> <span class="na">value=</span><span class="s">&quot;[my_variable]&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>where the message content is set to the current value of the variable through the <code class="docutils literal notranslate"><span class="pre">[...]</span></code> syntax.</p>
<p>To show a general informative message without a variable name, use the syntax:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;print</span> <span class="na">value=</span><span class="s">&quot;This is a test message.&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>Both examples together will yield the output:</p>
<div class="highlight- notranslate"><div class="highlight"><pre><code>[INITIALIZATION NORMAL MESSAGE] value of &lt;my_variable&gt; is &lt;42&gt;
[INITIALIZATION NORMAL MESSAGE] This is a test message.
</code></pre></div></div>
<p>Instead of showing normal messages, it is also possible to show a warning or an error message. An error message will
terminate the prgogram, so it is most useful in combination with the conditional expressions described below:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;warning</span> <span class="na">value=</span><span class="s">&quot;This is a warning message.&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;error</span> <span class="na">value=</span><span class="s">&quot;This is an error message. Goodbye!&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>Finally, an assertion statement can be used that checks if a condition is true, and shows an error otherwise. See below
for an explanation of conditional expressions. The syntax for the assert statement is:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">&quot;my_variable&quot;</span> <span class="na">value=</span><span class="s">&quot;42&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;assert</span> <span class="na">name=</span><span class="s">&quot;my_variable&quot;</span> <span class="na">condition=</span><span class="s">&quot;{[my_variable] eq 42}&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
</div>
<div class="section" id="formula-expressions">
<h3>Formula Expressions<a class="headerlink" href="#formula-expressions" title="Permalink to this headline">¶</a></h3>
<p>The ability to calculate in-line formulas is another useful feature. The underlying implementation of the formula
processor relies on two external libraries. First, formulas are interpreted with the <a class="reference external" href="https://github.com/codeplea/tinyexpr/">TinyExpr</a> parser. This is a very
fast implementation that works for most simple expressions. If parsing fails, the formula is interpreted by the ROOT
<a class="reference external" href="http://root.cern.ch/root/htmldoc/TFormula.html">TFormula</a> class, which is slower but more versatile. To the user, the switching between both parsers is completely
transparent and no extra steps have to be taken.</p>
<p>In order to active the formula mode, the relevant expression must be enclosed in curly braces <code class="docutils literal notranslate"><span class="pre">{...}</span></code>. Variables may
also be used within a formula, and all variable replacements will be done before the formula parsing (meaning that
the current value of the variable will be used in the formula.) An example of the formula syntax is given in the
following variable definition:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">&quot;my_variable&quot;</span> <span class="na">value=</span><span class="s">&quot;4.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">&quot;length&quot;</span> <span class="na">value=</span><span class="s">&quot;{2.3 + 2.0/sqrt([my_variable])}&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;print</span> <span class="na">name=</span><span class="s">&quot;length&quot;</span> <span class="na">value=</span><span class="s">&quot;[length]&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>This example results in the variable <code class="docutils literal notranslate"><span class="pre">length</span></code> taking the value of 3.3.</p>
<p>Note that this example uses a standard function <code class="docutils literal notranslate"><span class="pre">sqrt(x)</span></code> that is supported by <a class="reference external" href="https://github.com/codeplea/tinyexpr/">TinyExpr</a>. In general, any formulas
using advanced <a class="reference external" href="http://root.cern.ch/root/htmldoc/TMath.html">TMath</a> functions or other complex syntax will use the <a class="reference external" href="http://root.cern.ch/root/htmldoc/TFormula.html">TFormula</a> parser. Simple <a class="reference external" href="http://root.cern.ch/root/htmldoc/TMath.html">TMath</a> functions like
<code class="docutils literal notranslate"><span class="pre">TMath::Sqrt(x)</span></code> or <code class="docutils literal notranslate"><span class="pre">TMath::Sin(x)</span></code> are mapped to their equivalent standard function (<code class="docutils literal notranslate"><span class="pre">sqrt(x)</span></code>, <code class="docutils literal notranslate"><span class="pre">sin(x)</span></code>) that is
natively understood by <a class="reference external" href="https://github.com/codeplea/tinyexpr/">TinyExpr</a>. The standard functions (and mathematical constants) are listed in the table below.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 15%" />
<col style="width: 25%" />
<col style="width: 47%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="4"><p>Standard functions and constants</p></th>
</tr>
<tr class="row-even"><th class="head"><p>XML syntax</p></th>
<th class="head"><p>C++ function</p></th>
<th class="head"><p>ROOT equivalent</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">abs(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">fabs(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TMath::Abs()</span></code></p></td>
<td><p>Compute absolute value.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">acos(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">acos(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TMath::ACos(x)</span></code></p></td>
<td><p>Compute arc cosine.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">asin(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">asin(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TMath::ASin(x)</span></code></p></td>
<td><p>Compute arc sine.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">atan(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">atan(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TMath::ATan(x)</span></code></p></td>
<td><p>Compute arc tangent.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">atan2(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">atan2(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TMath::ATan2(x)</span></code></p></td>
<td><p>Compute arc tangent with two parameters.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ceil(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ceil(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TMath::Ceil(x)</span></code></p></td>
<td><p>Round up value.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">cos(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">cos(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TMath::Cos(x)</span></code></p></td>
<td><p>Compute cosine.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">cosh(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">cosh(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TMath::CosH(x)</span></code></p></td>
<td><p>Compute hyperbolic cosine.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">exp(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">exp(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TMath::Exp(x)</span></code></p></td>
<td><p>Compute exponential function.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">fac(x)</span></code></p></td>
<td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TMath::Factorial(x)</span></code></p></td>
<td><p>Compute factorial.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">floor(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">floor(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TMath::Floor(x)</span></code></p></td>
<td><p>Round down value.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ln(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">log(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TMath::Log(x)</span></code></p></td>
<td><p>Compute natural logarithm.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">log(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">log10(x)</span></code></p></td>
<td></td>
<td><p>Compute common logarithm.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">log10(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">log10(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TMath::Log10(x)</span></code></p></td>
<td><p>Compute common logarithm.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ncr(n,r)</span></code></p></td>
<td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TMath::Binomial(n,r)</span></code></p></td>
<td><p>Compute combinations of <cite>n</cite> over <cite>r</cite>.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">npr(n,r)</span></code></p></td>
<td></td>
<td></td>
<td><p>Compute permuations of <cite>n</cite> over <cite>r</cite>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">pow(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pow(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TMath::Pow(x)</span></code></p></td>
<td><p>Raise to power.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">sin(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sin(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TMath::Sin(x)</span></code></p></td>
<td><p>Compute sine.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">sinh(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sinh(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TMath::SinH(x)</span></code></p></td>
<td><p>Compute hyperbolic sine.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">sqrt(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sqrt(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TMath::Sqrt(x)</span></code></p></td>
<td><p>Compute square root.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">tan(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">tan(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TMath::Tan(x)</span></code></p></td>
<td><p>Compute tangent.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">tanh(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">tanh(x)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TMath::TanH(x)</span></code></p></td>
<td><p>Compute hyperbolic tangent.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">e</span></code></p></td>
<td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TMath::Pi()</span></code></p></td>
<td><p>Fundamental constant.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">pi</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">M_PI</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TMath::E()</span></code></p></td>
<td><p>Fundamental constant.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="conditional-expressions-and-looping">
<h3>Conditional Expressions and Looping<a class="headerlink" href="#conditional-expressions-and-looping" title="Permalink to this headline">¶</a></h3>
<p>In addition to mathematical expressions, simple boolean conditions can be specified. These are often helpful for
swapping or toggling on/off different features, but also for setting several variables depending on the value of a “meta
variable”. An example showing the inclusion/exclusion of a brief section of XML is shown below:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">&quot;var1&quot;</span> <span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">&quot;var2&quot;</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;if</span> <span class="na">condition=</span><span class="s">&quot;{[var1] eq [var2]}&quot;</span><span class="nt">&gt;</span>
    <span class="cm">&lt;!-- intervening section of xml to be included/excluded --&gt;</span>
<span class="nt">&lt;/if&gt;</span>
</code></pre></div></div>
<p>Note that this uses the formula syntax <code class="docutils literal notranslate"><span class="pre">{...}</span></code> in the condition. The operator <code class="docutils literal notranslate"><span class="pre">eq</span></code> checks for equality between the
two variables. Other allowed operators are listed in the table below. To combine multiple conditions into one
expression, use brackets like <code class="docutils literal notranslate"><span class="pre">([var1]</span> <span class="pre">eq</span> <span class="pre">[var2])</span> <span class="pre">&amp;&amp;</span> <span class="pre">([var3]</span> <span class="pre">eq</span> <span class="pre">[var4])</span></code>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 20%" />
<col style="width: 52%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="4"><p>Conditional operators</p></th>
</tr>
<tr class="row-even"><th class="head"><p>XML syntax</p></th>
<th class="head"><p>C++ operator</p></th>
<th class="head"><p>Operator</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">!</span> <span class="pre">A</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">!</span></code></p></td>
<td><p>Logical “not”</p></td>
<td><p>False if statement A is true.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">&amp;&amp;</span> <span class="pre">B</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code></p></td>
<td><p>Logical “and”</p></td>
<td><p>True if both statements A and B are true.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">||</span> <span class="pre">B</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">||</span></code></p></td>
<td><p>Logical “or”</p></td>
<td><p>True if one of the statements A and B is true.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">eq</span> <span class="pre">B</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">==</span></code></p></td>
<td><p>Equal-to</p></td>
<td><p>True if both values A and B are equal.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">ne</span> <span class="pre">B</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">!=</span></code></p></td>
<td><p>Not-equal</p></td>
<td><p>True if both values A and B are not equal.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">gt</span> <span class="pre">B</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;</span></code></p></td>
<td><p>Greater-than</p></td>
<td><p>True if value A is greater than value B.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">lt</span> <span class="pre">B</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&gt;</span></code></p></td>
<td><p>Less-than</p></td>
<td><p>True if value A is less than value B.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">ge</span> <span class="pre">B</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&gt;=</span></code></p></td>
<td><p>Greater-or-equal</p></td>
<td><p>True if value A is greater or equal to value B.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">le</span> <span class="pre">B</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;=</span></code></p></td>
<td><p>Less-or-equal</p></td>
<td><p>True if value A is less or equal to value B.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">mod</span> <span class="pre">B</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">%</span></code></p></td>
<td><p>Modulo</p></td>
<td><p>Return remainder of value A divided by value B.</p></td>
</tr>
</tbody>
</table>
<p>It is also possible to check directly if a variable has been set to a “true” value (i.e. not 0, false, or an empty
string.) The syntax in this case is:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;external_define</span> <span class="na">name=</span><span class="s">&quot;var1&quot;</span> <span class="na">value=</span><span class="s">&quot;&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;if</span> <span class="na">condition=</span><span class="s">&quot;[var1]&quot;</span><span class="nt">&gt;</span>
    <span class="cm">&lt;!-- intervening section of xml to be included/excluded --&gt;</span>
<span class="nt">&lt;/if&gt;</span>
</code></pre></div></div>
<p>The conditional expression does not support if-else blocks, so in order to define an alternate conditional branch one
has to add another if-statement in the XML file.</p>
<p>Another feature which is indispensable when assembling complicated or repetitive geometries is the the ability to insert
multiple copies of an XML fragment with slight modifications. This is called looping and is somewhat similar to the way
a for-loop works in C++ or Python. However, it is a purely static construct intended that is only evaluated during XML
initialization to reduce the amount of code needed to describe a geometry (or other XML feature.)</p>
<p>An example of its use can be found in the <code class="docutils literal notranslate"><span class="pre">DipoleTrapMeshedSpaceSimulation.xml</span></code> example. The example of the loop
syntax for the placement of several copies of a surface with the name <code class="docutils literal notranslate"><span class="pre">intermediate_z_surface</span></code> is given below:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;loop</span> <span class="na">variable=</span><span class="s">&quot;i&quot;</span> <span class="na">start=</span><span class="s">&quot;0&quot;</span> <span class="na">end=</span><span class="s">&quot;10&quot;</span> <span class="na">step=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;surface</span> <span class="na">name=</span><span class="s">&quot;intermediate_z[i]&quot;</span> <span class="na">node=</span><span class="s">&quot;intermediate_z_surface&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;transformation</span> <span class="na">displacement=</span><span class="s">&quot;0. 0. {-0.5 + [i]*(0.4/10.)}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/surface&gt;</span>
<span class="nt">&lt;/loop&gt;</span>
</code></pre></div></div>
<p>In this case, the loop variable <code class="docutils literal notranslate"><span class="pre">[i]</span></code> is used to define the name of the copy and its displacement.</p>
<p>Loops and conditional expressions may also be nested when needed.</p>
</div>
<div class="section" id="comments">
<h3>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h3>
<p>It is wise to include comments in the XML files to explain certain structures or their behavior. Comment blocks are
included by the syntax:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="cm">&lt;!-- This is a multi-line comment</span>
<span class="cm">     that provides useful information. --&gt;</span>
</code></pre></div></div>
<p>As shown above, a comment can span multiple lines. Any text between <code class="docutils literal notranslate"><span class="pre">&lt;!--</span> <span class="pre">...</span> <span class="pre">--&gt;</span></code> is ignored by the XML initializer,
including any XML elements. This makes it possible to quickly comment out parts of the file, e.g. for debugging.</p>
</div>
</div>
<div class="section" id="messaging-system">
<h2>Messaging System<a class="headerlink" href="#messaging-system" title="Permalink to this headline">¶</a></h2>
<p><em>Kassiopeia</em> provides a very granular means of reporting and logging simulation details of interest. This feature is
particularly useful when modifying the code and debugging specific features. For example, at the top of the file
<code class="docutils literal notranslate"><span class="pre">QuadrupoleTrapSimulation.xml</span></code> you can find section describing the verbosity of each simulation element and the
location of the logging file (as defined by the variable <code class="docutils literal notranslate"><span class="pre">log_path</span></code> and the <code class="docutils literal notranslate"><span class="pre">&lt;file&gt;</span></code> element):</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">&quot;log_path&quot;</span> <span class="na">value=</span><span class="s">&quot;[KASPERSYS]/log/Kassiopeia&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;messages&gt;</span>

    <span class="nt">&lt;file</span> <span class="na">path=</span><span class="s">&quot;[log_path]&quot;</span> <span class="na">base=</span><span class="s">&quot;QuadrupoleTrapLog.txt&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;message</span> <span class="na">key=</span><span class="s">&quot;k_file&quot;</span> <span class="na">terminal=</span><span class="s">&quot;normal&quot;</span> <span class="na">log=</span><span class="s">&quot;warning&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;message</span> <span class="na">key=</span><span class="s">&quot;k_initialization&quot;</span> <span class="na">terminal=</span><span class="s">&quot;normal&quot;</span> <span class="na">log=</span><span class="s">&quot;warning&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;message</span> <span class="na">key=</span><span class="s">&quot;kg_core&quot;</span> <span class="na">terminal=</span><span class="s">&quot;normal&quot;</span> <span class="na">log=</span><span class="s">&quot;warning&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;message</span> <span class="na">key=</span><span class="s">&quot;kg_shape&quot;</span> <span class="na">terminal=</span><span class="s">&quot;normal&quot;</span> <span class="na">log=</span><span class="s">&quot;warning&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;message</span> <span class="na">key=</span><span class="s">&quot;kg_mesh&quot;</span> <span class="na">terminal=</span><span class="s">&quot;normal&quot;</span> <span class="na">log=</span><span class="s">&quot;warning&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;message</span> <span class="na">key=</span><span class="s">&quot;kg_axial_mesh&quot;</span> <span class="na">terminal=</span><span class="s">&quot;normal&quot;</span> <span class="na">log=</span><span class="s">&quot;warning&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;message</span> <span class="na">key=</span><span class="s">&quot;ks_object&quot;</span> <span class="na">terminal=</span><span class="s">&quot;debug&quot;</span> <span class="na">log=</span><span class="s">&quot;normal&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;message</span> <span class="na">key=</span><span class="s">&quot;ks_operator&quot;</span> <span class="na">terminal=</span><span class="s">&quot;debug&quot;</span> <span class="na">log=</span><span class="s">&quot;normal&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;message</span> <span class="na">key=</span><span class="s">&quot;ks_field&quot;</span> <span class="na">terminal=</span><span class="s">&quot;debug&quot;</span> <span class="na">log=</span><span class="s">&quot;normal&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;message</span> <span class="na">key=</span><span class="s">&quot;ks_geometry&quot;</span> <span class="na">terminal=</span><span class="s">&quot;debug&quot;</span> <span class="na">log=</span><span class="s">&quot;normal&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;message</span> <span class="na">key=</span><span class="s">&quot;ks_generator&quot;</span> <span class="na">terminal=</span><span class="s">&quot;debug&quot;</span> <span class="na">log=</span><span class="s">&quot;normal&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;message</span> <span class="na">key=</span><span class="s">&quot;ks_trajectory&quot;</span> <span class="na">terminal=</span><span class="s">&quot;debug&quot;</span> <span class="na">log=</span><span class="s">&quot;normal&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;message</span> <span class="na">key=</span><span class="s">&quot;ks_interaction&quot;</span> <span class="na">terminal=</span><span class="s">&quot;debug&quot;</span> <span class="na">log=</span><span class="s">&quot;normal&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;message</span> <span class="na">key=</span><span class="s">&quot;ks_navigator&quot;</span> <span class="na">terminal=</span><span class="s">&quot;debug&quot;</span> <span class="na">log=</span><span class="s">&quot;normal&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;message</span> <span class="na">key=</span><span class="s">&quot;ks_terminator&quot;</span> <span class="na">terminal=</span><span class="s">&quot;debug&quot;</span> <span class="na">log=</span><span class="s">&quot;normal&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;message</span> <span class="na">key=</span><span class="s">&quot;ks_writer&quot;</span> <span class="na">terminal=</span><span class="s">&quot;debug&quot;</span> <span class="na">log=</span><span class="s">&quot;normal&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;message</span> <span class="na">key=</span><span class="s">&quot;ks_main&quot;</span> <span class="na">terminal=</span><span class="s">&quot;debug&quot;</span> <span class="na">log=</span><span class="s">&quot;normal&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;message</span> <span class="na">key=</span><span class="s">&quot;ks_run&quot;</span> <span class="na">terminal=</span><span class="s">&quot;debug&quot;</span> <span class="na">log=</span><span class="s">&quot;normal&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;message</span> <span class="na">key=</span><span class="s">&quot;ks_event&quot;</span> <span class="na">terminal=</span><span class="s">&quot;debug&quot;</span> <span class="na">log=</span><span class="s">&quot;normal&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;message</span> <span class="na">key=</span><span class="s">&quot;ks_track&quot;</span> <span class="na">terminal=</span><span class="s">&quot;debug&quot;</span> <span class="na">log=</span><span class="s">&quot;normal&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;message</span> <span class="na">key=</span><span class="s">&quot;ks_step&quot;</span> <span class="na">terminal=</span><span class="s">&quot;debug&quot;</span> <span class="na">log=</span><span class="s">&quot;normal&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;/messages&gt;</span>
</code></pre></div></div>
<p>For the verbosity settings, you can independently set the verbosity that you see in the terminal and the verbosity that
is put into log files. Furthermore, you can do that for each different part of <em>Kassiopeia</em> and the other modules. For
example, if you want a lot of detail on what’s happening in the navigation routines, you can increase the verbosity for
only that part of <em>Kassiopeia</em>, without being flooded with messages from everything else. The different sources are
define by the <code class="docutils literal notranslate"><span class="pre">key</span></code> attribute of the <code class="docutils literal notranslate"><span class="pre">&lt;message&gt;</span></code> element, and explained in the table below.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 11%" />
<col style="width: 29%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="4"><p>Message sources</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Key</p></th>
<th class="head"><p>Module</p></th>
<th class="head"><p>Location</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">k_file</span></code></p></td>
<td><p>Kommon</p></td>
<td><p>File</p></td>
<td><p>File handling</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">k_initialization</span></code></p></td>
<td><p>Kommon</p></td>
<td><p>Initialization</p></td>
<td><p>XML initialization and processing</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">k_utility</span></code></p></td>
<td><p>Kommon</p></td>
<td><p>Utility</p></td>
<td><p>Utility functions</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">kem_bindings</span></code></p></td>
<td><p>KEMField</p></td>
<td><p>Bindings</p></td>
<td><p>XML bindings</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">kem_core</span></code></p></td>
<td><p>KEMField</p></td>
<td><p>Core</p></td>
<td><p>Core functionality</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">kg_bindings</span></code></p></td>
<td><p>KGeoBag</p></td>
<td><p>Bindings</p></td>
<td><p>XML bindings</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">kg_core</span></code></p></td>
<td><p>KGeoBag</p></td>
<td><p>Core</p></td>
<td><p>Core functionality</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">kg_axial_mesh</span></code></p></td>
<td><p>KGeoBag</p></td>
<td><p>Extensions/AxialMesh</p></td>
<td><p>Axially symmetric meshing</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">kg_drmesh</span></code></p></td>
<td><p>KGeoBag</p></td>
<td><p>Extensions/DiscreteRotationalMesh</p></td>
<td><p>Rotationally discrete meshing</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">kg_mesh</span></code></p></td>
<td><p>KGeoBag</p></td>
<td><p>Extensions/Mesh</p></td>
<td><p>Asymmetric meshing</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">kg_metrics</span></code></p></td>
<td><p>KGeoBag</p></td>
<td><p>Extensions/Metrics</p></td>
<td><p>Metrics calculation (volumes &amp; areas)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">kg_random</span></code></p></td>
<td><p>KGeoBag</p></td>
<td><p>Extensions/Random</p></td>
<td><p>Random generator functions</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">kg_math</span></code></p></td>
<td><p>KGeoBag</p></td>
<td><p>Math</p></td>
<td><p>Mathematical functions</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">kg_shape</span></code></p></td>
<td><p>KGeoBag</p></td>
<td><p>Shapes</p></td>
<td><p>Geometric shapes</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">kg_vis</span></code></p></td>
<td><p>KGeoBag</p></td>
<td><p>Visualization</p></td>
<td><p>Visualization (<a class="reference external" href="http://www.vtk.org/">VTK</a>, <a class="reference external" href="https://root.cern.ch/">ROOT</a>)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ks_bindings</span></code></p></td>
<td><p>Kassiopeia</p></td>
<td><p>Bindings</p></td>
<td><p>XML bindings</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ks_field</span></code></p></td>
<td><p>Kassiopeia</p></td>
<td><p>Fields</p></td>
<td><p>Field calculation</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ks_generator</span></code></p></td>
<td><p>Kassiopeia</p></td>
<td><p>Generators</p></td>
<td><p>Particle generation</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ks_geometry</span></code></p></td>
<td><p>Kassiopeia</p></td>
<td><p>Geometry</p></td>
<td><p>Geometry handling</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ks_interaction</span></code></p></td>
<td><p>Kassiopeia</p></td>
<td><p>Interactions</p></td>
<td><p>Particle interactions</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ks_math</span></code></p></td>
<td><p>Kassiopeia</p></td>
<td><p>Math</p></td>
<td><p>Mathematical functions</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ks_modifier</span></code></p></td>
<td><p>Kassiopeia</p></td>
<td><p>Modifiers</p></td>
<td><p>Trajectory modifiers</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ks_navigator</span></code></p></td>
<td><p>Kassiopeia</p></td>
<td><p>Navigators</p></td>
<td><p>Particle navigation</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ks_object</span></code></p></td>
<td><p>Kassiopeia</p></td>
<td><p>Objects</p></td>
<td><p>Dynamic command interface</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ks_operator</span></code></p></td>
<td><p>Kassiopeia</p></td>
<td><p>Operators</p></td>
<td><p>Core functionality, particle state</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ks_reader</span></code></p></td>
<td><p>Kassiopeia</p></td>
<td><p>Readers</p></td>
<td><p>File reading</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ks_main</span></code></p></td>
<td><p>Kassiopeia</p></td>
<td><p>Simulation</p></td>
<td><p>Simulation execution</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ks_run</span></code></p></td>
<td><p>Kassiopeia</p></td>
<td><p>Simulation</p></td>
<td><p>Simulation progress, “run” level</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ks_event</span></code></p></td>
<td><p>Kassiopeia</p></td>
<td><p>Simulation</p></td>
<td><p>Simulation progress, “event” level</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ks_track</span></code></p></td>
<td><p>Kassiopeia</p></td>
<td><p>Simulation</p></td>
<td><p>Simulation progress, “track” level</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ks_step</span></code></p></td>
<td><p>Kassiopeia</p></td>
<td><p>Simulation</p></td>
<td><p>Simulation progress, “step” level</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ks_terminator</span></code></p></td>
<td><p>Kassiopeia</p></td>
<td><p>Terminators</p></td>
<td><p>Particle termination</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ks_trajectory</span></code></p></td>
<td><p>Kassiopeia</p></td>
<td><p>Trajectories</p></td>
<td><p>Trajectory calculation</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ks_utility</span></code></p></td>
<td><p>Kassiopeia</p></td>
<td><p>Utility</p></td>
<td><p>Utility functions</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ks_vis</span></code></p></td>
<td><p>Kassiopeia</p></td>
<td><p>Visualization</p></td>
<td><p>Visualization (<a class="reference external" href="http://www.vtk.org/">VTK</a>, <a class="reference external" href="https://root.cern.ch/">ROOT</a>)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ks_writer</span></code></p></td>
<td><p>Kassiopeia</p></td>
<td><p>Writers</p></td>
<td><p>File writing</p></td>
</tr>
</tbody>
</table>
<p>The different parts of the code are explained further below, along with XML configuration examples.</p>
<div class="section" id="verbosity-levels">
<h3>Verbosity levels<a class="headerlink" href="#verbosity-levels" title="Permalink to this headline">¶</a></h3>
<p>There are five possible verbosity levels, they are <code class="docutils literal notranslate"><span class="pre">debug</span></code>, <code class="docutils literal notranslate"><span class="pre">info</span></code>, <code class="docutils literal notranslate"><span class="pre">normal</span></code>, <code class="docutils literal notranslate"><span class="pre">warning</span></code> and <code class="docutils literal notranslate"><span class="pre">error</span></code>. Of these,
<code class="docutils literal notranslate"><span class="pre">error</span></code> is the least verbose, only reporting on fatal errors that terminate the simulation. The <code class="docutils literal notranslate"><span class="pre">normal</span></code> mode will
include a relatively small set of details in addition to any warnings (this is the default), while <code class="docutils literal notranslate"><span class="pre">debug</span></code> will
provide an extremely extensive description of the state of the simulation as it progresses.</p>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">debug</span></code> setting is a special case: Since there is so much additional information provided by this
setting, it substantially slows down the speed of the simulation even when the messages are not printed or saved to the
log file. In order to avoid unnecessarily slowing down <em>Kassiopeia</em>, the debug output is completely disabled unless it
is explicitly enabled in the build by enabling the CMake option <code class="docutils literal notranslate"><span class="pre">Kassiopeia_ENABLE_DEBUG</span></code> during configuration (and
the corresponding options for other modules.)</p>
<p>As mentioned earlier, the verbosity level can also be changed by the command line arguments <code class="docutils literal notranslate"><span class="pre">-v</span></code> and <code class="docutils literal notranslate"><span class="pre">-q</span></code>, which
raise or lower the verbosity level. However, this only works for sources that have not been configured explicitely
in the <code class="docutils literal notranslate"><span class="pre">&lt;messages&gt;</span></code> section.</p>
</div>
<div class="section" id="additional-logging">
<h3>Additional logging<a class="headerlink" href="#additional-logging" title="Permalink to this headline">¶</a></h3>
<p>The description above applies to the <em>KMessage</em> interface, which is configured through XML files. In addition, some code
uses the independent <em>KLogger</em> interface. If <em>Kassiopeia</em> was compiled with <a class="reference external" href="https://logging.apache.org/log4cxx/">Log4CXX</a> enabled at build time, the KLogger
interface can be configured through its own configuration file, which is located at:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">$KASPERSYS/config/Kommon/log4cxx.properties</span></code></p>
</div></blockquote>
<p>It allows flexible logging configuration of different parts of the code, including changing the verbosity level,
redirecting output to a log file, or customizing the message format.</p>
<p>In <em>Kassiopeia</em>, <em>KEMField</em> and <em>KGeoBag</em>, most messages use the <em>KMessage</em> interface.</p>
</div>
</div>
<div class="section" id="geometry">
<h2>Geometry<a class="headerlink" href="#geometry" title="Permalink to this headline">¶</a></h2>
<p>The geometry section of the configuration file is the first piece needed in order to assemble a simulation. At its first
and most basic level it is responsible for defining all the different shapes that will be used, and placing them with
respect to one another in order to construct the arrangement (often called <cite>assembly</cite>) that is needed.</p>
<p>For a full a description of all of the shape objects (surfaces and spaces) which maybe constructed in <em>KGeoBag</em> see
<a class="reference internal" href="kgeobag_basic.html#basic-kgeobag-label"><span class="std std-ref">Basic Shapes in KGeoBag</span></a> and <a class="reference internal" href="kgeobag_complex.html#complex-kgeobag-label"><span class="std std-ref">Complex Shapes in KGeoBag</span></a>. The abstract base classes which serve as the interface
between <em>KGeoBag</em> and <em>Kassiopeia</em> are <code class="docutils literal notranslate"><span class="pre">KSSpace</span></code>, <code class="docutils literal notranslate"><span class="pre">KSSurface</span></code>, and <code class="docutils literal notranslate"><span class="pre">KSSide</span></code> (see <a class="reference external" href="https://github.com/KATRIN-Experiment/Kassiopeia/blob/master/Kassiopeia/Operators">GitHub: Kassiopeia/Operators</a>).</p>
<p>The geometry section is also responsible for adding “extended” information to the defined geometry elements. These
extensions can be properties such as colors for visualization, or boundary conditions and meshing details for the
electromagnetic simulations.</p>
<p>Every relevant to the geometry description is processed by <em>KGeoBag</em> and must appear between the start and end brackets:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;geometry&gt;</span>
    <span class="cm">&lt;!-- fill in geometry description here --&gt;</span>
<span class="nt">&lt;/geometry&gt;</span>
</code></pre></div></div>
<p>It should be noted, that the full description of the geometry need not lie within the same pair of <code class="docutils literal notranslate"><span class="pre">&lt;geometry&gt;</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;/geometry&gt;</span></code> brackets. This facilitates the description of separate geometry pieces in different files, which may
then be included and used in the final assembly.</p>
<div class="section" id="shapes-and-assemblies">
<h3>Shapes and assemblies<a class="headerlink" href="#shapes-and-assemblies" title="Permalink to this headline">¶</a></h3>
<p>To understand the basics of <em>KGeoBag</em>, let us look at a simple  example. A typical simulation geometry may look like
the image below, where multiple spaces (B-D) and surfaces (a-b) are assembled and placed in a “world” space A:</p>
<a class="reference internal image-reference" href="_images/geometry_picture.png"><img alt="_images/geometry_picture.png" src="_images/geometry_picture.png" style="width: 250pt;" /></a>
<p>Internally, <em>KGeoBag</em> manages its geometric elements and their relations as a stree structure:</p>
<a class="reference internal image-reference" href="_images/geometry_tree.png"><img alt="_images/geometry_tree.png" src="_images/geometry_tree.png" style="width: 250pt;" /></a>
<p>Now, to understand how this works in practice, we’ll look at one of the example files provided with <em>Kassiopeia</em>. Of
the example files provided, the <code class="docutils literal notranslate"><span class="pre">DipoleTrapSimulation.xml</span></code> has the simplest geometry. It will be explained in detail
below, in order to walk you through a typical geometry configuration.</p>
<p>The geometry section starts off with a description of each shapes involved:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="cm">&lt;!-- world --&gt;</span>

<span class="nt">&lt;cylinder_space</span> <span class="na">name=</span><span class="s">&quot;world_space&quot;</span> <span class="na">z1=</span><span class="s">&quot;-2.&quot;</span> <span class="na">z2=</span><span class="s">&quot;2.&quot;</span> <span class="na">r=</span><span class="s">&quot;2.&quot;</span><span class="nt">/&gt;</span>

<span class="cm">&lt;!-- solenoid --&gt;</span>

<span class="nt">&lt;tag</span> <span class="na">name=</span><span class="s">&quot;magnet_tag&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;cylinder_tube_space</span>
        <span class="na">name=</span><span class="s">&quot;solenoid_space&quot;</span>
        <span class="na">z1=</span><span class="s">&quot;-1.e-2&quot;</span>
        <span class="na">z2=</span><span class="s">&quot;1.e-2&quot;</span>
        <span class="na">r1=</span><span class="s">&quot;0.5e-2&quot;</span>
        <span class="na">r2=</span><span class="s">&quot;1.5e-2&quot;</span>
        <span class="na">radial_mesh_count=</span><span class="s">&quot;30&quot;</span>
    <span class="nt">/&gt;</span>
<span class="nt">&lt;/tag&gt;</span>

<span class="cm">&lt;!-- ring --&gt;</span>

<span class="nt">&lt;tag</span> <span class="na">name=</span><span class="s">&quot;electrode_tag&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;cylinder_surface</span>
        <span class="na">name=</span><span class="s">&quot;ring_surface&quot;</span>
        <span class="na">z1=</span><span class="s">&quot;-2.0e-2&quot;</span>
        <span class="na">z2=</span><span class="s">&quot;2.0e-2&quot;</span>
        <span class="na">r=</span><span class="s">&quot;2.5e-1&quot;</span>
        <span class="na">longitudinal_mesh_count=</span><span class="s">&quot;200&quot;</span>
        <span class="na">longitudinal_mesh_power=</span><span class="s">&quot;3.&quot;</span>
        <span class="na">axial_mesh_count=</span><span class="s">&quot;128&quot;</span>
    <span class="nt">/&gt;</span>
<span class="nt">&lt;/tag&gt;</span>

<span class="cm">&lt;!-- tube --&gt;</span>

<span class="nt">&lt;tag</span> <span class="na">name=</span><span class="s">&quot;electrode_tag&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;cylinder_surface</span>
        <span class="na">name=</span><span class="s">&quot;tube_surface&quot;</span>
        <span class="na">z1=</span><span class="s">&quot;-1.e-2&quot;</span>
        <span class="na">z2=</span><span class="s">&quot;1.e-2&quot;</span>
        <span class="na">r=</span><span class="s">&quot;0.5e-2&quot;</span>
        <span class="na">longitudinal_mesh_count=</span><span class="s">&quot;200&quot;</span>
        <span class="na">longitudinal_mesh_power=</span><span class="s">&quot;3.&quot;</span>
        <span class="na">axial_mesh_count=</span><span class="s">&quot;128&quot;</span>
    <span class="nt">/&gt;</span>
<span class="nt">&lt;/tag&gt;</span>

<span class="cm">&lt;!-- target --&gt;</span>

<span class="nt">&lt;tag</span> <span class="na">name=</span><span class="s">&quot;target_tag&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;disk_surface</span> <span class="na">name=</span><span class="s">&quot;target_surface&quot;</span> <span class="na">r=</span><span class="s">&quot;1.0e-2&quot;</span> <span class="na">z=</span><span class="s">&quot;0.&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/tag&gt;</span>

<span class="cm">&lt;!-- center --&gt;</span>

<span class="nt">&lt;tag</span> <span class="na">name=</span><span class="s">&quot;center_tag&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;disk_surface</span> <span class="na">name=</span><span class="s">&quot;center_surface&quot;</span> <span class="na">r=</span><span class="s">&quot;2.5e-1&quot;</span> <span class="na">z=</span><span class="s">&quot;0.&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/tag&gt;</span>
</code></pre></div></div>
<p>The individual shapes are defined by elements of the common structure:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;some_space</span> <span class="na">name=</span><span class="s">&quot;my_space&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;some_surface</span> <span class="na">name=</span><span class="s">&quot;my_surface&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>where each element is given a name, which it can be referenced with, and additional parameters dependeing on the shape.
For example, the disk surface is defined by only two parameters <cite>r</cite> and <cite>z</cite>, while other shapes differ.</p>
</div>
<div class="section" id="tagging-system">
<h3>Tagging system<a class="headerlink" href="#tagging-system" title="Permalink to this headline">¶</a></h3>
<p>The tagging system is used to group different elements together, for example by distinguishng between magnet and
electrode shapes. These tags will be used later to retrieve elements and pass them to the <em>KEMField</em> module. The
general syntax is:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;tag</span> <span class="na">name=</span><span class="s">&quot;my_tag&quot;</span> <span class="na">name=</span><span class="s">&quot;another_tag&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;shape</span> <span class="na">name=</span><span class="s">&quot;my_shape&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/tag&gt;</span>
</code></pre></div></div>
<p>and tags can be freely combined or re-used.</p>
</div>
<div class="section" id="assembling-elements">
<h3>Assembling elements<a class="headerlink" href="#assembling-elements" title="Permalink to this headline">¶</a></h3>
<p>The defined shapes are then placed into an assembly of the experiment geometry. Geometric objects are placed by
referencing each shape by its given (and <em>unique</em>) name and placing it inside a space. This can be combined with
specifying a transformation (relative to the assembly origin) defining the location and orientation of each object. The
available transformation types are displacements (defined by a 3-vector), and rotations (defined by an axis-angle
pair, or a series of Euler angles using the <em>Z-Y’-Z’’</em> convention):</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;space</span> <span class="na">name=</span><span class="s">&quot;dipole_trap_assembly&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;surface</span> <span class="na">name=</span><span class="s">&quot;ring&quot;</span> <span class="na">node=</span><span class="s">&quot;ring_surface&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;surface</span> <span class="na">name=</span><span class="s">&quot;center&quot;</span> <span class="na">node=</span><span class="s">&quot;center_surface&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;space</span> <span class="na">name=</span><span class="s">&quot;downstream_solenoid&quot;</span> <span class="na">node=</span><span class="s">&quot;solenoid_space&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;transformation</span> <span class="na">displacement=</span><span class="s">&quot;0. 0. -0.5&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/space&gt;</span>
    <span class="nt">&lt;surface</span> <span class="na">name=</span><span class="s">&quot;downstream_tube&quot;</span> <span class="na">node=</span><span class="s">&quot;tube_surface&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;transformation</span> <span class="na">displacement=</span><span class="s">&quot;0. 0. -0.5&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/surface&gt;</span>
    <span class="nt">&lt;surface</span> <span class="na">name=</span><span class="s">&quot;upstream_target&quot;</span> <span class="na">node=</span><span class="s">&quot;target_surface&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;transformation</span> <span class="na">displacement=</span><span class="s">&quot;0. 0. -0.48&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/surface&gt;</span>
    <span class="nt">&lt;space</span> <span class="na">name=</span><span class="s">&quot;upstream_solenoid&quot;</span> <span class="na">node=</span><span class="s">&quot;solenoid_space&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;transformation</span> <span class="na">displacement=</span><span class="s">&quot;0. 0. 0.5&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/space&gt;</span>
    <span class="nt">&lt;surface</span> <span class="na">name=</span><span class="s">&quot;upstream_tube&quot;</span> <span class="na">node=</span><span class="s">&quot;tube_surface&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;transformation</span> <span class="na">displacement=</span><span class="s">&quot;0. 0. 0.5&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/surface&gt;</span>
    <span class="nt">&lt;surface</span> <span class="na">name=</span><span class="s">&quot;downstream_target&quot;</span> <span class="na">node=</span><span class="s">&quot;target_surface&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;transformation</span> <span class="na">displacement=</span><span class="s">&quot;0. 0. 0.48&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/surface&gt;</span>
<span class="nt">&lt;/space&gt;</span>
</code></pre></div></div>
<p>Here the individual named shapes that were defined earlier are referenced, using the general syntax:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;space</span> <span class="na">name=</span><span class="s">&quot;my_assembly&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;space</span> <span class="na">name=</span><span class="s">&quot;my_placed_space&quot;</span> <span class="na">node=</span><span class="s">&quot;my_space&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/space&gt;</span>
</code></pre></div></div>
<p>and spaces can be freely nested, which is one of the key features of <em>KGeoBag</em>. Note the difference between the first
space, which does not refer to any shape and just holds the child elements, and the second space which refers to the
shape named <code class="docutils literal notranslate"><span class="pre">my_space</span></code> through the <cite>node</cite> attribute. The <code class="docutils literal notranslate"><span class="pre">my_assembly</span></code> space can be though of as a “virtual space”,
without any reference to a real geometric object.</p>
<p>Finally in the <code class="docutils literal notranslate"><span class="pre">DipoleTrapSimulation.xml</span></code> file, the full assembly is placed within the world volume:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;space</span> <span class="na">name=</span><span class="s">&quot;world&quot;</span> <span class="na">node=</span><span class="s">&quot;world_space&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;space</span> <span class="na">name=</span><span class="s">&quot;dipole_trap&quot;</span> <span class="na">tree=</span><span class="s">&quot;dipole_trap_assembly&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/space&gt;</span>
</code></pre></div></div>
<p>The world volume is a crucial part of any geometry, since it defines the outermost “root” space in which all other
elements must be placed. Note that in this case, the space named <code class="docutils literal notranslate"><span class="pre">dipole_trap_assembly</span></code> is referenced through the
<cite>tree</cite> attribute (and not <cite>node</cite>, as you might expect.) This is due to the fact that the assembly is a “virtual” space
that just holds its child elements, but does not refer to an actual object. Make sure to keep this in mind for your
own geometry configurations!</p>
</div>
<div class="section" id="transformations">
<h3>Transformations<a class="headerlink" href="#transformations" title="Permalink to this headline">¶</a></h3>
<p>It should be noted that transformations applied to an assembly are collectively applied to all of the geometric elements
within the assembly. For example, placing the dipole trap assembly within the world volume as:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;space</span> <span class="na">name=</span><span class="s">&quot;world&quot;</span> <span class="na">node=</span><span class="s">&quot;world_space&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;space</span> <span class="na">name=</span><span class="s">&quot;dipole_trap&quot;</span> <span class="na">tree=</span><span class="s">&quot;dipole_trap_assembly&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;transformation</span> <span class="na">rotation_euler=</span><span class="s">&quot;90. 0. 0.&quot;</span> <span class="na">displacement=</span><span class="s">&quot;0 0 1.0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/space&gt;</span>
<span class="nt">&lt;/space&gt;</span>
</code></pre></div></div>
<p>would rotate the whole assembly by 90 degrees about the z-axis, and then displace it by 1 meter along the z-axis.</p>
<p>Assemblies may be nested within each other, and the coordinate transformations which are associated with the placement
of each assembly will be appropriately applied to all of the elements they contain. This makes it very intuitive to
create complex geometries with multiple displacements and rotations, because it resembles the behavior of real-world
objects (i.e. turning an assemble object by some amount will also turn all parts inside by the same amount, relative
to the outside coordinate system.)</p>
<p>Especially for rotations, it should be noted that it makes a difference if they are applied in the assembly before or
after placing child elements. Consider the following example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;disk_surface</span> <span class="na">name=</span><span class="s">&quot;disk_surface&quot;</span> <span class="na">r=</span><span class="s">&quot;1.0&quot;</span> <span class="na">z=</span><span class="s">&quot;0.&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;space</span> <span class="na">name=</span><span class="s">&quot;world&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;space</span> <span class="na">name=</span><span class="s">&quot;assembly_1&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;surface</span> <span class="na">name=</span><span class="s">&quot;placed_disk&quot;</span> <span class="na">node=</span><span class="s">&quot;disk_surface&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;transformation</span> <span class="na">rotation_euler=</span><span class="s">&quot;0. 30. 0.&quot;</span> <span class="na">displacement=</span><span class="s">&quot;0 0 -1.0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/space&gt;</span>
    <span class="nt">&lt;space</span> <span class="na">name=</span><span class="s">&quot;assembly_2&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;transformation</span> <span class="na">rotation_euler=</span><span class="s">&quot;0. 30. 0.&quot;</span> <span class="na">displacement=</span><span class="s">&quot;0 0 1.0&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;surface</span> <span class="na">name=</span><span class="s">&quot;placed_disk&quot;</span> <span class="na">node=</span><span class="s">&quot;disk_surface&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/space&gt;</span>
<span class="nt">&lt;/space&gt;</span>
</code></pre></div></div>
<p>In this case, the <code class="docutils literal notranslate"><span class="pre">placed_disk</span></code> in in the first assembly will be tilted relative to the world volume, while the
disk in the second assembly will not! This can be verified easily with one of the geometry viewers, which are explained
in section  <a class="reference internal" href="visualization.html#visualization-label"><span class="std std-ref">Visualization Techniques</span></a>. The reason for this behavior is that in the second case, the rotation was
applied before placing the surface inside the assembly, and so it is not propagated to the shape. This is on purpose,
because it allows to transform the origin and orientation of the reference system before assembling elements.</p>
<p>It is best to think of the <code class="docutils literal notranslate"><span class="pre">&lt;transformation&gt;</span></code> elements as commands that are executed during XML initialization, while
the geometry is assembled. It should be clear then that the two example assemblies yield different results.</p>
</div>
<div class="section" id="extensions">
<h3>Extensions<a class="headerlink" href="#extensions" title="Permalink to this headline">¶</a></h3>
<p>In order to give physical properties to the geometry elements that have been constructed and placed, they must be
associated with extensions. The currently available extensions are <em>meshing</em> (axially or rotationally symmetric, or
non-symmetric), <em>visualization</em> properties, electrostatic <em>boundary conditions</em> (Dirichlet or Neumann surfaces), and
magnetostatic properties of <em>solenoids and coils</em> (current density and number of windings.)</p>
<p>A simple extension example is specifying the color and opacity of a shape for its display in a <a class="reference external" href="http://www.vtk.org/">VTK</a> visualization window
as follows:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;appearance</span> <span class="na">name=</span><span class="s">&quot;app_magnet&quot;</span> <span class="na">color=</span><span class="s">&quot;0 255 127 127&quot;</span> <span class="na">arc=</span><span class="s">&quot;72&quot;</span> <span class="na">surfaces=</span><span class="s">&quot;world/dipole_trap/@magnet_tag&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>This example tells the visualization that any shape given the tag <code class="docutils literal notranslate"><span class="pre">magnet_tag</span></code> should be colored with an RGBA color
value of (0,255,127,127), where all values are given in the range 0..255 and the fourth value defines the shape’s
opacity. If you have VTK enabled you may wish to experiment with the changes introduced by modifying these parameters.
When using the <a class="reference external" href="https://root.cern.ch/">ROOT</a> visualization, the appearance settings will be ignored.</p>
<p>In the line above, you also find an example of referencing tags throught the <code class="docutils literal notranslate"><span class="pre">&#64;tag_name</span></code> syntax. Generally the
placed shapes can be referenced through a <a class="reference external" href="https://www.w3.org/TR/xpath-10/">XPath</a>-like syntax that defines the location in the geometry tree, starting
at the “root” volume (which is typically called <cite>world</cite>.) This usually works with all <cite>spaces</cite> and <cite>surfaces</cite>
attributes of the XML elements.</p>
<p>The tagging feature is very useful for applying properties to many different elements at once. To do this, each element
which is to receive the same extension must share the same tag. There is no limit to the number of tags an geometric
element may be given. For example, given the dipole trap geometry as specified, one may associate an axially symmetric
mesh with all elements that share the tag <code class="docutils literal notranslate"><span class="pre">electrode_tag</span></code> with the line:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;axial_mesh</span> <span class="na">name=</span><span class="s">&quot;mesh_electrode&quot;</span> <span class="na">surfaces=</span><span class="s">&quot;world/dipole_trap/@electrode_tag&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>This specifies that any geometric shape with the tag <code class="docutils literal notranslate"><span class="pre">electrode_tag</span></code> that is found within the <code class="docutils literal notranslate"><span class="pre">world/dipole_trap</span></code>
space should be giving an axial mesh extension (i.e. it will be divided into a collection of axially symmetric objects
like cones, cylinders, etc.) This axial mesh will be later used by the field solving routines in <em>KEMField</em>. However, a
tag is not strictly necessary to apply an extension. For example, if we wished to generate an axial mesh for everything
within the world volume we would write:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;axial_mesh</span> <span class="na">name=</span><span class="s">&quot;mesh_electrode&quot;</span> <span class="na">surfaces=</span><span class="s">&quot;world/#&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>or, if we wished to single out the <code class="docutils literal notranslate"><span class="pre">ring_surface</span></code> shape by specifying its full path we would write:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;axial_mesh</span> <span class="na">name=</span><span class="s">&quot;mesh_electrode&quot;</span> <span class="na">surfaces=</span><span class="s">&quot;world/dipole_trap/ring&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>Meshing is critical for any problem with involves electrostatic fields. The type of mesh depends on the symmetry of the
geometry. For completely axially-symmetric geometries, the <code class="docutils literal notranslate"><span class="pre">axial_mesh</span></code> is recommended so that the zonal harmonics
field computation method may be used. For completely non-symmetric (3D) geometries, the mesh type would be specified as
follows:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;mesh</span> <span class="na">name=</span><span class="s">&quot;mesh_electrode&quot;</span> <span class="na">surfaces=</span><span class="s">&quot;world/dipole_trap/@electrode_tag&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>Because of the very shape-specific nature of the deterministic meshing which is provided by <em>KGeoBag</em>, parameters
(<code class="docutils literal notranslate"><span class="pre">mesh_count</span></code> and <code class="docutils literal notranslate"><span class="pre">mesh_power</span></code>) describing how the mesh is to be constructed are given when specifying the shapes
themselves. That being said, the mesh associated with a specific shape will not be constructed unless the extension
statement is present.</p>
<p>It is possible to define multiple meshes side by side, e.g. if the simulation can be configured axially-symmetric or
non-symmetric. In this case, both meshes will be available for <em>KEMField</em> calculations regardless of the symmetry
setting. Note that the axial mesh cannot handle any non-symmetric elements, and these will be simply ignored.</p>
<p>Another important extension for field calculations is the specification of boundary conditions. For example, when
solving the Laplace boundary value problem via <em>KEMField</em>, one may specify that a particular surface exhibit Dirichlet
boundary conditions where a particular voltage is applied to the surface through the use of the following extension:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;electrostatic_dirichlet</span> <span class="na">name=</span><span class="s">&quot;electrode_ring&quot;</span> <span class="na">surfaces=</span><span class="s">&quot;world/dipole_trap/ring&quot;</span> <span class="na">value=</span><span class="s">&quot;-10.&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>Where <code class="docutils literal notranslate"><span class="pre">value=&quot;-10&quot;</span></code> signifies that this surface has a potential of -10 volts. This is the standard case for defining
(metallic) electrode surfaces in a simulation, and a typical scenario for the boundary-element method (BEM). It is also
possible to define Neumann boundary conditions, which are typically used for insulating materials.</p>
<p>Similar to the electrode setup, one can define a magnet system that provides a magnetostatic field for the simulation.
For example, one may specify a solenoid electromagnet with the appropriate parameters:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;electromagnet</span> <span class="na">name=</span><span class="s">&quot;electromagnet_upstream_solenoid&quot;</span> <span class="na">spaces=</span><span class="s">&quot;world/dipole_trap/upstream_solenoid&quot;</span> <span class="na">current=</span><span class="s">&quot;{22.3047 * 20000}&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>which references a space named <code class="docutils literal notranslate"><span class="pre">upstream_solenoid</span></code> with a total current of 22.3047 amps times 20000 turns. The
electric current and the number of turns can also be specified separately for added clarity:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;electromagnet</span> <span class="na">name=</span><span class="s">&quot;electromagnet_upstream_solenoid&quot;</span> <span class="na">spaces=</span><span class="s">&quot;world/dipole_trap/upstream_solenoid&quot;</span> <span class="na">current=</span><span class="s">&quot;22.3047&quot;</span> <span class="na">num_turns=</span><span class="s">&quot;20000&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>The cylinder tube space is one of the supported shapes for electromagnets and describes a solenoid geometry. Other
supported shapes are the cylinder surface, describing a simple coil, and the rod space, describing a single wire.</p>
<p>For further demonstrations of the possible geometry extensions please see the provided example XML files located
at <a class="reference external" href="https://github.com/KATRIN-Experiment/Kassiopeia/blob/master/KGeoBag/Source/XML/Examples">GitHub: KGeoBag/Source/XML/Examples</a>.</p>
</div>
</div>
<div class="section" id="kemfield">
<h2>KEMField<a class="headerlink" href="#kemfield" title="Permalink to this headline">¶</a></h2>
<p>The field elements all live within the <em>KEMField</em> element and must be placed with start and end tags of the form:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;kemfield&gt;</span>
    <span class="cm">&lt;!-- complete description of the kemfield configuration element here --&gt;</span>
<span class="nt">&lt;/kemfield&gt;</span>
</code></pre></div></div>
<p>Note that in some configuration files, you may find the “legacy style” setup where the field elements are defined under
the <em>Kassiopeia</em> element (see below). Although both variants are supported, it is recommended to follow the one
described here.</p>
</div>
<div class="section" id="fields">
<h2>Fields<a class="headerlink" href="#fields" title="Permalink to this headline">¶</a></h2>
<p>Once the simulation geometry has been specified, the user may describe the types of electric and magnetic fields they
wish associate with each geometric object. The field package <em>KEMField</em> takes care of solving the boundary value problem
and computing the fields for electrostatic problems. It also handles the magnetic field computation from static current
distributions.</p>
<p>Fast field calculation methods are available for axially symmetric (zonal harmonics) and three dimensional problems
(fast multipole method). The abstract base classes responsible for electric and magnetic fields in <em>Kassiopeia</em> are
<a href="#id1"><span class="problematic" id="id2">:kassiopeia:`KSElectricField`</span></a> and <a href="#id3"><span class="problematic" id="id4">:kassiopeia:`KSMagneticField`</span></a> respectively, which interface with the corresponding
implementations in <em>KEMField</em>.</p>
<p>For example, in the <code class="docutils literal notranslate"><span class="pre">DipoleTrapSimulation.xml</span></code> example the electric and magnetic fields are axially symmetric and can
be computed using the zonal harmonics expansion.</p>
<div class="section" id="electric">
<h3>Electric<a class="headerlink" href="#electric" title="Permalink to this headline">¶</a></h3>
<p>To specify the electric field, the geometric surfaces which are electrically active must be listed in the <code class="docutils literal notranslate"><span class="pre">surfaces</span></code>
element. It is important that the surfaces which are specified have a mesh extension and a boundary type extension. If
either of these extensions are missing from the specified surface, they will not be included in the electrostatics
problem. A boundary element mesh is needed to solve the Laplace equation using the boundary element method. Each element
of the mesh inherits its parent surface’s boundary condition type.</p>
<p>Both a method to solve the Laplace boundary value problem (a <code class="docutils literal notranslate"><span class="pre">bem_solver</span></code>), and a method by which to compute the
fields from the resulting charge densities must be given (a <code class="docutils literal notranslate"><span class="pre">field_sovler</span></code>). In the following example we use a
<code class="docutils literal notranslate"><span class="pre">robin_hood_bem_solver</span></code> and a <code class="docutils literal notranslate"><span class="pre">zonal_harmonic_field_solver</span></code>:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;electrostatic_field</span>
        <span class="na">name=</span><span class="s">&quot;field_electrostatic&quot;</span>
        <span class="na">directory=</span><span class="s">&quot;[KEMFIELD_CACHE]&quot;</span>
        <span class="na">file=</span><span class="s">&quot;DipoleTrapElectrodes.kbd&quot;</span>
        <span class="na">system=</span><span class="s">&quot;world/dipole_trap&quot;</span>
        <span class="na">surfaces=</span><span class="s">&quot;world/dipole_trap/@electrode_tag&quot;</span>
        <span class="na">symmetry=</span><span class="s">&quot;axial&quot;</span>
        <span class="nt">&gt;</span>
    <span class="nt">&lt;robin_hood_bem_solver</span>
            <span class="na">integrator=</span><span class="s">&quot;analytic&quot;</span>
            <span class="na">tolerance=</span><span class="s">&quot;1.e-10&quot;</span>
            <span class="na">check_sub_interval=</span><span class="s">&quot;100&quot;</span>
            <span class="na">display_interval=</span><span class="s">&quot;1&quot;</span>
            <span class="na">cache_matrix_elements=</span><span class="s">&quot;true&quot;</span>
    <span class="nt">/&gt;</span>
    <span class="nt">&lt;zonal_harmonic_field_solver</span>
            <span class="na">number_of_bifurcations=</span><span class="s">&quot;-1&quot;</span>
            <span class="na">convergence_ratio=</span><span class="s">&quot;.99&quot;</span>
            <span class="na">convergence_parameter=</span><span class="s">&quot;1.e-15&quot;</span>
            <span class="na">proximity_to_sourcepoint=</span><span class="s">&quot;1.e-12&quot;</span>
            <span class="na">number_of_central_coefficients=</span><span class="s">&quot;500&quot;</span>
            <span class="na">use_fractional_central_sourcepoint_spacing=</span><span class="s">&quot;false&quot;</span>
            <span class="na">central_sourcepoint_spacing=</span><span class="s">&quot;1.e-3&quot;</span>
            <span class="na">central_sourcepoint_start=</span><span class="s">&quot;-5.2e-1&quot;</span>
            <span class="na">central_sourcepoint_end=</span><span class="s">&quot;5.2e-1&quot;</span>
            <span class="na">number_of_remote_coefficients=</span><span class="s">&quot;200&quot;</span>
            <span class="na">remote_sourcepoint_start=</span><span class="s">&quot;-5.e-2&quot;</span>
            <span class="na">remote_sourcepoint_end=</span><span class="s">&quot;5.e-2&quot;</span>
    <span class="nt">/&gt;</span>
<span class="nt">&lt;/electrostatic_field&gt;</span>
</code></pre></div></div>
<p>It is also important that geometric elements be meshed appropriately with respect to symmetry. In the case that the user
wishes to use zonal harmonic field calculation routines, an <code class="docutils literal notranslate"><span class="pre">axial_mesh</span></code> must be used. If a normal (3D) mesh is used,
zonal harmonics cannot function. Different mesh/symmetry types cannot be combined within the same electric field solving
element. The symmetry of the electric field model is set by the <code class="docutils literal notranslate"><span class="pre">symmetry</span></code> attribute.</p>
<p>The zonal-harmonic solver offers many parameters to fine-tune the applied approximation. The example above lists mostly
default values. The most important parameter is probably the distance of the “source points”, which provide the basis
for the approximation. The example above defines a spacing of 1 mm along the z-axis.</p>
<p>In the three-dimensional mesh case, either an integrating field solver, or a fast multipole field solver may be used.
The integrating field solver may be specified through inclusion of the element:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;integrating_field_solver/&gt;</span>
</code></pre></div></div>
<p>within the the <code class="docutils literal notranslate"><span class="pre">electrostatic_field</span></code> element (replacing the <code class="docutils literal notranslate"><span class="pre">zonal_harmonic_field_solver</span></code> in the example above).
As the integrating field solver is quite simple, it does not require additional parameters.</p>
<p>The fast multipole field solver on the other hand is somewhat more complex and requires a relatively large set of
additional parameters to be specified in order to configure its use according to the user’s desired level of accuracy
and computational effort.</p>
<p>For a complete list and description of the XML bindings available for the electric field solving routines, navigate to
the directory <code class="docutils literal notranslate"><span class="pre">$KASPERSYS/config/KEMField/Complete</span></code>. The file <code class="docutils literal notranslate"><span class="pre">ElectricFields.xml</span></code> has examples of the binding for
initializing electric field problems (see <a class="reference external" href="https://github.com/KATRIN-Experiment/Kassiopeia/blob/master/KEMField/Source/XML/Complete/ElectricFields.xml">GitHub: KEMField/Source/XML/Complete/ElectricFields.xml</a>.)</p>
</div>
<div class="section" id="magnetic">
<h3>Magnetic<a class="headerlink" href="#magnetic" title="Permalink to this headline">¶</a></h3>
<p>The specification of the magnetic field solving routines is considerably simpler since there is no need to solve a
boundary value problem before hand. There are essentially two choices for solving magnetic fields from static current
distributions: The zonal harmonics method for use with axially symmetric current sources, and the integrating magnetic
field solver which can be used on geometries with more arbitrary distributions of current. Unlike electric fields,
magnetic fields can contain components with both axially symmetric and non-axially symmetric elements within the same
region with no adverse effects.</p>
<p>The following example uses the zonal harmonics method to compute the magnetic field:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;electromagnet_field</span>
        <span class="na">name=</span><span class="s">&quot;field_electromagnet&quot;</span>
        <span class="na">directory=</span><span class="s">&quot;[KEMFIELD_CACHE]&quot;</span>
        <span class="na">file=</span><span class="s">&quot;DipoleTrapMagnets.kbd&quot;</span>
        <span class="na">system=</span><span class="s">&quot;world/dipole_trap&quot;</span>
        <span class="na">spaces=</span><span class="s">&quot;world/dipole_trap/@magnet_tag&quot;</span>
        <span class="nt">&gt;</span>
    <span class="nt">&lt;zonal_harmonic_field_solver</span>
            <span class="na">number_of_bifurcations=</span><span class="s">&quot;-1&quot;</span>
            <span class="na">convergence_ratio=</span><span class="s">&quot;.99&quot;</span>
            <span class="na">convergence_parameter=</span><span class="s">&quot;1.e-15&quot;</span>
            <span class="na">proximity_to_sourcepoint=</span><span class="s">&quot;1.e-12&quot;</span>
            <span class="na">number_of_central_coefficients=</span><span class="s">&quot;500&quot;</span>
            <span class="na">use_fractional_central_sourcepoint_spacing=</span><span class="s">&quot;true&quot;</span>
            <span class="na">central_sourcepoint_fractional_distance=</span><span class="s">&quot;1e-2&quot;</span>
            <span class="na">central_sourcepoint_spacing=</span><span class="s">&quot;1.e-3&quot;</span>
            <span class="na">number_of_remote_coefficients=</span><span class="s">&quot;200&quot;</span>
            <span class="na">remote_sourcepoint_start=</span><span class="s">&quot;-5.e-2&quot;</span>
            <span class="na">remote_sourcepoint_end=</span><span class="s">&quot;5.e-2&quot;</span>
    <span class="nt">/&gt;</span>
<span class="nt">&lt;/electromagnet_field&gt;</span>
</code></pre></div></div>
<p>Note that although the zonal harmonics solver allows a faster calculation of the electromagnetic fields, but requires
some initialization time to compute the source points. Depending on the simulation, the overall computation time could
be lower when using the integrating solver instead.</p>
<p>Also, please note that only three <em>KGeoBag</em> shapes can be used to create electromagnets: cylinder surface, cylinder tube
space, and rod space. For details, see the above section <cite>Extensions</cite>. If other shapes are added to the electromagnet
field elemenet, they will not be recognized as magnet geometries. When using rod spaces, the resulting magnet element
will be a “line current” that does not allow any zonal harmonic approximation and is always solved directly.</p>
<p>A complete list and set of examples of the XML bindings for magnetic fields can be found in the file
<code class="docutils literal notranslate"><span class="pre">$KASPERSYS/config/KEMField/Complete/MagneticFields.xml</span></code> (see <a class="reference external" href="https://github.com/KATRIN-Experiment/Kassiopeia/blob/master/KEMField/Source/XML/Complete/MagneticFields.xml">GitHub: KEMField/Source/XML/Complete/MagneticFields.xml</a>.)</p>
<p>Further documentation on the exact methods and parameters used in <em>KEMField</em> can be found in [2] and [3].</p>
</div>
</div>
<div class="section" id="kassiopeia">
<h2>Kassiopeia<a class="headerlink" href="#kassiopeia" title="Permalink to this headline">¶</a></h2>
<p>The remaining elements for the simulation all live within the <em>Kassiopeia</em> element and must be placed with start and end
tags of the form:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;kassiopeia&gt;</span>
    <span class="cm">&lt;!-- complete description of the kassiopeia simulation element here --&gt;</span>
<span class="nt">&lt;/kassiopeia&gt;</span>
</code></pre></div></div>
<p>The elements which must be described within the <em>Kassiopeia</em> namespace include the specification of the particle
generation, termination, propagation, interactions, navigation, output, and simulation. The different parts will be
outlined below.</p>
<p>To understand the basics of <em>Kassiopeia</em>, it is important to note that the simulation is organized into four levels:
run, event, track, and step. At the <cite>step</cite> level, the actual calculation of the particle trajectory takes place. When
a new particle is generated, a <cite>track</cite> is initiated that holds all steps belonging to that particle. The track ends
upon termination. The generation of a particle by a user-defined generator is associated with an <cite>event</cite>, which again
holds all corresponding tracks. Because a particle can create secondaries and tracks can be split, one event can hold
more than one track; all belonging to one generation event. Finally, all events from a single simulation are grouped
into a <cite>run</cite>.</p>
<p>The overall relation between these levels is shown below. In this example, the run consists of three events and six
tracks. In the second event, an interaction occurs which leads to a secondary track. In the third event, the track
is split at the third step.</p>
<a class="reference internal image-reference" href="_images/run_event_track_step.png"><img alt="_images/run_event_track_step.png" src="_images/run_event_track_step.png" style="width: 400pt;" /></a>
<p>With this in mind, one can understand the workflow of the simulation shown below. Each step in the work flow is
associated with runs, events, tracks, and steps, and with certain modules of the simulation such as generation,
navigation, propagation etc. which will be explained futher below.</p>
<a class="reference internal image-reference" href="_images/sim_flow.png"><img alt="_images/sim_flow.png" src="_images/sim_flow.png" style="width: 400pt;" /></a>
</div>
<div class="section" id="generation">
<h2>Generation<a class="headerlink" href="#generation" title="Permalink to this headline">¶</a></h2>
<p>The intial state of particle’s to be tracked is set up using the generator mechanism. The abstract base class of all
particle generators is <a href="#id5"><span class="problematic" id="id6">:kassiopeia:`KSGenerator`</span></a> and many different implementations exist. When generating a particle,
there are five important initial parameters:</p>
<ul class="simple">
<li><p><cite>PID</cite>: What is the particle type? For particle ID values, see the <a class="reference external" href="http://pdg.lbl.gov/mc_particle_id_contents.html">PDG</a> numbering scheme. The PID can also be specified
by a common name, such as <code class="docutils literal notranslate"><span class="pre">e-</span></code> for PID 11 (an electron.)</p></li>
<li><p><cite>Energy</cite>: What is the initial energy of the particle? The energy is usually specified in Electronvolts (eV).</p></li>
<li><p><cite>Position</cite>: What is the initial position of the particle?</p></li>
<li><p><cite>Direction</cite>: In what direction is the particle traveling?</p></li>
<li><p><cite>Time</cite>: How is the production of particles distributed in time during the simulation?</p></li>
</ul>
<p>Each of the dynamic components (energy, position, direction, time) can be draw from a selected probability distribution.
In some scenarios a dedicated particle generator may be need which produces with a very specific and well defined
particle state as the result of some physical process (e.g. electron shake-off in Radon decay). However, as is often the
case, the user may wish to modify each dynamic component in a specific way in order to see what effect this has on the
rest of the simulation.</p>
<p>To draw each dynamic component from an independent distribution a composite generator is used. This type of generator
combines a set of user selected distributions to produce the initial energy, position, direction, and time parameters.
The following composite generator example is taken from the <code class="docutils literal notranslate"><span class="pre">DipoleTrapSimulation.xml</span></code> file:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="cm">&lt;!-- pid=11 implies that electrons will be generated --&gt;</span>
<span class="nt">&lt;ksgen_generator_composite</span> <span class="na">name=</span><span class="s">&quot;generator_uniform&quot;</span> <span class="na">pid=</span><span class="s">&quot;11&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;energy_composite&gt;</span>
        <span class="nt">&lt;energy_fix</span> <span class="na">value=</span><span class="s">&quot;1.&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/energy_composite&gt;</span>
    <span class="nt">&lt;position_cylindrical_composite</span> <span class="na">surface=</span><span class="s">&quot;world/dipole_trap/center&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;r_cylindrical</span> <span class="na">radius_min=</span><span class="s">&quot;0.&quot;</span> <span class="na">radius_max=</span><span class="s">&quot;2.0e-1&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;phi_uniform</span> <span class="na">value_min=</span><span class="s">&quot;0.&quot;</span> <span class="na">value_max=</span><span class="s">&quot;360.&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;z_fix</span> <span class="na">value=</span><span class="s">&quot;0.&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/position_cylindrical_composite&gt;</span>
    <span class="nt">&lt;direction_spherical_composite</span> <span class="na">surface=</span><span class="s">&quot;world/dipole_trap/center&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;theta_fix</span> <span class="na">value=</span><span class="s">&quot;0.&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;phi_uniform</span> <span class="na">value_min=</span><span class="s">&quot;0.&quot;</span> <span class="na">value_max=</span><span class="s">&quot;360&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/direction_spherical_composite&gt;</span>
    <span class="nt">&lt;time_composite&gt;</span>
        <span class="nt">&lt;time_fix</span> <span class="na">value=</span><span class="s">&quot;0.&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/time_composite&gt;</span>
<span class="nt">&lt;/ksgen_generator_composite&gt;</span>
</code></pre></div></div>
<p>In this example of the composite generator, the initial kinetic energy of the electron is fixed to 1 eV and its position
is drawn uniformly within a cylindrical volume, defined by the parameters <code class="docutils literal notranslate"><span class="pre">(r,phi,z)</span></code>.Its initial starting time is
fixed to zero, while its initial momentum direction is fixed along the z-axis by specifiying the corresponding angles
<code class="docutils literal notranslate"><span class="pre">(phi,theta)</span></code> in a spherical distribution. Here the particle type is specified by the PID 11. The available particles
and their PIDs are defined at the end of the file <a class="reference external" href="https://github.com/KATRIN-Experiment/Kassiopeia/blob/master/Kassiopeia/Operators/Source/KSParticleFactory.cxx">GitHub: Kassiopeia/Operators/Source/KSParticleFactory.cxx</a>.</p>
<p>All of the fixed values used in this composite generator may be replaced by probability distributions. The available
probability distributions depend on the quantity they are intended to generate, but include uniform, gaussian, pareto,
cosine, etc. The available distributions can be found in <a class="reference external" href="https://github.com/KATRIN-Experiment/Kassiopeia/blob/master/Kassiopeia/Generators">GitHub: Kassiopeia/Generators</a>. Also available is the ability
to generate values at fixed intervals throughout a limited range. For example this can be done for energy as follows:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;energy_composite&gt;</span>
    <span class="nt">&lt;energy_set</span> <span class="na">name=</span><span class="s">&quot;e_set&quot;</span> <span class="na">value_start=</span><span class="s">&quot;1&quot;</span> <span class="na">value_stop=</span><span class="s">&quot;10&quot;</span> <span class="na">value_count=</span><span class="s">&quot;3&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/energy_composite&gt;</span>
</code></pre></div></div>
<p>which would generate 3 particles with energies equally spaced between 1 and 10 eV. Alternatively, as specific list of
values can also be used:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;energy_composite&gt;</span>
    <span class="nt">&lt;energy_list</span>
       <span class="na">add_value=</span><span class="s">&quot;11.8&quot;</span>
       <span class="na">add_value=</span><span class="s">&quot;20.5&quot;</span>
       <span class="na">add_value=</span><span class="s">&quot;33.1&quot;</span>
    <span class="nt">/&gt;</span>
<span class="nt">&lt;/energy_composite&gt;</span>
</code></pre></div></div>
<p>Keep in mind that if a <code class="docutils literal notranslate"><span class="pre">list</span></code> of <code class="docutils literal notranslate"><span class="pre">set</span></code> is used within a composite generator, the number of particles
produced in one generation event will be equal to multiplicative combination of all possible particle states.
For example, the following generator specification:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;ksgen_generator_composite</span> <span class="na">name=</span><span class="s">&quot;generator_uniform&quot;</span> <span class="na">pid=</span><span class="s">&quot;11&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;energy_composite&gt;</span>
        <span class="nt">&lt;energy_set</span> <span class="na">name=</span><span class="s">&quot;e_set&quot;</span> <span class="na">value_start=</span><span class="s">&quot;1&quot;</span> <span class="na">value_stop=</span><span class="s">&quot;200&quot;</span> <span class="na">value_count=</span><span class="s">&quot;10&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/energy_composite&gt;</span>
    <span class="nt">&lt;position_cylindrical_composite</span> <span class="na">surface=</span><span class="s">&quot;world/dipole_trap/center&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;r_cylindrical</span> <span class="na">radius_min=</span><span class="s">&quot;0.&quot;</span> <span class="na">radius_max=</span><span class="s">&quot;2.0e-1&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;phi_uniform</span> <span class="na">value_min=</span><span class="s">&quot;0.&quot;</span> <span class="na">value_max=</span><span class="s">&quot;360.&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;z_fix</span> <span class="na">value=</span><span class="s">&quot;0.&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/position_cylindrical_composite&gt;</span>
    <span class="nt">&lt;direction_spherical_composite</span> <span class="na">surface=</span><span class="s">&quot;world/dipole_trap/center&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;theta_set</span> <span class="na">name=</span><span class="s">&quot;e_set&quot;</span> <span class="na">value_start=</span><span class="s">&quot;0&quot;</span> <span class="na">value_stop=</span><span class="s">&quot;90&quot;</span> <span class="na">values_count=</span><span class="s">&quot;10&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;phi_uniform</span> <span class="na">value_min=</span><span class="s">&quot;0.&quot;</span> <span class="na">value_max=</span><span class="s">&quot;360&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/direction_spherical_composite&gt;</span>
    <span class="nt">&lt;time_composite&gt;</span>
        <span class="nt">&lt;time_fix</span> <span class="na">value=</span><span class="s">&quot;0.&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/time_composite&gt;</span>
<span class="nt">&lt;/ksgen_generator_composite&gt;</span>
</code></pre></div></div>
<p>results in a total of 100 particles being generated per event (as a combination of possible energies and momentum
direction theta coordinate). To see other generator examples please see the included example XML files.</p>
<p>The table below lists the available value distributions that can be used with one of the initial parameters. Note
that the XML element name can also be adapted, so instead of <code class="docutils literal notranslate"><span class="pre">value_gauss</span></code> for an energy distribution one would use:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;energy_composite&gt;</span>
    <span class="nt">&lt;energy_gauss</span> <span class="na">mean=</span><span class="s">&quot;18600.&quot;</span> <span class="na">sigma=</span><span class="s">&quot;5.&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/energy_composite&gt;</span>
</code></pre></div></div>
<p>The position and direction generators usually support multiple value distributions; e.g. radius (<code class="docutils literal notranslate"><span class="pre">r_gauss</span></code>),
azimuthal angle (<code class="docutils literal notranslate"><span class="pre">phi_gauss</span></code>) and z-position (<code class="docutils literal notranslate"><span class="pre">z_gauss</span></code>) for the composite cylindrical position generator.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 32%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>Generator value distributions</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Name</p></th>
<th class="head"><p>XML Element</p></th>
<th class="head"><p>Description (main parameters)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>Fixed</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">value_fix</span></code></p></td>
<td><p>Fixed value</p></td>
</tr>
<tr class="row-even"><td><p>List</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">value_list</span></code></p></td>
<td><p>Fixed set of inidivual values</p></td>
</tr>
<tr class="row-odd"><td><p>Set</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">value_set</span></code></p></td>
<td><p>Fixed set of values in range (start, stop, increment)</p></td>
</tr>
<tr class="row-even"><td><p>Uniform</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">value_uniform</span></code></p></td>
<td><p>Uniform distribution (min, max)</p></td>
</tr>
<tr class="row-odd"><td><p>Boltzmann</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">value_boltzmann</span></code></p></td>
<td><p>Boltzmann energy distribution (mass, <cite>kT</cite>)</p></td>
</tr>
<tr class="row-even"><td><p>Gauss</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">value_gauss</span></code></p></td>
<td><p>Gaussian distribution (mean, sigma, min, max)</p></td>
</tr>
<tr class="row-odd"><td><p>Generalized Gauss</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">value_generalized_gauss</span></code></p></td>
<td><p>Skewed Gaussian distrib. (mean, sigma, min, max, skew)</p></td>
</tr>
<tr class="row-even"><td><p>Pareto</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">value_pareto</span></code></p></td>
<td><p>Pareto distribution (slope, cutoff, offset, min, max)</p></td>
</tr>
<tr class="row-odd"><td><p>Cylindrical Radius</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">value_radius_cylindrical</span></code></p></td>
<td><p>Cylindrical radial distribution (min, max)</p></td>
</tr>
<tr class="row-even"><td><p>Spherical Radius</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">value_radius_spherical</span></code></p></td>
<td><p>Spherical radial distribution (min, max)</p></td>
</tr>
<tr class="row-odd"><td><p>Fractional Radius</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">value_radius_fraction</span></code></p></td>
<td><p>Radial distribution with <code class="docutils literal notranslate"><span class="pre">r_max</span> <span class="pre">=</span> <span class="pre">1</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Cosine Angle</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">value_angle_cosine</span></code></p></td>
<td><p>Cosine angular distribution (min, max)</p></td>
</tr>
<tr class="row-odd"><td><p>Spherical Angle</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">value_angle_spherical</span></code></p></td>
<td><p>Spherical angular distribution (min, max)</p></td>
</tr>
<tr class="row-even"><td><p>Z-Frustrum</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">value_z_frustrum</span></code></p></td>
<td><p>Random z-value inside frustrum (z1, r1, z2, r2)</p></td>
</tr>
<tr class="row-odd"><td><p>Formula</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">value_formula</span></code></p></td>
<td><p>ROOT Formula (<code class="docutils literal notranslate"><span class="pre">TF1</span></code>) given as string</p></td>
</tr>
<tr class="row-even"><td><p>Histogram</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">value_histogram</span></code></p></td>
<td><p>ROOT Histogram (<code class="docutils literal notranslate"><span class="pre">TH1</span></code>) read from file</p></td>
</tr>
</tbody>
</table>
<p>In addition, a number of specialized generators exists. For example, the position or energy of the generated particle
can be defined in more a sophisticated way in case a particle is generated from nuclear decays (Tritium, Krypton, Radon)
or starts from a surface.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 32%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>Energy generators (incomplete list)</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Name</p></th>
<th class="head"><p>XML Element</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>Beta Decay</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">energy_beta_decay</span></code></p></td>
<td><p>Energy from (tritium) beta decay</p></td>
</tr>
<tr class="row-even"><td><p>Beta Recoil</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">energy_beta_recoil</span></code></p></td>
<td><p>Recoil energy from beta decay</p></td>
</tr>
<tr class="row-odd"><td><p>Krypton</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">energy_krypton_event</span></code></p></td>
<td><p>Energy from krypton decay (conversion/Auger)</p></td>
</tr>
<tr class="row-even"><td><p>Lead</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">energy_lead_event</span></code></p></td>
<td><p>Energy from lead decay (conversion/Auger)</p></td>
</tr>
<tr class="row-odd"><td><p>Radon</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">energy_radon_event</span></code></p></td>
<td><p>Energy from radon decay (conversion/Auger/ShakeOff)</p></td>
</tr>
<tr class="row-even"><td><p>Rydberg</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">energy_rydberg</span></code></p></td>
<td><p>Energy from Rydberg ionization</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 32%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>Position generators (incomplete list)</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Name</p></th>
<th class="head"><p>XML Element</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>Cylindrical</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">position_cylindrical_composite</span></code></p></td>
<td><p>Cylindrical position <code class="docutils literal notranslate"><span class="pre">(r,</span> <span class="pre">phi,</span> <span class="pre">z)</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Rectangular</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">position_rectangular_composite</span></code></p></td>
<td><p>Rectangular position <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">z)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Spherical</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">position_spherical_composite</span></code></p></td>
<td><p>Spherical position <code class="docutils literal notranslate"><span class="pre">(r,</span> <span class="pre">phi,</span> <span class="pre">theta)</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Flux Tube</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">position_flux_tube</span></code></p></td>
<td><p>Cylindrical position; radius defined by flux tube</p></td>
</tr>
<tr class="row-odd"><td><p>Surface</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">position_surface_random</span></code></p></td>
<td><p>Random position on surface (not all types supported)</p></td>
</tr>
<tr class="row-even"><td><p>Mesh Surface</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">position_mesh_surface_random</span></code></p></td>
<td><p>Random position on surface; needs surface mesh!</p></td>
</tr>
<tr class="row-odd"><td><p>Space</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">position_space_random</span></code></p></td>
<td><p>Random position in space (not all types supported)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="termination">
<h2>Termination<a class="headerlink" href="#termination" title="Permalink to this headline">¶</a></h2>
<p>The converse to particle generation is termination. The abstract base class of all particle terminators is
<a href="#id7"><span class="problematic" id="id8">:kassiopeia:`KSTerminator`</span></a>. Terminators are used to stop particle tracks in situations where further simulation of the
particle is of no further interest. Terminators typically operate on very simple conditional logic. For example, a
particle track may be terminated if the particle’s kinetic energy drops below some set value, if it intersects a
particular surface, or simply after a given number of steps has been reached.</p>
<p>An example of a terminator which stops particle tracks which exceed the number of allowed steps is given as follows:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;ksterm_max_steps</span> <span class="na">name=</span><span class="s">&quot;term_max_steps&quot;</span> <span class="na">steps=</span><span class="s">&quot;1000&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>A pair of terminators which will terminate a particle that exceeds an allowed range for the z-coordinate is given in the
following example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;ksterm_max_z</span> <span class="na">name=</span><span class="s">&quot;term_max_z&quot;</span> <span class="na">z=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;ksterm_min_z</span> <span class="na">name=</span><span class="s">&quot;term_min_z&quot;</span> <span class="na">z=</span><span class="s">&quot;-1.0&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>There are a wide variety of terminators currently avaiable that can be found in <a class="reference external" href="https://github.com/KATRIN-Experiment/Kassiopeia/blob/master/Kassiopeia/Terminators">GitHub: Kassiopeia/Terminators</a>. The
user is encouraged to peruse the XML example files as well as the source code to determine what (if any) type of
pre-existing terminator might be useful for their purpose. As will be explained later, one may enable/disable specific
terminators dynamically during the simulation. This allows a very flexible configuration of particle termination.</p>
</div>
<div class="section" id="propagation">
<h2>Propagation<a class="headerlink" href="#propagation" title="Permalink to this headline">¶</a></h2>
<p>The propagation section is used to describe the physical process which is associated with the movement of a particle,
and also the means by which the equations of motion are solved. The equations of motions are solved numerically with
various control methods for the time step used during integration of a specific particle trajectory. The abstract base
class of all particle trajectories is <a href="#id9"><span class="problematic" id="id10">:kassiopeia:`KSTrajectory`</span></a>.</p>
<p>There are essential five different equations of motion (trajectories) available for particle tracking in <em>Kassiopeia</em>.
These are, exact, adiabatic, electric, magnetic, and linear. These are implemented in <a class="reference external" href="https://github.com/KATRIN-Experiment/Kassiopeia/blob/master/Kassiopeia/Trajectories">GitHub: Kassiopeia/Trajectories</a>
and some specialized classes exist for spin particles.</p>
<p>The first trajectory type is the so-called <em>exact</em> method, which solves the Lorentz equation for charged particles
exactly without any approximations. It is visualized below:</p>
<a class="reference internal image-reference" href="_images/exact_step.png"><img alt="_images/exact_step.png" src="_images/exact_step.png" style="width: 150pt;" /></a>
<p>The second method is the adiabatic method, which is useful for solving charged particle motion in the presence of
smoothly varying magnetic fields. In this case, only the motion of the “guiding center” (a point on the magnetic field
line) is computed, which allows certain approximations. One may then reconcstruct the cyclotron motion of the particle
around the field line, however this is entirely optional. This method is visualized below:</p>
<a class="reference internal image-reference" href="_images/adiabatic_step.png"><img alt="_images/adiabatic_step.png" src="_images/adiabatic_step.png" style="width: 150pt;" /></a>
<p>The next two types, electric and magnetic (not shown here), are used for tracking the field lines of static electric and
magnetic fields respectively. Finally, the linear trajectory calculates a linear motion that is independent of any
external fields.</p>
<p>The definition of a trajectory for the simulation is usually combined with additional parameters that define the
behavior of the simulation:</p>
<ul class="simple">
<li><p>The <cite>integrator</cite> is responsible for solving the differential equation (ODE) in order to perform the tracking.
Integrators are based off the class <a href="#id11"><span class="problematic" id="id12">:kassiopeia:`KSMathIntegrator`</span></a>.</p></li>
<li><p>An <cite>interpolator</cite> allows to speed up the ODE solving, by interpolating the particle’s parameters over a single step.
Typically, the ODE solver performs evaluations of the particle state in between the initial and final position,
which is time-consuming. Interpolators are based off the class <a href="#id13"><span class="problematic" id="id14">:kassiopeia:`KSMathIntegrator`</span></a>.</p></li>
<li><p>Additional <cite>terms</cite> extend the differential equation of the base trajectory. For example in case of the adiabatic
trajectory, one may add terms for gyration or drift that are otherwise not included in the appoximation. The ODE terms
are based off the class <a href="#id15"><span class="problematic" id="id16">:kassiopeia:`KSMathDifferentiator`</span></a>.</p></li>
<li><p>Additional <cite>controls</cite> can modify the step size. Options exist for a static setting (e.g. a step size of 1 mm)
or dynamic adjustment (e.g. a step size derived from the local magnetic field.) Step controls are based off the class
<a href="#id17"><span class="problematic" id="id18">:kassiopeia:`KSMathControl`</span></a>. Multiple controls can be combined, in which case the smallest possible step is taken.</p></li>
</ul>
<p>The tables below lists the available integrators, interpolators, and terms:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 12%" />
<col style="width: 17%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="6"><p>Trajectory integrators</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Name</p></th>
<th class="head"><p>XML Element</p></th>
<th class="head"><p>Solution Order</p></th>
<th class="head"><p>Function evaluations</p></th>
<th class="head"><p>Error estimate</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>RKF54</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">integrator_rk54</span></code></p></td>
<td><p>5</p></td>
<td><p>6</p></td>
<td><p>Yes</p></td>
<td><p>5th/4th-order Runge-Kutta</p></td>
</tr>
<tr class="row-even"><td><p>RKDP54</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">integrator_rkdp54</span></code></p></td>
<td><p>5</p></td>
<td><p>7</p></td>
<td><p>Yes</p></td>
<td><p>5th-order Runge-Kutta, 4th-order dense output</p></td>
</tr>
<tr class="row-odd"><td><p>RK65</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">integrator_rk65</span></code></p></td>
<td><p>6</p></td>
<td><p>8</p></td>
<td><p>Yes</p></td>
<td><p>6th/5th-order Runge-Kutta</p></td>
</tr>
<tr class="row-even"><td><p>RKF8</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">integrator_rk8</span></code></p></td>
<td><p>8</p></td>
<td><p>13</p></td>
<td><p>No</p></td>
<td><p>8th-order Runge-Kutta</p></td>
</tr>
<tr class="row-odd"><td><p>RK86</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">integrator_rk86</span></code></p></td>
<td><p>8</p></td>
<td><p>12</p></td>
<td><p>Yes</p></td>
<td><p>8th/6th-order Runge-Kutta</p></td>
</tr>
<tr class="row-even"><td><p>RK87</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">integrator_rk87</span></code></p></td>
<td><p>8</p></td>
<td><p>13</p></td>
<td><p>Yes</p></td>
<td><p>8th/7th-order Runge-Kutta</p></td>
</tr>
<tr class="row-odd"><td><p>RKDP853</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">integrator_rkdp853</span></code></p></td>
<td><p>8</p></td>
<td><p>16</p></td>
<td><p>Yes</p></td>
<td><p>8th-order Runge-Kutta,  7th-order dense output</p></td>
</tr>
<tr class="row-even"><td><p>Sym4</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">integrator_sym4</span></code></p></td>
<td><p>4</p></td>
<td><p>4</p></td>
<td><p>No</p></td>
<td><p>4th-order Symplectic; only for exact tracking</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 35%" />
<col style="width: 46%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>Trajectory interpolators</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Name</p></th>
<th class="head"><p>XML Element</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>Fast</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">interpolator_fast</span></code></p></td>
<td><p>Fast linear interpolation</p></td>
</tr>
<tr class="row-even"><td><p>Hermite</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">interpolator_hermite</span></code></p></td>
<td><p>Hermite polynomial interpolation</p></td>
</tr>
<tr class="row-odd"><td><p>Cont. Runge-Kutta</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">kstraj_interpolator_crk</span></code></p></td>
<td><p>Continuous Runge-Kutta (needs dense output)</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 32%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>Trajectory terms</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Name</p></th>
<th class="head"><p>XML Element</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>Propagation</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">term_propagation</span></code></p></td>
<td><p>Basic particle propagation</p></td>
</tr>
<tr class="row-even"><td><p>Constant Force</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">term_constant_force_propagation</span></code></p></td>
<td><p>Propagation by constant force</p></td>
</tr>
<tr class="row-odd"><td><p>Synchrotron</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">term_synchrotron</span></code></p></td>
<td><p>Energy loss from synchrotron radiation</p></td>
</tr>
<tr class="row-even"><td><p>Drift</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">term_drift</span></code></p></td>
<td><p>Electromagnetic field drifts, adiabatic only</p></td>
</tr>
<tr class="row-odd"><td><p>Gyration</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">term_gyration</span></code></p></td>
<td><p>Gyration around guiding center; adiabatic only</p></td>
</tr>
<tr class="row-even"><td><p>Gravity</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">term_gravity</span></code></p></td>
<td><p>Gravity pull; exact only</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 32%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>Trajectory controls</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Name</p></th>
<th class="head"><p>XML Element</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>Length</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">control_length</span></code></p></td>
<td><p>Fixed length</p></td>
</tr>
<tr class="row-even"><td><p>Time</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">control_time</span></code></p></td>
<td><p>Fixed time</p></td>
</tr>
<tr class="row-odd"><td><p>B-Field Gradient</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">control_B_change</span></code></p></td>
<td><p>Length scaled by relative B-field gradient</p></td>
</tr>
<tr class="row-even"><td><p>Cyclotron</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">control_cyclotron</span></code></p></td>
<td><p>Length scaled to length of a full cyclotron turn</p></td>
</tr>
<tr class="row-odd"><td><p>Energy</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">control_energy</span></code></p></td>
<td><p>Length adjusted to limit total energy violation</p></td>
</tr>
<tr class="row-even"><td><p>Magnetic Moment</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">control_magnetic_moment</span></code></p></td>
<td><p>Length adjusted to limit adiabaticity violation</p></td>
</tr>
<tr class="row-odd"><td><p>Momentum Error</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">control_momentum_numerical_error</span></code></p></td>
<td><p>Length adjusted to limit momentum error</p></td>
</tr>
<tr class="row-even"><td><p>Position Error</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">control_position_numerical_error</span></code></p></td>
<td><p>Length adjusted to limit position error</p></td>
</tr>
<tr class="row-odd"><td><p>Spin M-Dot</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">control_m_dot</span></code></p></td>
<td><p>Length scaled by $dot{M}$ (spin tracking only)</p></td>
</tr>
<tr class="row-even"><td><p>Spin Precession</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">control_spin_precession</span></code></p></td>
<td><p>Length scaled by precession freq. (spin tracking only)</p></td>
</tr>
</tbody>
</table>
<p>The exact tracking method can be used where accuracy is of the utmost importance, but requires a large number of steps
in order propagate a particle for a long time or distance. An example of its use is given below:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;kstraj_trajectory_exact</span> <span class="na">name=</span><span class="s">&quot;trajectory_exact&quot;</span> <span class="na">attempt_limit=</span><span class="s">&quot;8&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;interpolator_crk</span> <span class="na">name=</span><span class="s">&quot;interpolator_crk&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;integrator_rkdp853</span> <span class="na">name=</span><span class="s">&quot;integrator_rkdp853&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;term_propagation</span> <span class="na">name=</span><span class="s">&quot;term_propagation&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;control_position_error</span> <span class="na">name=</span><span class="s">&quot;control_position_error&quot;</span> <span class="na">absolute_position_error=</span><span class="s">&quot;1e-12&quot;</span> <span class="na">safety_factor=</span><span class="s">&quot;0.75&quot;</span> <span class="na">solver_order=</span><span class="s">&quot;8&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;control_length</span> <span class="na">name=</span><span class="s">&quot;stepsizelength&quot;</span> <span class="na">length=</span><span class="s">&quot;1e-4&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;control_time</span> <span class="na">name=</span><span class="s">&quot;stepsizetime&quot;</span> <span class="na">time=</span><span class="s">&quot;1e-6&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/kstraj_trajectory_exact&gt;</span>
</code></pre></div></div>
<p>In the above example, the integrator type specified <code class="docutils literal notranslate"><span class="pre">integrator_rkdp853</span></code> is an 8-th order Runge-Kutta integrator with
a 7-th order dense output interpolant (specified by <code class="docutils literal notranslate"><span class="pre">interpolator_crk</span></code>). The step size control is accomplished through
the combination of three different methods. Two of them, <code class="docutils literal notranslate"><span class="pre">control_length</span></code> and <code class="docutils literal notranslate"><span class="pre">control_time</span></code>, place a fixed limit on
the step size, while the third <code class="docutils literal notranslate"><span class="pre">control_position_error</span></code> dynamically attempts to limit the local numerical error on the
particle’s position. In this case no additional terms besides basic propagation are defined, since the exact trajectory
does not make any approximations.</p>
<p>All of the trajectories take an optional parameter <code class="docutils literal notranslate"><span class="pre">attempt_limit</span></code> which limits the number of tries an integration
step will be re-attempted if a step size control determines that the step has failed. The default number of maximum
number of attempts is 32. If a trajectory makes no progress after the maximum number of allowed attempts, the track will
be terminated with a <code class="docutils literal notranslate"><span class="pre">trajectory_fail</span></code> flag.</p>
<p>An example of the adiabatic trajectory with some additional options is specified in the following:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="cm">&lt;!--  adiabatic trajectory --&gt;</span>
<span class="nt">&lt;kstraj_trajectory_adiabatic</span> <span class="na">name=</span><span class="s">&quot;trajectory_adiabatic&quot;</span> <span class="na">piecewise_tolerance=</span><span class="s">&quot;1e-6&quot;</span> <span class="na">max_segments=</span><span class="s">&quot;130&quot;</span> <span class="na">use_true_position=</span><span class="s">&quot;true&quot;</span> <span class="na">cyclotron_fraction=</span><span class="s">&quot;{1.0/64.0}&quot;</span> <span class="na">attempt_limit=</span><span class="s">&quot;8&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;interpolator_crk</span> <span class="na">name=</span><span class="s">&quot;interpolator_crk&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;integrator_rkdp853</span> <span class="na">name=</span><span class="s">&quot;integrator_rkdp853&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;term_propagation</span> <span class="na">name=</span><span class="s">&quot;term_propagation&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;term_drift</span> <span class="na">name=</span><span class="s">&quot;term_drift&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;term_gyration</span> <span class="na">name=</span><span class="s">&quot;term_gyration&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;control_time</span> <span class="na">name=</span><span class="s">&quot;control_time_adiab&quot;</span> <span class="na">time=</span><span class="s">&quot;1e-6&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;control_position_error</span> <span class="na">name=</span><span class="s">&quot;control_position_error&quot;</span> <span class="na">absolute_position_error=</span><span class="s">&quot;1e-9&quot;</span> <span class="na">safety_factor=</span><span class="s">&quot;0.75&quot;</span> <span class="na">solver_order=</span><span class="s">&quot;8&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/kstraj_trajectory_adiabatic&gt;</span>
</code></pre></div></div>
<p>In this example, both the motion of the particle’s guiding center drift (<code class="docutils literal notranslate"><span class="pre">term_drift</span></code>) and the particle’s local
gyration (<code class="docutils literal notranslate"><span class="pre">term_gyration</span></code>) itself are included in the equations of motion. If the second term is not present, the
adiabatic tracjectory only computes the movement of the guiding center. It is important to note that the adiabatic
trajectory cannot be used if there is no magnetic field present. Similar to the example above, the step size is
defined by a combination of two controls.</p>
<p>The last three trajectory types can be specfified as follows:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="cm">&lt;!--  magnetic trajectory --&gt;</span>
<span class="nt">&lt;kstraj_trajectory_magnetic</span> <span class="na">name=</span><span class="s">&quot;trajectory_magnetic&quot;</span> <span class="na">piecewise_tolerance=</span><span class="s">&quot;1e-12&quot;</span> <span class="na">max_segments=</span><span class="s">&quot;128&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;interpolator_crk</span> <span class="na">name=</span><span class="s">&quot;interpolator_crk&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;integrator_rkdp54</span> <span class="na">name=</span><span class="s">&quot;integrator_rkdp54&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;term_propagation</span> <span class="na">name=</span><span class="s">&quot;term_propagation&quot;</span> <span class="na">direction=</span><span class="s">&quot;forward&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;control_time</span> <span class="na">name=</span><span class="s">&quot;control_time&quot;</span> <span class="na">time=</span><span class="s">&quot;1.e-4&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;control_length</span> <span class="na">name=</span><span class="s">&quot;control_length&quot;</span> <span class="na">length=</span><span class="s">&quot;1e-2&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/kstraj_trajectory_magnetic&gt;</span>

<span class="cm">&lt;!--  electric trajectory --&gt;</span>
<span class="nt">&lt;kstraj_trajectory_electric</span> <span class="na">name=</span><span class="s">&quot;trajectory_electric&quot;</span> <span class="na">piecewise_tolerance=</span><span class="s">&quot;1e-12&quot;</span> <span class="na">max_segments=</span><span class="s">&quot;128&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;interpolator_crk</span> <span class="na">name=</span><span class="s">&quot;interpolator_crk&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;integrator_rkdp54</span> <span class="na">name=</span><span class="s">&quot;integrator_rkdp54&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;term_propagation</span> <span class="na">name=</span><span class="s">&quot;term_propagation&quot;</span> <span class="na">direction=</span><span class="s">&quot;backward&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;control_time</span> <span class="na">name=</span><span class="s">&quot;control_time&quot;</span> <span class="na">time=</span><span class="s">&quot;1.e-4&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;control_length</span> <span class="na">name=</span><span class="s">&quot;control_length&quot;</span> <span class="na">length=</span><span class="s">&quot;1e-2&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/kstraj_trajectory_electric&gt;</span>

<span class="nt">&lt;kstraj_trajectory_linear</span> <span class="na">name=</span><span class="s">&quot;trajectory_linear&quot;</span> <span class="na">length=</span><span class="s">&quot;1.e-8&quot;</span> <span class="nt">/&gt;</span>
</code></pre></div></div>
<p>The electric and magnetic field line trajectories are useful for visualization purposes, and during the design stages of
an experiment or simulation. Note that in the above examples we have used a faster but less accurate Runge-Kutta
integrator <code class="docutils literal notranslate"><span class="pre">integrator_rkdp54</span></code>. The property <code class="docutils literal notranslate"><span class="pre">direction</span></code> in <code class="docutils literal notranslate"><span class="pre">term_propagation</span></code> can be used to specify the
direction in which field lines are tracked (positive-to-negative or north-to-south). The linear trajectory takes no
parameters besides a fixed step length,.</p>
<p>In all of the trajectories (exact, adiabatic, electric, magnetic) the parameters <code class="docutils literal notranslate"><span class="pre">piecewise_tolerance</span></code> and
<code class="docutils literal notranslate"><span class="pre">max_segments</span></code> are optional. They dictate how a particles trajectory (in between steps) should be approximated by
piecewise linear segments when determining surface and volume intersections. These parameters are only used when the
<code class="docutils literal notranslate"><span class="pre">ksnav_meshed_space</span></code> navigator is in use, and determine how accurately intersections are found. The default
<code class="docutils literal notranslate"><span class="pre">ksnav_space</span></code> navigator ignores these parameters, since it uses a faster but less accurate approximation by linearly
interpolating a particle’s intermediate state and position. See below for details on navigation.</p>
<p>The adiabatic trajectory also takes the additional parameters <code class="docutils literal notranslate"><span class="pre">use_true_position</span></code> and <code class="docutils literal notranslate"><span class="pre">cyclotron_fraction</span></code> when the
<code class="docutils literal notranslate"><span class="pre">mesh_spaced_navigator</span></code> is in use. The parameter <code class="docutils literal notranslate"><span class="pre">use_true_position</span></code> determines whether the particle or its guiding
center position is used for the purpose of finding intersections. If the particle’s true position is used, then the
parameter <code class="docutils literal notranslate"><span class="pre">cyclotron_fraction</span></code> dictates the number of linear segments the semi-helical path is broken into.</p>
</div>
<div class="section" id="interactions">
<h2>Interactions<a class="headerlink" href="#interactions" title="Permalink to this headline">¶</a></h2>
<p>In between generation and termination, discrete stochastic interactions involving the particle of interest may be
applied during tracking. These interactions are divided according to whether they are active in a volume, or on a
surface. In both cases, the behavior ties with the <em>KGeoBag</em> module that provides the geometric information.</p>
<div class="section" id="volume-interactions">
<h3>Volume Interactions<a class="headerlink" href="#volume-interactions" title="Permalink to this headline">¶</a></h3>
<p>Volume interactions typically involve scattering off of a gas. The abstract base class of all volume interactions is
<a href="#id19"><span class="problematic" id="id20">:kassiopeia:`KSSpaceInteraction`</span></a>. Simple situations where the scattering interactions is treated approximately by a
constant density and cross section can be constructed as follows:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;ksint_scattering</span> <span class="na">name=</span><span class="s">&quot;int_scattering&quot;</span> <span class="na">split=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;density_constant</span> <span class="na">temperature=</span><span class="s">&quot;300.&quot;</span> <span class="na">pressure=</span><span class="s">&quot;3.e0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;calculator_constant</span> <span class="na">cross_section=</span><span class="s">&quot;1.e-18&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ksint_scattering&gt;</span>
</code></pre></div></div>
<p>In this example the density is computed according to the ideal gas law from the temperature (Kelvin) and pressure
(Pascal) and the cross section is treated as a constant (independent of particle energy). Other forms of interaction
are available in <a class="reference external" href="https://github.com/KATRIN-Experiment/Kassiopeia/blob/master/Kassiopeia/Interactions">GitHub: Kassiopeia/Interactions</a>. For more complicated interactions (e.g. involving differential or
energy dependent cross sections) the user may need to devise their own interaction class. Volume interactions must
always be associated with a particular volume when describing the simulation structure.</p>
</div>
<div class="section" id="surface-interactions">
<h3>Surface Interactions<a class="headerlink" href="#surface-interactions" title="Permalink to this headline">¶</a></h3>
<p>Surface interactions are much more limited in their scope and only occur when the track of a particle passes through a
surface. The abstract base class of all surface interactions is <a href="#id21"><span class="problematic" id="id22">:kassiopeia:`KSSurfaceInteraction`</span></a>.</p>
<p>For example, to cause a particle to be reflected diffusely (Lambertian) from a surface the user can specify an
interaction of the following type:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;ksint_surface_diffuse</span> <span class="na">name=</span><span class="s">&quot;int_surface_diffuse&quot;</span> <span class="na">probability=</span><span class="s">&quot;.3&quot;</span> <span class="na">reflection_loss=</span><span class="s">&quot;0.&quot;</span> <span class="na">transmission_loss=</span><span class="s">&quot;1.&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>Similarly, one may use the following code to employ fully specular reflection:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;ksint_surface_specular</span> <span class="na">name=</span><span class="s">&quot;int_surface_diffuse&quot;</span> <span class="na">probability=</span><span class="s">&quot;0.&quot;</span> <span class="na">reflection_loss=</span><span class="s">&quot;0.&quot;</span> <span class="na">transmission_loss=</span><span class="s">&quot;1.&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>In order for this interaction to operate on any particles it must be associated with a surface in the simulation command
structure.</p>
</div>
</div>
<div class="section" id="output">
<h2>Output<a class="headerlink" href="#output" title="Permalink to this headline">¶</a></h2>
<p>The data which is saved as output from the simulation requires two pieces: a file writer and a description of the data
to be saved. The abstract base class of all file writers is <a href="#id23"><span class="problematic" id="id24">:kassiopeia:`KSWriter`</span></a>.</p>
<div class="section" id="writers">
<h3>Writers<a class="headerlink" href="#writers" title="Permalink to this headline">¶</a></h3>
<p>The file writer is responsible for buffering and writing the desired information to disk. The default writer is based on
<a class="reference external" href="https://root.cern.ch/">ROOT</a>, and stores the output in a <code class="docutils literal notranslate"><span class="pre">TTree</span></code> structure:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;kswrite_root</span>
    <span class="na">name=</span><span class="s">&quot;write_root&quot;</span>
    <span class="na">path=</span><span class="s">&quot;/path/to/desired/output/directory&quot;</span>
    <span class="na">base=</span><span class="s">&quot;my_filename.root&quot;</span>
<span class="nt">/&gt;</span>
</code></pre></div></div>
<p>If <em>Kassiopeia</em> is linked against <a class="reference external" href="http://www.vtk.org/">VTK</a>, an additional writer will be made available which can save track and step
information to a <code class="docutils literal notranslate"><span class="pre">.vtp</span></code> (VTK polydata) file. This data is useful for visualalization in external tools such as
<a class="reference external" href="http://www.paraview.org/">Paraview</a>. This write may be created using the following statement:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;kswrite_vtk</span>
    <span class="na">name=</span><span class="s">&quot;write_vtk&quot;</span>
    <span class="na">path=</span><span class="s">&quot;/path/to/desired/output/directory&quot;</span>
    <span class="na">base=</span><span class="s">&quot;my_filename_base.vtp&quot;</span>
<span class="nt">/&gt;</span>
</code></pre></div></div>
<p>Note that in principle both data formats are equivalent, but their underlying structure differs. In most cases it is
best to write output file in both formats, and delete any files that are no longer needed.</p>
<p>To write output in plaintext ASCII format that can be easily viewed and read into other software such as <a href="#id29"><span class="problematic" id="id30">Gnuplot_</span></a>,
one may use the following statement:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;kswrite_ascii</span>
    <span class="na">name=</span><span class="s">&quot;write_ascii&quot;</span>
    <span class="na">path=</span><span class="s">&quot;/path/to/desired/output/directory&quot;</span>
    <span class="na">base=</span><span class="s">&quot;my_filename_base.vtp&quot;</span>
<span class="nt">/&gt;</span>
</code></pre></div></div>
<p>This is not recommended for large-scale simulations because the output file will quickly approach a size that will be
extremely difficult to handle.</p>
</div>
<div class="section" id="output-description">
<h3>Output description<a class="headerlink" href="#output-description" title="Permalink to this headline">¶</a></h3>
<p>The user may tailor the data written to disk to keep precisely the quantities of interest and no more. To do this a
description of the data components to be kept at the track and step level must be given. An example of this (taken from
the <code class="docutils literal notranslate"><span class="pre">QuadrupoleTrapSimulation.xml</span></code> example) is shown below:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;ks_component_member</span> <span class="na">name=</span><span class="s">&quot;component_step_final_particle&quot;</span> <span class="na">field=</span><span class="s">&quot;final_particle&quot;</span> <span class="na">parent=</span><span class="s">&quot;step&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;ks_component_member</span> <span class="na">name=</span><span class="s">&quot;component_step_position&quot;</span> <span class="na">field=</span><span class="s">&quot;position&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_step_final_particle&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;ks_component_member</span> <span class="na">name=</span><span class="s">&quot;component_step_length&quot;</span> <span class="na">field=</span><span class="s">&quot;length&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_step_final_particle&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;ks_component_group</span> <span class="na">name=</span><span class="s">&quot;component_step_world&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;step_id&quot;</span> <span class="na">field=</span><span class="s">&quot;step_id&quot;</span> <span class="na">parent=</span><span class="s">&quot;step&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;continuous_time&quot;</span> <span class="na">field=</span><span class="s">&quot;continuous_time&quot;</span> <span class="na">parent=</span><span class="s">&quot;step&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;continuous_length&quot;</span> <span class="na">field=</span><span class="s">&quot;continuous_length&quot;</span> <span class="na">parent=</span><span class="s">&quot;step&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;time&quot;</span> <span class="na">field=</span><span class="s">&quot;time&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_step_final_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;position&quot;</span> <span class="na">field=</span><span class="s">&quot;position&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_step_final_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;momentum&quot;</span> <span class="na">field=</span><span class="s">&quot;momentum&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_step_final_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;magnetic_field&quot;</span> <span class="na">field=</span><span class="s">&quot;magnetic_field&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_step_final_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;electric_field&quot;</span> <span class="na">field=</span><span class="s">&quot;electric_field&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_step_final_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;electric_potential&quot;</span> <span class="na">field=</span><span class="s">&quot;electric_potential&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_step_final_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;kinetic_energy&quot;</span> <span class="na">field=</span><span class="s">&quot;kinetic_energy_ev&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_step_final_particle&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ks_component_group&gt;</span>

<span class="nt">&lt;ks_component_group</span> <span class="na">name=</span><span class="s">&quot;component_step_cell&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;polar_angle_to_z&quot;</span> <span class="na">field=</span><span class="s">&quot;polar_angle_to_z&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_step_final_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;polar_angle_to_b&quot;</span> <span class="na">field=</span><span class="s">&quot;polar_angle_to_b&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_step_final_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;guiding_center_position&quot;</span> <span class="na">field=</span><span class="s">&quot;guiding_center_position&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_step_final_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;orbital_magnetic_moment&quot;</span> <span class="na">field=</span><span class="s">&quot;orbital_magnetic_moment&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_step_final_particle&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ks_component_group&gt;</span>

<span class="nt">&lt;ks_component_member</span> <span class="na">name=</span><span class="s">&quot;component_track_initial_particle&quot;</span> <span class="na">field=</span><span class="s">&quot;initial_particle&quot;</span> <span class="na">parent=</span><span class="s">&quot;track&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;ks_component_member</span> <span class="na">name=</span><span class="s">&quot;component_track_final_particle&quot;</span> <span class="na">field=</span><span class="s">&quot;final_particle&quot;</span> <span class="na">parent=</span><span class="s">&quot;track&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;ks_component_member</span> <span class="na">name=</span><span class="s">&quot;component_track_position&quot;</span> <span class="na">field=</span><span class="s">&quot;position&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_track_final_particle&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;ks_component_member</span> <span class="na">name=</span><span class="s">&quot;component_track_length&quot;</span> <span class="na">field=</span><span class="s">&quot;length&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_track_final_particle&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;ks_component_member</span> <span class="na">name=</span><span class="s">&quot;z_length&quot;</span> <span class="na">field=</span><span class="s">&quot;continuous_length&quot;</span> <span class="na">parent=</span><span class="s">&quot;step&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;ks_component_group</span> <span class="na">name=</span><span class="s">&quot;component_track_world&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;creator_name&quot;</span> <span class="na">field=</span><span class="s">&quot;creator_name&quot;</span> <span class="na">parent=</span><span class="s">&quot;track&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;terminator_name&quot;</span> <span class="na">field=</span><span class="s">&quot;terminator_name&quot;</span> <span class="na">parent=</span><span class="s">&quot;track&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;total_steps&quot;</span> <span class="na">field=</span><span class="s">&quot;total_steps&quot;</span> <span class="na">parent=</span><span class="s">&quot;track&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;initial_time&quot;</span> <span class="na">field=</span><span class="s">&quot;time&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_track_initial_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;initial_position&quot;</span> <span class="na">field=</span><span class="s">&quot;position&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_track_initial_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;initial_momentum&quot;</span> <span class="na">field=</span><span class="s">&quot;momentum&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_track_initial_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;initial_magnetic_field&quot;</span> <span class="na">field=</span><span class="s">&quot;magnetic_field&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_track_initial_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;initial_electric_field&quot;</span> <span class="na">field=</span><span class="s">&quot;electric_field&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_track_initial_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;initial_electric_potential&quot;</span> <span class="na">field=</span><span class="s">&quot;electric_potential&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_track_initial_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;initial_kinetic_energy&quot;</span> <span class="na">field=</span><span class="s">&quot;kinetic_energy_ev&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_track_initial_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;initial_polar_angle_to_z&quot;</span> <span class="na">field=</span><span class="s">&quot;polar_angle_to_z&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_track_initial_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;initial_azimuthal_angle_to_x&quot;</span> <span class="na">field=</span><span class="s">&quot;azimuthal_angle_to_x&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_track_initial_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;initial_polar_angle_to_b&quot;</span> <span class="na">field=</span><span class="s">&quot;polar_angle_to_b&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_track_initial_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;initial_orbital_magnetic_moment&quot;</span> <span class="na">field=</span><span class="s">&quot;orbital_magnetic_moment&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_track_initial_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;final_time&quot;</span> <span class="na">field=</span><span class="s">&quot;time&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_track_final_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;final_position&quot;</span> <span class="na">field=</span><span class="s">&quot;position&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_track_final_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;final_momentum&quot;</span> <span class="na">field=</span><span class="s">&quot;momentum&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_track_final_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;final_magnetic_field&quot;</span> <span class="na">field=</span><span class="s">&quot;magnetic_field&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_track_final_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;final_electric_field&quot;</span> <span class="na">field=</span><span class="s">&quot;electric_field&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_track_final_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;final_electric_potential&quot;</span> <span class="na">field=</span><span class="s">&quot;electric_potential&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_track_final_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;final_kinetic_energy&quot;</span> <span class="na">field=</span><span class="s">&quot;kinetic_energy_ev&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_track_final_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;final_polar_angle_to_z&quot;</span> <span class="na">field=</span><span class="s">&quot;polar_angle_to_z&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_track_final_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;final_azimuthal_angle_to_x&quot;</span> <span class="na">field=</span><span class="s">&quot;azimuthal_angle_to_x&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_track_final_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;final_polar_angle_to_b&quot;</span> <span class="na">field=</span><span class="s">&quot;polar_angle_to_b&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_track_final_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;final_orbital_magnetic_moment&quot;</span> <span class="na">field=</span><span class="s">&quot;orbital_magnetic_moment&quot;</span> <span class="na">parent=</span><span class="s">&quot;component_track_final_particle&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_member</span> <span class="na">name=</span><span class="s">&quot;z_length_internal&quot;</span> <span class="na">field=</span><span class="s">&quot;continuous_length&quot;</span> <span class="na">parent=</span><span class="s">&quot;track&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;component_integral</span> <span class="na">name=</span><span class="s">&quot;z_length_integral&quot;</span> <span class="na">parent=</span><span class="s">&quot;z_length&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ks_component_group&gt;</span>
</code></pre></div></div>
<p>Let us break this down a bit. First of all, the output can be separated into three groups that each define an output
segment that will be written to the file:</p>
<ul class="simple">
<li><p><cite>component_step_world</cite> is the base definition for output at the step level. It contains standard parameters of the
particle such as its energy, position, or step index.</p></li>
<li><p><cite>component_step_cell</cite> defines additional output fields that are of interest in a specific region of the simulation.
How this feature can be used will be explained below. Generally, one can define as many output groups as necessary
to write output only where it is relevant to the simulation.</p></li>
<li><p><cite>component_track_world</cite> is the base definition for output at the track level. While the step output is written
continuously while the particle trajectory is being computed, the track output is only written once after a track
has been terminated. As such, the track output contains initial and final parameters of the particle (again, for
example, its energy or position) and are derived from the first and last step of the track. There is also an output
field <code class="docutils literal notranslate"><span class="pre">z_length_integral</span></code> that stores the integrated length of all tracks performed in the simulation.</p></li>
</ul>
<p>For output fields that are not directly available at the step (<code class="docutils literal notranslate"><span class="pre">parent=&quot;step&quot;</span></code>) or track level, a mapping has to be
defined first. This is done by the lines:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;ks_component_member</span> <span class="na">name=</span><span class="s">&quot;component_step_final_particle&quot;</span> <span class="na">field=</span><span class="s">&quot;final_particle&quot;</span> <span class="na">parent=</span><span class="s">&quot;step&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>and so on. The <code class="docutils literal notranslate"><span class="pre">field=&quot;final_particle&quot;</span></code> points to the final particle state after a step has been performed, i.e. this
output is written after the completion of each step. Similary, at the track level there are output fields that point
to the initial and final parameters of a track, i.e. the state at particle generation and termination.</p>
<p>The standard output fields for the particle are defined at the end of the file
<a class="reference external" href="https://github.com/KATRIN-Experiment/Kassiopeia/blob/master/Kassiopeia/Operators/Source/KSParticle.cxx">GitHub: Kassiopeia/Operators/Source/KSParticle.cxx</a> while the step and track output fields can be found in
<a class="reference external" href="https://github.com/KATRIN-Experiment/Kassiopeia/blob/master/Kassiopeia/Operators/Source/KSStep.cxx">GitHub: Kassiopeia/Operators/Source/KSStep.cxx</a> and <a class="reference external" href="https://github.com/KATRIN-Experiment/Kassiopeia/blob/master/Kassiopeia/Operators/Source/KSTrack.cxx">GitHub: Kassiopeia/Operators/Source/KSTrack.cxx</a>, respectively.
Other specialized output fields are also available for some propagation or interaction terms.</p>
</div>
</div>
<div class="section" id="navigation">
<h2>Navigation<a class="headerlink" href="#navigation" title="Permalink to this headline">¶</a></h2>
<p>The navigation of a particle is split into two components, surface navigation and space navigation. Surface navigation
is very simple and only takes place when a particle has intersected an active surface. The surface navigator determines
whether the state of the particle is modified on the surface and whether it is reflected or transmitted. It can be made
available for use with the declaration:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;ksnav_surface</span> <span class="na">name=</span><span class="s">&quot;nav_surface&quot;</span> <span class="na">transmission_split=</span><span class="s">&quot;false&quot;</span> <span class="na">reflection_split=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>As this navigator is very simple, it does not take many additional parameters. The parameters <code class="docutils literal notranslate"><span class="pre">transmission_split</span></code> and
<code class="docutils literal notranslate"><span class="pre">reflection_split</span></code> determine whether or not a track is split in two (for the purposes of output/saving data) upon
transmission through or reflection off a geometric surface.</p>
<p>The space navigator is more complex since it is responsible for determine the location of the particle and any possible
intersections it may have with real of virtual boundaries. It is also responsible for ensuring that the current
simulation state matches the configuration specified by the user. The spaces that the navigator considers may be real
objects (such as a vacuum chamber wall) or virtual (which only modify the state of the simulation, e.g. exchanging a
trajectory method). The latter case allows to dynamically reconfigure the simulation over a track.</p>
<p>For space navigation there are two options. The first is the default <code class="docutils literal notranslate"><span class="pre">ksnav_space</span></code> navigator which can be specified as
below:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;ksnav_space</span> <span class="na">name=</span><span class="s">&quot;nav_space&quot;</span> <span class="na">enter_split=</span><span class="s">&quot;false&quot;</span> <span class="na">exit_split=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>As this navigator is also very simple, it does not take many additional parameters. The parameters <code class="docutils literal notranslate"><span class="pre">enter_split</span></code> and
<code class="docutils literal notranslate"><span class="pre">exit_split</span></code> determine whether or not a track is split in two  upon entrance or exit of a geometric space.</p>
<p>A more complex behavior is achieved by the <code class="docutils literal notranslate"><span class="pre">ksnav_meshed_space</span></code> navigator, which is intended to be used in highly
detailed three-dimensional geometries where it has better performance over the default navigator. An example of this is
shown in the <code class="docutils literal notranslate"><span class="pre">PhotoMultplierTube.xml</span></code> file. Its configuration is more complicated as it performs the navigations on
the meshed boundaries of spaces and surfaces. It requires the construction of an octree spatial partition (which may be
cached for later re-use). The user must specify the depth of the octree (<code class="docutils literal notranslate"><span class="pre">max_octree_depth</span></code>) and the number of
elements allowed in a octree node before a subdivision is required (<code class="docutils literal notranslate"><span class="pre">n_allowed_elements</span></code>). In addition, the root of
the geometry tree must also be specified with the parameter <code class="docutils literal notranslate"><span class="pre">root_space</span></code>, which is typically the world volume:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;ksnav_meshed_space</span> <span class="na">name=</span><span class="s">&quot;nav_meshed_space&quot;</span> <span class="na">root_space=</span><span class="s">&quot;space_world&quot;</span> <span class="na">max_octree_depth=</span><span class="s">&quot;9&quot;</span> <span class="na">n_allowed_elements=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>Though they are not shown here (they default to false), the exit and entrance split parameters may also be set for the
<code class="docutils literal notranslate"><span class="pre">ksnav_meshed_space</span></code> navigator. Because the <code class="docutils literal notranslate"><span class="pre">ksnav_meshed_space</span></code> navigator requires a boundary mesh in order to
operate, all geometric objects (spaces, sufaces) which have navigation commands attached to them must also have a mesh
extension in the geometry specification. Furthermore, since <code class="docutils literal notranslate"><span class="pre">ksnav_meshed_space</span></code> requires access to the root space
<code class="docutils literal notranslate"><span class="pre">space_world</span></code> and all of the navigation commands associated with the shapes it contains, it must be declared after the
definition of the simulation command structure element <code class="docutils literal notranslate"><span class="pre">ksgeo_space</span></code> (see below).</p>
<p>The mesh navigator can also be used together with geometry from exernal files, as shown in the <code class="docutils literal notranslate"><span class="pre">MeshSimulation.xml</span></code>
example.</p>
</div>
<div class="section" id="navigation-and-commands">
<h2>Navigation and Commands<a class="headerlink" href="#navigation-and-commands" title="Permalink to this headline">¶</a></h2>
<p>For dyanmic configuration, <em>Kassiopeia</em> allows certain commands to be used during the calculation of a particle
trajectory. The commands are associated with particular surfaces and spaces and are what effectively governs the state
of the simulation as a particle is tracked. They are declared through the specification of a <code class="docutils literal notranslate"><span class="pre">ksgeo_space</span></code>. A very
simple example of the declaration of the command structure can be seen in the DipoleTrapSimulation.xml as shown below:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;ksgeo_space</span> <span class="na">name=</span><span class="s">&quot;space_world&quot;</span> <span class="na">spaces=</span><span class="s">&quot;world&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;add_terminator</span> <span class="na">parent=</span><span class="s">&quot;root_terminator&quot;</span> <span class="na">child=</span><span class="s">&quot;term_max_steps&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;remove_terminator</span> <span class="na">parent=</span><span class="s">&quot;root_terminator&quot;</span> <span class="na">child=</span><span class="s">&quot;term_world&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;add_track_output</span> <span class="na">parent=</span><span class="s">&quot;write_root&quot;</span> <span class="na">child=</span><span class="s">&quot;component_track_world&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;comadd_step_outputmand</span> <span class="na">parent=</span><span class="s">&quot;write_root&quot;</span> <span class="na">child=</span><span class="s">&quot;component_step_world&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;geo_surface</span> <span class="na">name=</span><span class="s">&quot;surface_upstream_target&quot;</span> <span class="na">surfaces=</span><span class="s">&quot;world/dipole_trap/upstream_target&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;add_terminator</span> <span class="na">parent=</span><span class="s">&quot;root_terminator&quot;</span> <span class="na">child=</span><span class="s">&quot;term_upstream_target&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/geo_surface&gt;</span>

    <span class="nt">&lt;geo_surface</span> <span class="na">name=</span><span class="s">&quot;surface_downstream_target&quot;</span> <span class="na">surfaces=</span><span class="s">&quot;world/dipole_trap/downstream_target&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;add_terminator</span> <span class="na">parent=</span><span class="s">&quot;root_terminator&quot;</span> <span class="na">child=</span><span class="s">&quot;term_downstream_target&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/geo_surface&gt;</span>

    <span class="nt">&lt;geo_surface</span> <span class="na">name=</span><span class="s">&quot;surface_center&quot;</span> <span class="na">surfaces=</span><span class="s">&quot;world/dipole_trap/center&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ksgeo_space&gt;</span>
</code></pre></div></div>
<p>Note that in some configuration files, you may find alternative declarations such as:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;command</span> <span class="na">parent=</span><span class="s">&quot;root_terminator&quot;</span> <span class="na">field=</span><span class="s">&quot;add_terminator&quot;</span> <span class="na">child=</span><span class="s">&quot;term_max_steps&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;command</span> <span class="na">parent=</span><span class="s">&quot;root_terminator&quot;</span> <span class="na">field=</span><span class="s">&quot;add_terminator&quot;</span> <span class="na">child=</span><span class="s">&quot;term_upstream_target&quot;</span><span class="nt">/&gt;</span>
</code></pre></div></div>
<p>which are eequivalent to the commands shown above.</p>
<p>Again, let us break down this example:</p>
<ul class="simple">
<li><p>First we create a <code class="docutils literal notranslate"><span class="pre">ksgeo_space</span></code> navigation space using the <code class="docutils literal notranslate"><span class="pre">world</span></code> volume (a geometric object holding all other
elements.) Inside of this world volume we declare a series of command which will be executed any time a particle
enters or is initialized within the world volume.</p></li>
<li><p>The first two commands add and remove specific terminators, while the next two declare what sort of output should be
written to disk while the particle is inside the world volume.</p></li>
<li><p>Following that, there are commands which are attached to specific surfaces which are present in the geometry, and
handled by the navigator. For example in the first block, attaching the terminator <code class="docutils literal notranslate"><span class="pre">term_upstream_target</span></code> ensures
that a particle impinging on the surface <code class="docutils literal notranslate"><span class="pre">surface_upstream_target</span></code> will be terminated immediately.</p></li>
<li><p>The last surface does not have any associated commands, but will still be considered for navigation. For example,
if <code class="docutils literal notranslate"><span class="pre">transmission_split</span></code> was set in the navigator, the track will be split if the particle crosses the surface.</p></li>
</ul>
<p>Commands can used to change the active field calculation method, swap trajectory types, or add/remove termsna and
interactions, define terminators, etc. Various spaces and their associated commands can be nested within each other
allowing for a very flexible and dynamic simulation configuration. For best results, it is important that the
structure of the <code class="docutils literal notranslate"><span class="pre">geo_space</span></code> and <code class="docutils literal notranslate"><span class="pre">geo_surface</span></code> elements follows the structure of the <em>KGeoBag</em> geometry tree, i.e.
nesting of the navigation elements should follow the same order as the underlying geometry.</p>
</div>
<div class="section" id="simulation">
<h2>Simulation<a class="headerlink" href="#simulation" title="Permalink to this headline">¶</a></h2>
<p>The final object to be declared within <code class="docutils literal notranslate"><span class="pre">&lt;kassiopeia&gt;</span></code> is the simulation element. This describes the simulation object
<a href="#id25"><span class="problematic" id="id26">:kassiopeia:`KSSimulation`</span></a>, which is then executed by <a href="#id27"><span class="problematic" id="id28">:kassiopeia:`KSRoot`</span></a>. The simulation element specifies the global
and initial properties of the simulation as a whole. For example in the <code class="docutils literal notranslate"><span class="pre">QuadrupoleTrapSimulation.xml</span></code> example, the
simulation element is declared as follows:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;ks_simulation</span>
    <span class="na">name=</span><span class="s">&quot;quadrupole_trap_simulation&quot;</span>
    <span class="na">run=</span><span class="s">&quot;1&quot;</span>
    <span class="na">seed=</span><span class="s">&quot;51385&quot;</span>
    <span class="na">events=</span><span class="s">&quot;10&quot;</span>
    <span class="na">magnetic_field=</span><span class="s">&quot;field_electromagnet&quot;</span>
    <span class="na">electric_field=</span><span class="s">&quot;field_electrostatic&quot;</span>
    <span class="na">space=</span><span class="s">&quot;space_world&quot;</span>
    <span class="na">generator=</span><span class="s">&quot;generator_uniform&quot;</span>
    <span class="na">trajectory=</span><span class="s">&quot;trajectory_exact&quot;</span>
    <span class="na">space_navigator=</span><span class="s">&quot;nav_space&quot;</span>
    <span class="na">surface_navigator=</span><span class="s">&quot;nav_surface&quot;</span>
    <span class="na">writer=</span><span class="s">&quot;write_root&quot;</span>
<span class="nt">/&gt;</span>
</code></pre></div></div>
<p>The <code class="docutils literal notranslate"><span class="pre">run</span></code> is simply a user provided identifier. The <code class="docutils literal notranslate"><span class="pre">seed</span></code> is the value provided to the global (singleton) random
number generator. Simulations with the same configuration and same seed should provide identical results. If the user is
interested in running <em>Kassiopeia</em> on many machines in order to achieve high throughput particle tracking (Monte Carlo),
care must be taken to ensure that the <code class="docutils literal notranslate"><span class="pre">seed</span></code> value is different for each run of the simulation.</p>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">events</span></code> determines the total number of times that the generator is run (however this is not necessarily
the number of particles that will be tracked, e.g. if lists or sets are used in the generator of if secondary particles
are created). The remaining parameters <code class="docutils literal notranslate"><span class="pre">magnetic_field</span></code>, <code class="docutils literal notranslate"><span class="pre">space</span></code>, <code class="docutils literal notranslate"><span class="pre">generator</span></code>, etc. all specify the default
objects to be used for the initial state of the simulation; where commands specified within <code class="docutils literal notranslate"><span class="pre">ksgeo_space</span></code> may
modify the actual objects used during the course of a simulation.</p>
<p>Following the declaration of <code class="docutils literal notranslate"><span class="pre">ks_simulation</span></code>, the closing tag <code class="docutils literal notranslate"><span class="pre">&lt;/kassiopeia&gt;</span></code> is placed to complete the simulation
configuration. When this tag is encountered by the XML parser, it triggers the simulation to run.</p>
</div>
<div class="section" id="visualization">
<h2>Visualization<a class="headerlink" href="#visualization" title="Permalink to this headline">¶</a></h2>
<p>If <em>Kassiopeia</em> has been linked against <a class="reference external" href="http://www.vtk.org/">VTK</a> or <a class="reference external" href="https://root.cern.ch/">ROOT</a>, a simple visualization of the simulation can be made available.
By adding the <cite>vtk_window</cite> element at the end of the configuration file, we activate a VTK window that will open when
the simulation is complete. This element may hold a <code class="docutils literal notranslate"><span class="pre">vtk_geometry_painter</span></code> and a <code class="docutils literal notranslate"><span class="pre">`vtk_track_painter</span></code> to draw the
geometry and tracks, respectively. An example of this type of visualization from the <code class="docutils literal notranslate"><span class="pre">QuadrupoleTrapSimulation.xml</span></code>
file is a follows:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;vtk_window</span>
    <span class="na">name=</span><span class="s">&quot;vtk_window&quot;</span>
    <span class="na">enable_display=</span><span class="s">&quot;true&quot;</span>
    <span class="na">enable_write=</span><span class="s">&quot;true&quot;</span>
    <span class="na">frame_title=</span><span class="s">&quot;KGeoBag Visualization&quot;</span>
    <span class="na">frame_size_x=</span><span class="s">&quot;1024&quot;</span>
    <span class="na">frame_size_y=</span><span class="s">&quot;768&quot;</span>
    <span class="na">frame_color_red=</span><span class="s">&quot;.2&quot;</span>
    <span class="na">frame_color_green=</span><span class="s">&quot;.2&quot;</span>
    <span class="na">frame_color_blue=</span><span class="s">&quot;.2&quot;</span>
    <span class="na">view_angle=</span><span class="s">&quot;45&quot;</span>
    <span class="na">eye_angle=</span><span class="s">&quot;0.5&quot;</span>
    <span class="na">multi_samples=</span><span class="s">&quot;4&quot;</span>
    <span class="na">depth_peeling=</span><span class="s">&quot;10&quot;</span>
<span class="nt">&gt;</span>
    <span class="nt">&lt;vtk_geometry_painter</span>
        <span class="na">name=</span><span class="s">&quot;geometry_painter&quot;</span>
        <span class="na">surfaces=</span><span class="s">&quot;world/quadrupole_trap/#&quot;</span>
    <span class="nt">/&gt;</span>
    <span class="nt">&lt;vtk_track_painter</span>
        <span class="na">name=</span><span class="s">&quot;track_painter&quot;</span>
        <span class="na">path=</span><span class="s">&quot;[output_path]&quot;</span>
        <span class="na">file=</span><span class="s">&quot;QuadrupoleTrapSimulation.root&quot;</span>
        <span class="na">point_object=</span><span class="s">&quot;component_step_world&quot;</span>
        <span class="na">point_variable=</span><span class="s">&quot;position&quot;</span>
        <span class="na">color_object=</span><span class="s">&quot;component_step_cell&quot;</span>
        <span class="na">color_variable=</span><span class="s">&quot;polar_angle_to_b&quot;</span>
    <span class="nt">/&gt;</span>
<span class="nt">&lt;/vtk_window&gt;</span>
</code></pre></div></div>
<p>Note that the visualization window must be placed outside of the <code class="docutils literal notranslate"><span class="pre">&lt;kassiopeia&gt;</span></code>…``&lt;/kassiopiea&gt;``
environment tags.</p>
<p>Similarly, a visualization window can be activated that uses the ROOT software. In constrast to VTK, which displays
three-dimensional geometry, the ROOT visualization is limited to two dimensions. A simple example that may be added
to the <code class="docutils literal notranslate"><span class="pre">QuadrupoleTrapSimulation.xml</span></code> file is as follows:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><code><span class="nt">&lt;root_window</span>
    <span class="na">name=</span><span class="s">&quot;root_window plot&quot;</span>
    <span class="na">canvas_width=</span><span class="s">&quot;1000&quot;</span>
    <span class="na">canvas_height=</span><span class="s">&quot;600&quot;</span>
    <span class="na">active=</span><span class="s">&quot;active&quot;</span>
<span class="nt">&gt;</span>
    <span class="nt">&lt;root_geometry_painter</span>
        <span class="na">name=</span><span class="s">&quot;root_geometry_painter&quot;</span>
        <span class="na">surfaces=</span><span class="s">&quot;world/quadrupole_trap/#&quot;</span>
        <span class="na">plane_normal=</span><span class="s">&quot;1 0 0&quot;</span>
        <span class="na">plane_point=</span><span class="s">&quot;0 0 0&quot;</span>
        <span class="na">swap_axis=</span><span class="s">&quot;true&quot;</span>
    <span class="nt">/&gt;</span>
    <span class="nt">&lt;root_track_painter</span>
        <span class="na">name=</span><span class="s">&quot;root_track_painter&quot;</span>
        <span class="na">path=</span><span class="s">&quot;[output_path]&quot;</span>
        <span class="na">file=</span><span class="s">&quot;QuadrupoleTrapSimulation.root&quot;</span>
        <span class="na">x_axis=</span><span class="s">&quot;z&quot;</span>
        <span class="na">y_axis=</span><span class="s">&quot;x&quot;</span>
        <span class="na">step_output_group_name=</span><span class="s">&quot;component_step_world&quot;</span>
        <span class="na">position_name=</span><span class="s">&quot;position&quot;</span>
    <span class="nt">/&gt;</span>
<span class="nt">&lt;/root_window&gt;</span>
</code></pre></div></div>
</div>
<div class="section" id="common-pitfalls-and-problems">
<h2>Common Pitfalls and Problems<a class="headerlink" href="#common-pitfalls-and-problems" title="Permalink to this headline">¶</a></h2>
<p>The XML parser does have some ability to recognize simple errors in a configuration file and will generally report the
location of an element which it is not able to process.</p>
<p>Some errors which might occur if a file is improperly configured are:</p>
<ul class="simple">
<li><p>Multiple objects which share the same name at the same scope.</p></li>
<li><p>Misspelled element types.</p></li>
<li><p>Missing closing brackets.</p></li>
<li><p>Undefined variables.</p></li>
<li><p>Undeclared (but used) elements.</p></li>
</ul>
<p>In the case of more than one copy of the same object with the name <code class="docutils literal notranslate"><span class="pre">&lt;max_z&gt;</span></code>, the XML parser will fail with with an error
along the lines of:</p>
<div class="highlight- notranslate"><div class="highlight"><pre><code>[INITIALIZATION ERROR MESSAGE] Multiple instances of object with name &lt;max_z&gt;.
</code></pre></div></div>
<p>In the case where an element’s type name is misspelled the parser will fail with an unreconized element error, or
display a warning that the element is ignored. For example if we misspelled <code class="docutils literal notranslate"><span class="pre">ksterm_max_z</span></code> as <code class="docutils literal notranslate"><span class="pre">kterm_max_z</span></code> we would
recieve the following warning:</p>
<div class="highlight- notranslate"><div class="highlight"><pre><code>[INITIALIZATION WARNING MESSAGE] nothing registered for element &lt;kterm_max_z&gt; in element &lt;kassiopeia&gt;
</code></pre></div></div>
<p>If there is a mis-matched bracket the intialization will usually fail with an unrecongnized character error, such as:</p>
<div class="highlight- notranslate"><div class="highlight"><pre><code>[INITIALIZATION ERROR MESSAGE] element &lt;X&gt; encountered an error &lt;got unknown character &lt;&lt;&gt;&gt;
</code></pre></div></div>
<p>If a variable “[X]” is used without being previously defined, and undefined error will be reported as follows:</p>
<div class="highlight- notranslate"><div class="highlight"><pre><code>[INITIALIZATION ERROR MESSAGE] variable &lt;X&gt; is not defined
</code></pre></div></div>
<p>If there is an attempt to retrieve/reference and element which has not been declared the the simulation will fail with
the message:</p>
<div class="highlight- notranslate"><div class="highlight"><pre><code>[INITIALIZATION WARNING MESSAGE] No suitable Object called &lt;X&gt; in Toolbox
</code></pre></div></div>
<p>Depening on where the element is referenced, the error may look different. For example:</p>
<div class="highlight- notranslate"><div class="highlight"><pre><code>[KSOBJECT ERROR MESSAGE] component &lt;Y&gt; could not build command named &lt;X&gt; (invalid child component)
</code></pre></div></div>
<p class="rubric">Footnotes</p>
<p>[1] Daniel Lawrence Furse. Techniques for direct neutrino mass measurement utilizing tritium [beta]-decay. PhD thesis, Massachusetts Institute of Technology, 2015.</p>
<p>[2] Thomas Corona. Methodology and application of high performance electrostatic field simulation in the KATRIN experiment. PhD thesis, University of North Carolina, Chapel Hill, 2014.</p>
<p>[3] John P. Barrett. A Spatially Resolved Study of the KATRIN Main Spectrometer Using a Novel Fast Multipole Method. PhD thesis, Massachusetts Institute of Technology, 2016.</p>
</div>
</div>


    </article><section class="flex justify-between pt-4 mt-12">
  
  <div class="mr-auto">
    <span class="uppercase text-xs text-gray-light tracking-wider block mb-2">Previous</span>
    <a
      href="examples.html"
      title="Go to previous page"
      class="block text-link hover:text-brand focus:text-brand hover:underline focus:underline"
      >Examples and Tests</a>
  </div>
  
  
  <div class="ml-auto">
    <span class="uppercase text-xs text-gray-light tracking-wider block mb-2 text-right">Next</span>
    <a
      href="kgeobag_basic.html"
      title="Go to next page"
      class="block text-link hover:text-brand focus:text-brand hover:underline focus:underline"
      >Basic Shapes in KGeoBag</a>
  </div>
  
</section>

    <footer>
      
        <div class="mt-20 mb-4 text-sm text-gray-700">&copy; 2016-2021, The Kassiopeia developers.&nbsp;Made with <a href="https://www.sphinx-doc.org">Sphinx 4.4.0</a></div>
      
    </footer></main>


      <button
  data-search-target="snackbar"
  data-action="search#hideSnackbar"
  class="fixed bottom-0 right-0 z-20 opacity-0 p-4 m-4 tracking-wide bg-gray-900 text-gray-100 transition transform transform-gpu duration-500 translate-y-full"
>
  Clear highlights
</button><div
  data-sidebar-target="screen"
  data-action="click->sidebar#close"
  class="fixed hidden inset-0 bg-black bg-opacity-50">
</div>
    </div>
    
      
  <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
  <script src="_static/jquery.js"></script>
  <script src="_static/underscore.js"></script>
  <script src="_static/doctools.js"></script>
<script src="_static/theme.1ba02c30758e6036ba31.js"></script>
    
  </body>
</html>