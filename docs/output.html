
<!DOCTYPE html>

<html lang="en">
<head>
<meta content="ie=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta charset="utf-8"/>
<title>
      Understanding Simulation Output | Kassiopeia 3.7 documentation
    </title>
<link href="_static/pygments.css" rel="stylesheet"/>
<link href="_static/theme.css" rel="stylesheet"/>
<link href="_static/graphviz.css" rel="stylesheet"/>
<link href="search.html" rel="search" title="Search"/>
<link href="genindex.html" rel="index" title="Index"/>
<link href="tools.html" rel="next" title="Additional Simulation Tools"/>
<link href="kgeobag_complex.html" rel="prev" title="Complex Shapes in KGeoBag"/>
</head><body class="text-gray-900 antialiased min-h-screen md:h-screen flex flex-col">
<a class="block text-xl bg-white px-8 py-4 z-20 absolute top-0 inset-x-0 text-center transform -translate-y-full focus:translate-y-0 focus:outline-none transition-transform duration-75" href="#understanding-simulation-output" title="Skip navigation links">Skip to content</a>
<header class="md:sticky top-0 bg-gray-900 shadow-md flex md:flex-row justify-between items-center z-10"><a aria-label="Back to homepage" class="py-4 hover:bg-gray-700 focus:bg-gray-700 tooltipped tooltipped-se" href="index.html">
<img alt="Logo" class="h-8 mx-5" src="_static/KassiopeiaLogo_1_cropped_bb.png"/>
</a><h2 class="text-xl text-gray-100 mx-5 py-4">Kassiopeia 3.7 documentation</h2><form action="search.html" class="hidden md:flex my-auto mx-5 justify-between items-center print:hidden" id="searchbox" method="get">
<input aria-label="Search the docs" class="p-2 flex-1 focus:bg-yellow-100" id="search-input" name="q" placeholder="Search the docs" style="width: 300px;" type="search"/>
<button aria-label="Get search results" class="p-2 text-white bg-gray-700 hover:bg-gray-200 hover:text-pink-500 focus:bg-gray-200 focus:text-pink-500 tooltipped tooltipped-sw">
<svg aria-hidden="true" class="fill-current stroke-current h-6 w-6" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg>
</button>
</form>
</header>
<div class="md:overflow-hidden flex flex-col md:flex-row flex-1"><nav class="h-full fixed md:relative inset-y-0 left-0 z-20 md:z-0 bg-white text-gray-700 border-r overflow-x-hidden pt-16 print:hidden flex flex-col" data-menu="closed" role="navigation" style="width: 270px;">
<div class="nav-toc"><ul class="current">
<li class="toctree-l1"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="introduction.html"> Introduction</a></div><ul>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" href="introduction.html#the-kasper-framework">The Kasper framework</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" href="introduction.html#extending-functionality">Extending Functionality</a></div></li>
</ul>
</li>
<li class="toctree-l1"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="external_documentation.html"> External Documentation, Citation and Contact</a></div><ul>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" href="external_documentation.html#external-references">External references</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" href="external_documentation.html#developer-contact">Developer contact</a></div></li>
</ul>
</li>
<li class="toctree-l1"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="compiling.html"> Getting Started</a></div><ul>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" href="compiling.html#downloading-the-code">Downloading the code</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" href="compiling.html#supported-operating-systems-and-hardware-requirements">Supported operating systems and hardware requirements</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" href="compiling.html#docker-image">Docker image</a></div></li>
<li class="toctree-l2"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="compiling.html#required-software-dependencies">Required software dependencies</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="compiling.html#minimum-requirements">Minimum requirements</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="compiling.html#required-dependencies">Required dependencies</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="compiling.html#optional-dependencies">Optional dependencies</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="compiling.html#external-libraries">External libraries</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="compiling.html#compiling-the-code-using-cmake">Compiling the code using CMake</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="compiling.html#environment-variables">Environment variables</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="compiling.html#directory-structure-and-environmental-variables">Directory structure and environmental variables</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="compiling.html#executing-kassiopeia">Executing Kassiopeia</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="compiling.html#configuring-optional-dependencies">Configuring optional dependencies</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="compiling.html#build-options">Build options</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="compiling.html#kassiopeia-module">Kassiopeia module</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="compiling.html#kemfield-module">KEMField module</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="compiling.html#kgeobag-module">KGeoBag module</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="compiling.html#kommon-module">Kommon module</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="compiling.html#miscellaneous-options">Miscellaneous options</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="examples.html"> Examples and Tests</a></div><ul>
<li class="toctree-l2"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="examples.html#running-kassiopeia">Running Kassiopeia</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="examples.html#verbosity-levels">Verbosity levels</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="examples.html#output-files">Output files</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="examples.html#example-configurations">Example configurations</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="examples.html#the-dipole-trap-example">The Dipole Trap Example</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="examples.html#the-quadrupole-trap-example">The Quadrupole Trap Example</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="examples.html#the-photomultiplier-tube-example">The Photomultiplier Tube Example</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="examples.html#other-examples">Other Examples</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="configuration.html"> Configuring Your Own Simulation</a></div><ul>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" href="configuration.html#overview-and-units">Overview and Units</a></div></li>
<li class="toctree-l2"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="configuration.html#xml-parsing-and-features">XML Parsing and Features</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="configuration.html#variables">Variables</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="configuration.html#including-external-files">Including external files</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="configuration.html#print-statements">Print statements</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="configuration.html#formula-expressions">Formula Expressions</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="configuration.html#conditional-expressions-and-looping">Conditional Expressions and Looping</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="configuration.html#comments">Comments</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="configuration.html#messaging-system">Messaging System</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="configuration.html#verbosity-levels">Verbosity levels</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="configuration.html#additional-logging">Additional logging</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="configuration.html#geometry">Geometry</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="configuration.html#shapes-and-assemblies">Shapes and assemblies</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="configuration.html#tagging-system">Tagging system</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="configuration.html#assembling-elements">Assembling elements</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="configuration.html#transformations">Transformations</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="configuration.html#extensions">Extensions</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" href="configuration.html#kemfield">KEMField</a></div></li>
<li class="toctree-l2"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="configuration.html#fields">Fields</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="configuration.html#electric">Electric</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="configuration.html#magnetic">Magnetic</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" href="configuration.html#kassiopeia">Kassiopeia</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" href="configuration.html#generation">Generation</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" href="configuration.html#termination">Termination</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" href="configuration.html#propagation">Propagation</a></div></li>
<li class="toctree-l2"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="configuration.html#interactions">Interactions</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="configuration.html#volume-interactions">Volume Interactions</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="configuration.html#surface-interactions">Surface Interactions</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="configuration.html#output">Output</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="configuration.html#writers">Writers</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="configuration.html#output-description">Output description</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" href="configuration.html#navigation">Navigation</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" href="configuration.html#navigation-and-commands">Navigation and Commands</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" href="configuration.html#simulation">Simulation</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" href="configuration.html#visualization">Visualization</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" href="configuration.html#common-pitfalls-and-problems">Common Pitfalls and Problems</a></div></li>
</ul>
</li>
<li class="toctree-l1"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="kgeobag_basic.html"> Basic KGeoBag Shapes</a></div><ul>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#basic-elements">Basic elements</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#poly-loop">Poly-loop</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#poly-line">Poly-line</a></div></li>
<li class="toctree-l2"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="kgeobag_basic.html#surfaces">Surfaces</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#flattened-circle-surface">Flattened circle surface</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#flattened-poly-loop-surface">Flattened poly-loop surface</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#rotated-surfaces">Rotated Surfaces</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#rotated-line-segment-surface">Rotated line segment surface</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#rotated-arc-segment-surface">Rotated arc segment surface</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#rotated-poly-line-surface">Rotated poly-line surface</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#rotated-circle-surface">Rotated circle surface</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#rotated-poly-loop-surface">Rotated poly loop surface</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#shell-surfaces">Shell Surfaces</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#shell-line-segment-surface">Shell line segment surface</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#shell-arc-segment-surface">Shell arc segment surface</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#shell-poly-line-surface">Shell poly-line surface</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#shell-circle-surface">Shell circle surface</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#shell-poly-loop-surface">Shell poly-loop surface</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="kgeobag_basic.html#extruded-surfaces">Extruded Surfaces</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#extruded-poly-line-surface">Extruded poly-line surface</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#extruded-circle-surface">Extruded circle surface</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#extruded-poly-loop-surface">Extruded poly-loop surface</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="kgeobag_basic.html#special-surfaces">Special Surfaces</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#disk-surface">Disk surface</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#annulus-surface">Annulus surface</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#cylinder-surface">Cylinder surface</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#cone-surface">Cone Surface</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#cut-cone-surface">Cut Cone Surface</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#torus-surface">Torus Surface</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#cut-torus-surface">Cut Torus Surface</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#spaces">Spaces</a></div></li>
<li class="toctree-l2"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="kgeobag_basic.html#extruded-spaces">Extruded Spaces</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#extruded-circle-space">Extruded Circle Space</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#extruded-poly-loop-space">Extruded Poly-Loop Space</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="kgeobag_basic.html#rotated-spaces">Rotated Spaces</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#rotated-line-segment">Rotated Line Segment</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#rotated-arc-segment">Rotated Arc Segment</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#rotated-poly-line-space">Rotated Poly-Line Space</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#rotated-circle-space">Rotated Circle Space</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#rotated-poly-loop-space">Rotated Poly-Loop Space</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="kgeobag_basic.html#special-spaces">Special Spaces</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#cylinder-space">Cylinder Space</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#cone-space">Cone Space</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#cut-cone-space">Cut Cone Space</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#torus-space">Torus Space</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#cylinder-tube-space">Cylinder Tube Space</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#cut-cone-tube-space">Cut Cone Tube Space</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_basic.html#box-space">Box Space</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="kgeobag_complex.html"> Complex KGeoBag Shapes</a></div><ul>
<li class="toctree-l2"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="kgeobag_complex.html#surfaces">Surfaces</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_complex.html#pump-port">Pump Port</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_complex.html#conic-section-pump-port">Conic section pump port</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_complex.html#beam">Beam</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_complex.html#rod">Rod</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_complex.html#extruded-surfaces-with-holes">Extruded surfaces with holes</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_complex.html#rotated-surface">Rotated surface</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="kgeobag_complex.html#spaces">Spaces</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_complex.html#pump-port-space">Pump Port Space</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_complex.html#conic-section-pump-port-space">Conic Section Pump Port Space</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_complex.html#beam-space">Beam Space</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_complex.html#rod-space">Rod Space</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_complex.html#extruded-space">Extruded Space</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="kgeobag_complex.html#rotated-space">Rotated Space</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current expanded"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="current reference internal" href="#"> Understanding Simulation Output</a></div><ul>
<li class="toctree-l2"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="#output-configuration">Output configuration</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="#groups-and-fields">Groups and fields</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="#output-structure">Output structure</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="#root-output-files">ROOT output files</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="#data-structure">Data structure</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="#accessing-simulation-data">Accessing simulation data</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="#using-kassiopeia">Using Kassiopeia</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="#using-root">Using ROOT</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="#using-python">Using Python</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="#kassiopeiareader">KassiopeiaReader</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="#uproot-pandas">uproot / Pandas</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="#vtk-output-files">VTK output files</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="#id13">Data structure</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg aria-hidden="true" class="expand" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" href="#id14">Accessing simulation data</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" href="#using-paraview">Using ParaView</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" href="#ascii-output-files">ASCII output files</a></div></li>
</ul>
</li>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" href="tools.html"> Additional Simulation Tools</a></div></li>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" href="visualization.html"> Visualization Techniques</a></div></li>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" href="license.html"> License</a></div></li>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" href="authors.html"> Authors</a></div></li>
</ul>
</div>
<button aria-label="Close menu" class="text-4xl text-gray-800 p-4 bottom-0 hover:text-pink-500 md:hidden focus:text-pink-500 self-center" id="closeNavBtn" title="Close menu">
<svg aria-hidden="true" class="fill-current stroke-current h-6 w-6" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="overflow-y-auto md:w-full flex flex-col flex-1" id="main-wrapper">
<main class="px-5 md:ml-fluid flex-1" role="main"><nav aria-label="breadcrumbs" class="mt-16 mb-12 text-sm text-gray-700 leading-tight print:hidden" role="navigation">
<a class="text-blue-700" href="index.html">Kassiopeia 3.7 documentation</a>
<span class="text-gray-700 mr-1"> • </span><span aria-current="page">Understanding Simulation Output</span>
</nav>
<section id="understanding-simulation-output">
<span id="output-label"></span><h1>Understanding Simulation Output<a aria-label="Copy link to section: Understanding Simulation Output." class="headerlink tooltipped tooltipped-ne" href="#understanding-simulation-output" role="button"><svg pointer-events="none" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h1>
<p>This section provides a description of the output files created by a <em>Kassiopeia</em> simulation, along with examples to
read and analyze the files.</p>
<section id="output-configuration">
<h2>Output configuration<a aria-label="Copy link to section: Output configuration." class="headerlink tooltipped tooltipped-ne" href="#output-configuration" role="button"><svg pointer-events="none" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>Generally, <em>Kassiopeia</em> output is written to <a class="reference external" href="https://root.cern.ch/">ROOT<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a> output (.root) files that store simulation data at the run, event,
track and step level. In addition, if <em>Kassiopeia</em> was compiled with <a class="reference external" href="http://www.vtk.org/">VTK<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a> support, output files in VTK polydata (.vtp)
format may be written. These files are mainly intended for visualization, e.g. with the <a class="reference external" href="http://www.paraview.org/">ParaView<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a> software. It is
also possible to write simulation data as plaintext ASCII files, however this is not recommened for large simulations.</p>
<p>As explained in <a class="reference internal" href="configuration.html#configuration-label"><span class="std std-ref">Configuring Your Own Simulation</span></a>, the output format is configured by the available writers. Writers use the
description of the output format in the XML configuration file, which specifies the output fields that will be written
to file. Different output descriptions may be used for different writers.</p>
<section id="groups-and-fields">
<h3>Groups and fields<a aria-label="Copy link to section: Groups and fields." class="headerlink tooltipped tooltipped-ne" href="#groups-and-fields" role="button"><svg pointer-events="none" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h3>
<p>Structured output formats like ROOT and VTK allow to combine several output fields into a common group. This is not
only useful for analyzing the simulation results, but also allows to distinguish between data produces at the run,
event, track and step levels. An output group may be defined by the structure:</p>
<div class="highlight">
<div class="code-header">
<span class="code-lang">xml</span>
<button aria-label="Copy this code" class="copy tooltipped tooltipped-nw"><svg aria-hidden="true" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/xvg"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button>
</div>
<pre><code><span class="nt">&lt;output_group</span> <span class="na">name=</span><span class="s">"output_step_world"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"step_id"</span> <span class="na">field=</span><span class="s">"step_id"</span> <span class="na">parent=</span><span class="s">"step"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/output_group&gt;</span>
</code></pre></div>
<p>or, alternatively in the older XML syntax:</p>
<div class="highlight">
<div class="code-header">
<span class="code-lang">xml</span>
<button aria-label="Copy this code" class="copy tooltipped tooltipped-nw"><svg aria-hidden="true" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/xvg"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button>
</div>
<pre><code><span class="nt">&lt;ks_component_group</span> <span class="na">name=</span><span class="s">"output_step_world"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"step_id"</span> <span class="na">field=</span><span class="s">"step_id"</span> <span class="na">parent=</span><span class="s">"step"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ks_component_group&gt;</span>
</code></pre></div>
<p>In this case, the output file will have one group <cite>output_step_world</cite> that contains one member field <cite>step_id</cite> and is
updated at the step level, meaning that one entry will be added to the member field with each simulation step.</p>
<p>In the case above, the member field <cite>step_id</cite> refers to an attribute of the step class <a href="#id1"><span class="problematic" id="id2">:kassiopeia:`KSStep`</span></a>. Similar
fields are available in the other classes, such as <a href="#id3"><span class="problematic" id="id4">:kassiopeia:`KSTrack`</span></a>. However, in a typical simulation one also
wants to access physical attributes of the simulated particle. This is possible at the step level as well. In this case,
one may access the initial or final state of the particle in each step (where the initial state of one step equals the
final state of the preceding step, unless it is the first step in which the particle was generated). For example:</p>
<div class="highlight">
<div class="code-header">
<span class="code-lang">xml</span>
<button aria-label="Copy this code" class="copy tooltipped tooltipped-nw"><svg aria-hidden="true" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/xvg"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button>
</div>
<pre><code><span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"step_initial_particle"</span> <span class="na">field=</span><span class="s">"final_particle"</span> <span class="na">parent=</span><span class="s">"step"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"step_final_particle"</span> <span class="na">field=</span><span class="s">"final_particle"</span> <span class="na">parent=</span><span class="s">"step"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;output_group</span> <span class="na">name=</span><span class="s">"output_step_world"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"step_id"</span> <span class="na">field=</span><span class="s">"step_id"</span> <span class="na">parent=</span><span class="s">"step"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"initial_position"</span> <span class="na">field=</span><span class="s">"position"</span> <span class="na">parent=</span><span class="s">"step_initial_particle"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"final_position"</span> <span class="na">field=</span><span class="s">"position"</span> <span class="na">parent=</span><span class="s">"step_final_particle"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/output_group&gt;</span>
</code></pre></div>
<p>writes the initial and final particle position at each step to file. Note that in this case, one must declare a member
field <cite>step_…_particle</cite> that can be referenced inside the output group. Because the declaration is outside the group
it is not written to file, and so the output file will contain three fields at the step level. The at the track level:</p>
<div class="highlight">
<div class="code-header">
<span class="code-lang">xml</span>
<button aria-label="Copy this code" class="copy tooltipped tooltipped-nw"><svg aria-hidden="true" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/xvg"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button>
</div>
<pre><code><span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"track_initial_particle"</span> <span class="na">field=</span><span class="s">"initial_particle"</span> <span class="na">parent=</span><span class="s">"track"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"track_final_particle"</span> <span class="na">field=</span><span class="s">"final_particle"</span> <span class="na">parent=</span><span class="s">"track"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;output_group</span> <span class="na">name=</span><span class="s">"output_track_world"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"track_id"</span> <span class="na">field=</span><span class="s">"track_id"</span> <span class="na">parent=</span><span class="s">"track"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"initial_position"</span> <span class="na">field=</span><span class="s">"position"</span> <span class="na">parent=</span><span class="s">"track_initial_particle"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"final_position"</span> <span class="na">field=</span><span class="s">"position"</span> <span class="na">parent=</span><span class="s">"track_final_particle"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/output_group&gt;</span>
</code></pre></div>
<p>Vector data like the particle position is stored as an array of <cite>(x,y,z)</cite> components for each entry. Similarly, tensor
data is stored as an array of nine components. One may also store derived attributes like magnitude or radius:</p>
<div class="highlight">
<div class="code-header">
<span class="code-lang">xml</span>
<button aria-label="Copy this code" class="copy tooltipped tooltipped-nw"><svg aria-hidden="true" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/xvg"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button>
</div>
<pre><code><span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"step_initial_particle"</span> <span class="na">field=</span><span class="s">"final_particle"</span> <span class="na">parent=</span><span class="s">"step"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"initial_position"</span> <span class="na">field=</span><span class="s">"position"</span> <span class="na">parent=</span><span class="s">"step_initial_particle"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;output_group</span> <span class="na">name=</span><span class="s">"output_step_world"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"initial_position"</span> <span class="na">field=</span><span class="s">"position"</span> <span class="na">parent=</span><span class="s">"step_initial_particle"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"initial_radius"</span> <span class="na">field=</span><span class="s">"perp"</span> <span class="na">parent=</span><span class="s">"initial_position"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/output_group&gt;</span>
</code></pre></div>
<p>In addition to simple fields that reference internal attributes, some advanced calculation features are available:</p>
<ul class="simple">
<li><p><cite>math</cite> allows to evaluate arbitrary functions (using <a class="reference external" href="https://root.cern.ch/">ROOT<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a>’s <code class="docutils literal notranslate">TFormula</code> class) that references one or more existing
members.</p></li>
<li><p><cite>integral</cite> calculates the discrete integral of the referenced member field.</p></li>
<li><p><cite>delta</cite> calculates the difference between the current value of a member field to the previous one.</p></li>
<li><p><cite>minimum</cite> and <cite>maximum</cite> calculate the minimum/maximum value of a member field over the given interval (e.g. a track).</p></li>
<li><p><cite>minimum_at</cite> and <cite>maximum_at</cite> calculate the position of the minimum/maximum value.</p></li>
</ul>
<p>The example below shows usage of these advanced fields:</p>
<div class="highlight">
<div class="code-header">
<span class="code-lang">xml</span>
<button aria-label="Copy this code" class="copy tooltipped tooltipped-nw"><svg aria-hidden="true" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/xvg"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button>
</div>
<pre><code><span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"step_final_particle"</span> <span class="na">field=</span><span class="s">"final_particle"</span> <span class="na">parent=</span><span class="s">"step"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"step_kinetic_energy"</span> <span class="na">field=</span><span class="s">"kinetic_energy_ev"</span> <span class="na">parent=</span><span class="s">"step_final_particle"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"step_polar_angle_to_b"</span> <span class="na">field=</span><span class="s">"polar_angle_to_b"</span> <span class="na">parent=</span><span class="s">"step_final_particle"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;output_group</span> <span class="na">name=</span><span class="s">"output_step_world"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"kinetic_energy"</span> <span class="na">field=</span><span class="s">"kinetic_energy_ev"</span> <span class="na">parent=</span><span class="s">"step_final_particle"</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- change in kinetic energy at each step --&gt;</span>
    <span class="nt">&lt;output_delta</span> <span class="na">name=</span><span class="s">"kinetic_energy_change"</span> <span class="na">parent=</span><span class="s">"step_kinetic_energy"</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- longitudinal kinetic energy at each step, derived from kinetic energy and pitch angle --&gt;</span>
    <span class="nt">&lt;output_math</span> <span class="na">name=</span><span class="s">"long_kinetic_energy"</span> <span class="na">term=</span><span class="s">"x0*cos(x1*TMath::Pi()/180.)*cos(x1*TMath::Pi()/180.)"</span>
            <span class="na">parent=</span><span class="s">"step_kinetic_energy"</span> <span class="na">parent=</span><span class="s">"step_polar_angle_to_b"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/output_group&gt;</span>

<span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"step_length"</span> <span class="na">field=</span><span class="s">"continuous_length"</span> <span class="na">parent=</span><span class="s">"step"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;output_group</span> <span class="na">name=</span><span class="s">"output_track_world"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- value and position of minimum/maximum kinetic energy over each track --&gt;</span>
    <span class="nt">&lt;output_maximum</span> <span class="na">name=</span><span class="s">"max_kinetic_energy"</span> <span class="na">group=</span><span class="s">"output_step_world"</span> <span class="na">parent=</span><span class="s">"kinetic_energy"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output_minimum</span> <span class="na">name=</span><span class="s">"min_kinetic_energy"</span> <span class="na">group=</span><span class="s">"output_step_world"</span> <span class="na">parent=</span><span class="s">"kinetic_energy"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output_maximum_at</span> <span class="na">name=</span><span class="s">"max_kinetic_energy_position"</span> <span class="na">group=</span><span class="s">"output_step_world"</span> <span class="na">parent=</span><span class="s">"kinetic_energy"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output_minimum_at</span> <span class="na">name=</span><span class="s">"min_kinetic_energy_position"</span> <span class="na">group=</span><span class="s">"output_step_world"</span> <span class="na">parent=</span><span class="s">"kinetic_energy"</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- integrated length of all steps in each track --&gt;</span>
    <span class="nt">&lt;output_integral</span> <span class="na">name=</span><span class="s">"total_length"</span> <span class="na">parent=</span><span class="s">"step_length"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/output_group&gt;</span>
</code></pre></div>
</section>
<section id="output-structure">
<h3>Output structure<a aria-label="Copy link to section: Output structure." class="headerlink tooltipped tooltipped-ne" href="#output-structure" role="button"><svg pointer-events="none" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h3>
<p>For the remainder of this section, we will refer to the <code class="docutils literal notranslate">QuadrupoleTrapSimulation.xml</code> example file to discuss the
output fields and their structure. Here is the (slightly shortened) output confuguration of this example:</p>
<div class="highlight">
<div class="code-header">
<span class="code-lang">xml</span>
<button aria-label="Copy this code" class="copy tooltipped tooltipped-nw"><svg aria-hidden="true" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/xvg"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button>
</div>
<pre><code><span class="nt">&lt;output_group</span> <span class="na">name=</span><span class="s">"component_step_world"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"step_id"</span> <span class="na">field=</span><span class="s">"step_id"</span> <span class="na">parent=</span><span class="s">"step"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"continuous_time"</span> <span class="na">field=</span><span class="s">"continuous_time"</span> <span class="na">parent=</span><span class="s">"step"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"continuous_length"</span> <span class="na">field=</span><span class="s">"continuous_length"</span> <span class="na">parent=</span><span class="s">"step"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"number_of_turns"</span> <span class="na">field=</span><span class="s">"number_of_turns"</span> <span class="na">parent=</span><span class="s">"step"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"time"</span> <span class="na">field=</span><span class="s">"time"</span> <span class="na">parent=</span><span class="s">"component_step_final_particle"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"position"</span> <span class="na">field=</span><span class="s">"position"</span> <span class="na">parent=</span><span class="s">"component_step_final_particle"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"momentum"</span> <span class="na">field=</span><span class="s">"momentum"</span> <span class="na">parent=</span><span class="s">"component_step_final_particle"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"magnetic_field"</span> <span class="na">field=</span><span class="s">"magnetic_field"</span> <span class="na">parent=</span><span class="s">"component_step_final_particle"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"electric_field"</span> <span class="na">field=</span><span class="s">"electric_field"</span> <span class="na">parent=</span><span class="s">"component_step_final_particle"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"electric_potential"</span> <span class="na">field=</span><span class="s">"electric_potential"</span> <span class="na">parent=</span><span class="s">"component_step_final_particle"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"kinetic_energy"</span> <span class="na">field=</span><span class="s">"kinetic_energy_ev"</span> <span class="na">parent=</span><span class="s">"component_step_final_particle"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/output_group&gt;</span>

<span class="nt">&lt;output_group</span> <span class="na">name=</span><span class="s">"component_step_cell"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"polar_angle_to_z"</span> <span class="na">field=</span><span class="s">"polar_angle_to_z"</span> <span class="na">parent=</span><span class="s">"component_step_final_particle"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"polar_angle_to_b"</span> <span class="na">field=</span><span class="s">"polar_angle_to_b"</span> <span class="na">parent=</span><span class="s">"component_step_final_particle"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"guiding_center_position"</span> <span class="na">field=</span><span class="s">"guiding_center_position"</span> <span class="na">parent=</span><span class="s">"component_step_final_particle"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"orbital_magnetic_moment"</span> <span class="na">field=</span><span class="s">"orbital_magnetic_moment"</span> <span class="na">parent=</span><span class="s">"component_step_final_particle"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/output_group&gt;</span>

<span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"z_length"</span> <span class="na">field=</span><span class="s">"continuous_length"</span> <span class="na">parent=</span><span class="s">"step"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;output_group</span> <span class="na">name=</span><span class="s">"component_track_world"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"creator_name"</span> <span class="na">field=</span><span class="s">"creator_name"</span> <span class="na">parent=</span><span class="s">"track"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"terminator_name"</span> <span class="na">field=</span><span class="s">"terminator_name"</span> <span class="na">parent=</span><span class="s">"track"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"total_steps"</span> <span class="na">field=</span><span class="s">"total_steps"</span> <span class="na">parent=</span><span class="s">"track"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"number_of_turns"</span> <span class="na">field=</span><span class="s">"number_of_turns"</span> <span class="na">parent=</span><span class="s">"track"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"initial_time"</span> <span class="na">field=</span><span class="s">"time"</span> <span class="na">parent=</span><span class="s">"component_track_initial_particle"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"initial_position"</span> <span class="na">field=</span><span class="s">"position"</span> <span class="na">parent=</span><span class="s">"component_track_initial_particle"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"initial_momentum"</span> <span class="na">field=</span><span class="s">"momentum"</span> <span class="na">parent=</span><span class="s">"component_track_initial_particle"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"initial_magnetic_field"</span> <span class="na">field=</span><span class="s">"magnetic_field"</span> <span class="na">parent=</span><span class="s">"component_track_initial_particle"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"initial_electric_field"</span> <span class="na">field=</span><span class="s">"electric_field"</span> <span class="na">parent=</span><span class="s">"component_track_initial_particle"</span><span class="nt">/&gt;</span>
    <span class="c">&lt;!-- ... skipped lines ... --&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"final_time"</span> <span class="na">field=</span><span class="s">"time"</span> <span class="na">parent=</span><span class="s">"component_track_final_particle"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"final_position"</span> <span class="na">field=</span><span class="s">"position"</span> <span class="na">parent=</span><span class="s">"component_track_final_particle"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"final_momentum"</span> <span class="na">field=</span><span class="s">"momentum"</span> <span class="na">parent=</span><span class="s">"component_track_final_particle"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"final_magnetic_field"</span> <span class="na">field=</span><span class="s">"magnetic_field"</span> <span class="na">parent=</span><span class="s">"component_track_final_particle"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"final_electric_field"</span> <span class="na">field=</span><span class="s">"electric_field"</span> <span class="na">parent=</span><span class="s">"component_track_final_particle"</span><span class="nt">/&gt;</span>
    <span class="c">&lt;!-- ... skipped lines ... --&gt;</span>
    <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">"z_length_internal"</span> <span class="na">field=</span><span class="s">"continuous_length"</span> <span class="na">parent=</span><span class="s">"track"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;output_integral</span> <span class="na">name=</span><span class="s">"z_length_integral"</span> <span class="na">parent=</span><span class="s">"z_length"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/output_group&gt;</span>
</code></pre></div>
<p>The output structure (with some fields skipped) is as follows:</p>
<div class="graphviz"><img alt='digraph output {
   node [fontname="helvetica", fontsize=10];
   graph [rankdir="LR"] {
     rank=same
     "component_step_world" [shape="folder", style=filled, fillcolor=yellow];
     "component_step_cell" [shape="folder", style=filled, fillcolor=yellow];
     "component_track_world" [shape="folder", style=filled, fillcolor=yellow];
   }
   {
     rank=same
     "step" [shape="rectangle", style=filled, fillcolor=lightskyblue];
     "track" [shape="rectangle", style=filled, fillcolor=lightgreen];

     "component_step_final_particle" [shape="note", style=filled, fillcolor=whitesmoke];
     "component_step_position" [shape="note", style=filled, fillcolor=whitesmoke];
     "component_step_length" [shape="note", style=filled, fillcolor=whitesmoke];
     "component_track_initial_particle" [shape="note", style=filled, fillcolor=whitesmoke];
     "component_track_final_particle" [shape="note", style=filled, fillcolor=whitesmoke];
     "component_track_position" [shape="note", style=filled, fillcolor=whitesmoke];
     "component_track_length" [shape="note", style=filled, fillcolor=whitesmoke];
     "z_length" [shape="note", style=filled, fillcolor=whitesmoke];
   }

   "component_step_world" -&gt; "step_id" -&gt; "step";
   "component_step_world" -&gt; "continuous_time" -&gt; "step";
   "component_step_world" -&gt; "continuous_length" -&gt; "step";
   "component_step_world" -&gt; "number_of_turns" -&gt; "step";
   "component_step_world" -&gt; "time" -&gt; "component_step_final_particle";
   "component_step_world" -&gt; "position" -&gt; "component_step_final_particle";
   "component_step_world" -&gt; "momentum" -&gt; "component_step_final_particle";
   "component_step_world" -&gt; "magnetic_field" -&gt; "component_step_final_particle";
   "component_step_world" -&gt; "electric_field" -&gt; "component_step_final_particle";
   "component_step_world" -&gt; "electric_potential" -&gt; "component_step_final_particle";
   "component_step_world" -&gt; "kinetic_energy" -&gt; "component_step_final_particle";

   "component_step_cell" -&gt; "polar_angle_to_z" -&gt; "component_step_final_particle";
   "component_step_cell" -&gt; "polar_angle_to_b" -&gt; "component_step_final_particle";
   "component_step_cell" -&gt; "guiding_center_position" -&gt; "component_step_final_particle";
   "component_step_cell" -&gt; "orbital_magnetic_moment" -&gt; "component_step_final_particle";

   "component_track_world" -&gt; "creator_name" -&gt; "track";
   "component_track_world" -&gt; "terminator_name" -&gt; "track";
   "component_track_world" -&gt; "total_steps" -&gt; "track";
   "component_track_world" -&gt; "number_of_turns" -&gt; "track";
   "component_track_world" -&gt; "initial_time" -&gt; "component_track_initial_particle";
   "component_track_world" -&gt; "initial_position" -&gt; "component_track_initial_particle";
   "component_track_world" -&gt; "initial_momentum" -&gt; "component_track_initial_particle";
   "component_track_world" -&gt; "initial_magnetic_field" -&gt; "component_track_initial_particle";
   "component_track_world" -&gt; "initial_electric_field" -&gt; "component_track_initial_particle";
   "component_track_world" -&gt; "final_time" -&gt; "component_track_final_particle";
   "component_track_world" -&gt; "final_position" -&gt; "component_track_final_particle";
   "component_track_world" -&gt; "final_momentum" -&gt; "component_track_final_particle";
   "component_track_world" -&gt; "final_magnetic_field" -&gt; "component_track_final_particle";
   "component_track_world" -&gt; "final_electric_field" -&gt; "component_track_final_particle";
   "component_track_world" -&gt; "z_length_internal" -&gt; "track";
   "component_track_world" -&gt; "z_length_integral" -&gt; "z_length";

   "component_step_position" -&gt; "step" [style=dashed];
   "component_step_length" -&gt; "step" [style=dashed];
   "component_step_final_particle" -&gt; "step" [style=dashed];
   "z_length" -&gt; "step" [style=dashed];

   "component_track_position" -&gt; "track" [style=dashed];
   "component_track_length" -&gt; "track" [style=dashed];
   "component_track_final_particle" -&gt; "track" [style=dashed];
   "component_track_initial_particle" -&gt; "track" [style=dashed];
}' class="graphviz" src="_images/graphviz-b3d59b33fa3e2451ab0d345255b2b57cfc2adb44.png"/></div>
<p>where the relations between the output groups (left), member fields (middle), and parent objects (right) are indicated
by connecting arrows and the different node shapes. The output groups and fields are what is visible in the output file.
Member fields either refer to a particle state of a step/track, or to attributes at the step/track level directly. The
field <cite>z_length</cite> is a special case, since an intermediate field is necessary to perform the integration at track level.</p>
</section>
</section>
<section id="root-output-files">
<h2>ROOT output files<a aria-label="Copy link to section: ROOT output files." class="headerlink tooltipped tooltipped-ne" href="#root-output-files" role="button"><svg pointer-events="none" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>The <a class="reference external" href="https://root.cern.ch/">ROOT<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a> output format is the standard file format that <em>Kassiopeia</em> produces. It supports flexible configuration,
structured data fields, and efficient storage on disk. The data fields are placed in ROOT’s <code class="docutils literal notranslate">TTree</code> and <code class="docutils literal notranslate">TLeaf</code>
objects that are created for each output group and member field, respectively.</p>
<section id="data-structure">
<h3>Data structure<a aria-label="Copy link to section: Data structure." class="headerlink tooltipped tooltipped-ne" href="#data-structure" role="button"><svg pointer-events="none" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h3>
<p>In the output file, several tree structures are present that open into a list of leafs, corresponding to the simulation
data. Here is an example view in the <a class="reference external" href="https://root.cern.ch/">ROOT<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a> <code class="docutils literal notranslate">TBrowser</code>:</p>
<a class="reference internal image-reference" href="_images/root_output.png"><img alt="_images/root_output.png" src="_images/root_output.png" style="width: 350pt;"/></a>
<p>According to the configuration in <code class="docutils literal notranslate">QuadrupoleTrapSimulation.xml</code>, three output groups have been created:
<cite>component_track_world</cite>, <cite>component_step_world</cite>, and <cite>component_step_cell</cite>. Each of these is split into several tree
in the ROOT file, distinguished by their postfix:</p>
<ul class="simple">
<li><p><cite>…_DATA</cite> contains the actual simulation data. For each output field, one leaf object (an array-like structure) is
created in the output file. In the example shown here, the <cite>component_step_world_DATA</cite> tree contains the fields
<cite>step_id</cite>, <cite>time</cite> and so on. In case of vector or tensor data, one individual field is created for each component,
e.g. <cite>position_x</cite>, <cite>position_y</cite>, <cite>position_z</cite>. All output fields are sorted by the respective index, e.g. step data
is sorted by <cite>STEP_INDEX</cite> (which is a continually increasing integer number). This allows direct access to any
specific data field at any output level. Note that the step index can be different than the <cite>step id</cite>, which is an
attribute of the <a href="#id5"><span class="problematic" id="id6">:kassiopeia:`KSStep`</span></a> class and thus defined by the simulation.</p></li>
<li><p><cite>…_PRESENCE</cite> indicates which segments in the data array contain valid data. This tree contains the fields <cite>INDEX</cite>,
referring to the start index in the output data, and <cite>LENGTH</cite>, referring to the length of one segment. When reading
values from the data arrays, these fields should be checked so that only valid data is used.</p></li>
<li><p><cite>…_STRUCTURE</cite> contains the fields <cite>LABEL</cite> and <cite>TYPE</cite>. For each output field present in the file, they indicate its
name (i.e. the name of the leaf placed under <cite>…_DATA</cite>) and its type (<code class="docutils literal notranslate">double</code> etc.). When reading the data arrays,
this information can be taken into account in order to treat data types correctly.</p></li>
</ul>
<p>Note that the data in each leaf is written continuously, i.e. there is no distinction between individual tracks, events,
or runs. This is done in order to improve storage efficiency and to provide a clean output structure. Hence, the step
index is a monotonic integer number that increases with each new value written to the output file. In order to
distinguish between different tracks, one needs to know the step indices corresponding to the start and end of the
track so that the corresponding data segment can be analyzed. This is possible with the following meta-data fields.</p>
<p>In addition to the output groups defined in the XML configuration file, several trees containing meta-data are present
in the output file. This data is always present in the <a class="reference external" href="https://root.cern.ch/">ROOT<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a> file, regardless of the output configuration:</p>
<ul class="simple">
<li><p><cite>RUN_KEYS</cite>, <cite>EVENT_KEYS</cite>, etc. contain the names of the output groups present in the file. In the example shown here,
the <cite>TRACK_KEYS</cite> tree contains one element <cite>component_track_world</cite>, while <cite>STEP_KEYS</cite> contains two elements.</p></li>
<li><p><cite>RUN_DATA</cite>, <cite>EVENT_DATA</cite>, etc. each contain a list of run/event/… indices that correspond to the internally used
indices for accessing data at the corresponding level. For example, <cite>STEP_DATA</cite> contains a field <cite>STEP_INDEX</cite>,
which holds all indices that can be accessed in the data arrays.  In addition, the <cite>…_DATA</cite> trees at higher levels
than step also provide a mapping between to the indices at the lower levels:</p>
<ul>
<li><p><cite>TRACK_DATA</cite> contains the arrays <cite>FIRST_STEP_INDEX</cite> and <cite>LAST_STEP_INDEX</cite>. For each track that is designated by
<cite>TRACK_INDEX</cite> they point to the index of the first and last step of the track. Hence if one looks at the step
output, <cite>component_step_world</cite> in this case, one may use these step indices to split the step data into individual
track segments. Similarly,</p></li>
<li><p><cite>EVENT_DATA</cite> contains the fields <cite>(FIRST|LAST)_STEP_INDEX</cite> and <cite>(FIRST|LAST)_TRACK_INDEX</cite>, and</p></li>
<li><p><cite>RUN_DATA</cite> contains  <cite>(FIRST|LAST)_STEP_INDEX</cite>, <cite>(FIRST|LAST)_TRACK_INDEX</cite>, and <cite>(FIRST|LAST)_EVENT_INDEX</cite>.</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="accessing-simulation-data">
<h2>Accessing simulation data<a aria-label="Copy link to section: Accessing simulation data." class="headerlink tooltipped tooltipped-ne" href="#accessing-simulation-data" role="button"><svg pointer-events="none" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>In most cases, for example when using the <a class="reference external" href="https://root.cern.ch/">ROOT<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a> <code class="docutils literal notranslate">TBrowser</code>, one may just look into the <cite>STEP_DATA</cite> and <cite>TRACK_DATA</cite>
fields to find the relevant information. For more sophisticated analyses, other means of accessing the data are
available.</p>
<section id="using-kassiopeia">
<h3>Using Kassiopeia<a aria-label="Copy link to section: Using Kassiopeia." class="headerlink tooltipped tooltipped-ne" href="#using-kassiopeia" role="button"><svg pointer-events="none" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h3>
<p><em>Kassiopeia</em> includes a simple analysis application that uses the <a href="#id7"><span class="problematic" id="id8">:kassiopeia:`KSReadFileROOT`</span></a> class to iterate through
the step output produced by the <cite>QuadrupoleTrapSimulation.xml</cite> example. Its code is available at
<a href="#id9"><span class="problematic" id="id10">:gh-file:`Kassiopeia/Applications/Examples/Source/QuadrupoleTrapAnalysis.cxx`</span></a> and it serves as a general example
of using this method.</p>
<p>In this case, the simulation output can be accessed in a structured way, using the run/event/track/step levels and
iterating through each component:</p>
<div class="highlight">
<div class="code-header">
<span class="code-lang">c++</span>
<button aria-label="Copy this code" class="copy tooltipped tooltipped-nw"><svg aria-hidden="true" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/xvg"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button>
</div>
<pre><code><span class="k">for</span> <span class="p">(</span><span class="n">tRunReader</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">tRunReader</span> <span class="o">&lt;=</span> <span class="n">tRunReader</span><span class="p">.</span><span class="n">GetLastRunIndex</span><span class="p">();</span> <span class="n">tRunReader</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// run analysis code</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">tEventReader</span> <span class="o">=</span> <span class="n">tRunReader</span><span class="p">.</span><span class="n">GetFirstEventIndex</span><span class="p">();</span> <span class="n">tEventReader</span> <span class="o">&lt;=</span> <span class="n">tRunReader</span><span class="p">.</span><span class="n">GetLastEventIndex</span><span class="p">();</span> <span class="n">tEventReader</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// event analysis code</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">tTrackReader</span> <span class="o">=</span> <span class="n">tEventReader</span><span class="p">.</span><span class="n">GetFirstTrackIndex</span><span class="p">();</span> <span class="n">tTrackReader</span> <span class="o">&lt;=</span> <span class="n">tEventReader</span><span class="p">.</span><span class="n">GetLastTrackIndex</span><span class="p">();</span> <span class="n">tTrackReader</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// track analysis code</span>

            <span class="k">for</span> <span class="p">(</span><span class="n">tStepReader</span> <span class="o">=</span> <span class="n">tTrackReader</span><span class="p">.</span><span class="n">GetFirstStepIndex</span><span class="p">();</span> <span class="n">tStepReader</span> <span class="o">&lt;=</span> <span class="n">tTrackReader</span><span class="p">.</span><span class="n">GetLastStepIndex</span><span class="p">();</span>  <span class="n">tStepReader</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// step analysis code</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Individual output fields are accessed via an instance of <a href="#id11"><span class="problematic" id="id12">:kassiopeia:`KSReadObjectROOT`</span></a>, as shown in the example. The
benefit of using this method is that it uses <em>Kassiopeia’s</em> internal classes that are fully compatible with the writer
class that produced the output file. On the other hand, it requires writing a custom C++ application that needs
to be compiled against <em>Kasper</em>.</p>
</section>
<section id="using-root">
<h3>Using ROOT<a aria-label="Copy link to section: Using ROOT." class="headerlink tooltipped tooltipped-ne" href="#using-root" role="button"><svg pointer-events="none" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h3>
<p>Alternatively, the output can be access directly from a <a class="reference external" href="https://root.cern.ch/">ROOT<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a> program. In this case, the ouput is accessible through
the <cite>TTreeReader</cite> interface:</p>
<div class="highlight">
<div class="code-header">
<span class="code-lang">c++</span>
<button aria-label="Copy this code" class="copy tooltipped tooltipped-nw"><svg aria-hidden="true" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/xvg"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button>
</div>
<pre><code><span class="n">TFile</span> <span class="nf">file</span><span class="p">(</span><span class="s">"QuadrupoleTrapSimulation.root"</span><span class="p">);</span>

<span class="n">TTreeReader</span> <span class="nf">track_data</span><span class="p">(</span><span class="s">"TRACK_DATA"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">file</span><span class="p">);</span>
<span class="n">TTreeReaderValue</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="o">&gt;</span> <span class="n">first_step_index</span><span class="p">(</span><span class="n">track_data</span><span class="p">,</span> <span class="s">"FIRST_STEP_INDEX"</span><span class="p">);</span>
<span class="n">TTreeReaderValue</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="o">&gt;</span> <span class="n">last_step_index</span><span class="p">(</span><span class="n">track_data</span><span class="p">,</span> <span class="s">"LAST_STEP_INDEX"</span><span class="p">);</span>

<span class="n">TTreeReader</span> <span class="nf">step_data</span><span class="p">(</span><span class="s">"component_step_cell_DATA"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">file</span><span class="p">);</span>
<span class="n">TTreeReaderValue</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">step_moment</span><span class="p">(</span><span class="n">step_data</span><span class="p">,</span> <span class="s">"orbital_magnetic_moment"</span><span class="p">);</span>

<span class="n">TTreeReader</span> <span class="nf">step_presence</span><span class="p">(</span><span class="s">"component_step_cell_PRESENCE"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">file</span><span class="p">);</span>
<span class="n">TTreeReaderValue</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="o">&gt;</span> <span class="n">valid_index</span><span class="p">(</span><span class="n">step_presence</span><span class="p">,</span> <span class="s">"INDEX"</span><span class="p">);</span>
<span class="n">TTreeReaderValue</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="o">&gt;</span> <span class="n">valid_length</span><span class="p">(</span><span class="n">step_presence</span><span class="p">,</span> <span class="s">"LENGTH"</span><span class="p">);</span>
</code></pre></div>
<p>As explained further below, here it is necessary to take into account the information from the <code class="docutils literal notranslate">TRACK_DATA</code> tree to
get the first and last step index belonging to each track, as well as the <code class="docutils literal notranslate">..._PRESENCE</code> tree to only work on valid
entries in the output group. Because the simulation only fills the <code class="docutils literal notranslate">component_step_cell</code> output in a certain region
of the geometry (the inner part of the trap), some values outside this region contain invalid values.</p>
<p>One approach to handle this structure is shown below, where the main loop iterates over each track and the inner loop
over the steps only processes valid output fields:</p>
<div class="highlight">
<div class="code-header">
<span class="code-lang">c++</span>
<button aria-label="Copy this code" class="copy tooltipped tooltipped-nw"><svg aria-hidden="true" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/xvg"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button>
</div>
<pre><code><span class="n">vector</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="p">,</span><span class="kt">unsigned</span><span class="o">&gt;&gt;</span> <span class="n">valid_steps</span><span class="p">;</span>
<span class="k">while</span> <span class="p">(</span><span class="n">step_presence</span><span class="p">.</span><span class="n">Next</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">valid_steps</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="o">*</span><span class="n">valid_index</span><span class="p">,</span> <span class="o">*</span><span class="n">valid_index</span> <span class="o">+</span> <span class="o">*</span><span class="n">valid_length</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">while</span> <span class="p">(</span><span class="n">track_data</span><span class="p">.</span><span class="n">Next</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">auto</span> <span class="n">max_moment</span> <span class="o">=</span> <span class="o">-</span><span class="n">TMath</span><span class="o">::</span><span class="n">Infinity</span><span class="p">();</span>
    <span class="k">auto</span> <span class="n">min_moment</span> <span class="o">=</span> <span class="n">TMath</span><span class="o">::</span><span class="n">Infinity</span><span class="p">();</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">step_data</span><span class="p">.</span><span class="n">Next</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">auto</span> <span class="n">index</span> <span class="o">=</span> <span class="n">step_data</span><span class="p">.</span><span class="n">GetCurrentEntry</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">&lt;</span> <span class="o">*</span><span class="n">first_step_index</span><span class="p">)</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">&gt;</span> <span class="o">*</span><span class="n">last_step_index</span><span class="p">)</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span> <span class="nl">valid</span> <span class="p">:</span> <span class="n">valid_steps</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">valid</span><span class="p">.</span><span class="n">first</span> <span class="o">&amp;&amp;</span> <span class="n">index</span> <span class="o">&lt;=</span> <span class="n">valid</span><span class="p">.</span><span class="n">second</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">step_moment</span> <span class="o">&gt;</span> <span class="n">max_moment</span><span class="p">)</span>
                    <span class="n">max_moment</span> <span class="o">=</span> <span class="o">*</span><span class="n">step_moment</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">step_moment</span> <span class="o">&lt;</span> <span class="n">min_moment</span><span class="p">)</span>
                    <span class="n">min_moment</span> <span class="o">=</span> <span class="o">*</span><span class="n">step_moment</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">auto</span> <span class="n">deviation</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_moment</span> <span class="o">-</span> <span class="n">min_moment</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">max_moment</span> <span class="o">+</span> <span class="n">min_moment</span><span class="p">);</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"extrema for track &lt;"</span> <span class="o">&lt;&lt;</span> <span class="n">deviation</span> <span class="o">&lt;&lt;</span> <span class="s">"&gt;"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</section>
<section id="using-python">
<h3>Using Python<a aria-label="Copy link to section: Using Python." class="headerlink tooltipped tooltipped-ne" href="#using-python" role="button"><svg pointer-events="none" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h3>
<p>Another common method of analysis makes use of Python libraries such as <a class="reference external" href="https://numpy.org/">NumPy<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a> and <a class="reference external" href="https://pandas.pydata.org/">Pandas<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a>. Several methods of getting
the <em>Kassiopeia</em> output into a Python script are available:</p>
<ul class="simple">
<li><p><cite>KassiopeiaReader</cite> is a Python module based on <em>PyROOT</em> (the official Python-interface of the <a class="reference external" href="https://root.cern.ch/">ROOT<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a> software). It is
essentially a wrapper around ROOT classes that takes into account the relations between <em>Kassiopeia’s</em> output levels
and allows easy iteration over step/track/… data fields. Its code is available at
<a class="reference external" href="https://github.com/KATRIN-Experiment/Kassiopeia/blob/master/Kassiopeia/Python/KassiopeiaReader.py">GitHub: Kassiopeia/Python/KassiopeiaReader.py<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a>.</p></li>
<li><p><a class="reference external" href="https://pypi.org/project/uproot/">uproot<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a> is a ROOT-less implementation of the <a class="reference external" href="https://root.cern.ch/">ROOT<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a> file interface. It allows to access <em>Kassiopeia’s</em> output data
without the ROOT dependency. Especially for large output files, this is a very efficient way of processing the
simulation results. However, it is difficult to take into account relations between the output levels; e.g. in order
to select specific steps that belong to a track or event in the simulation.</p></li>
<li><p><a class="reference external" href="https://pandas.pydata.org/">Pandas<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a> can be used together with uproot (or PyROOT) to access <em>Kassiopeia’s</em> output data in the form of a Pandas
dataframe. With some extra work, it is possible to include the relations between output levels as well.</p></li>
</ul>
<p>All three methods will be briefly explained in this section, in the form of a simple example that reproduces the
<cite>QuadrupoleTrapAnalysis.cxx</cite> code introduced above. The examples use the <a class="reference external" href="https://root.cern.ch/">ROOT<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a> file <code class="docutils literal notranslate">QuadrupoleTrapSimulation.root</code>
produced by the <code class="docutils literal notranslate">QuadrupoleTrapSimulation.xml</code> example.</p>
</section>
<section id="kassiopeiareader">
<h3>KassiopeiaReader<a aria-label="Copy link to section: KassiopeiaReader." class="headerlink tooltipped tooltipped-ne" href="#kassiopeiareader" role="button"><svg pointer-events="none" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h3>
<p>The <code class="docutils literal notranslate">KassiopeiaReader</code> Python module provides an iterator interface to a selected output group in a <em>Kassiopeia</em>
file. It can easily be used to retrieve e.g. all track or step output from a simulation. Correctly iterating over
more advanced output definitions take more effort, however. The <cite>QuadrupoleTrapSimulation</cite> is a good example for this,
because it uses an additional output region (<code class="docutils literal notranslate">component_step_cell</code>) that is only filled with data in a small section
of each particle’s trajectory.</p>
<p>To re-implement the <cite>QuadrupoleTrapAnalysis.cxx</cite> program, a few things need to be considered that are explained below.
The full example script is located at <a class="reference external" href="https://github.com/KATRIN-Experiment/Kassiopeia/blob/master/Kassiopeia/Python/Examples/QuadrupoleTrapAnalysis.py">GitHub: Kassiopeia/Python/Examples/QuadrupoleTrapAnalysis.py<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a>.</p>
<div class="highlight">
<div class="code-header">
<span class="code-lang">python</span>
<button aria-label="Copy this code" class="copy tooltipped tooltipped-nw"><svg aria-hidden="true" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/xvg"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button>
</div>
<pre><code><span class="kn">import</span> <span class="nn">KassiopeiaReader</span>

<span class="n">reader</span> <span class="o">=</span> <span class="n">KassiopeiaReader</span><span class="o">.</span><span class="n">Iterator</span><span class="p">(</span><span class="s1">'QuadrupoleTrapSimulation.root'</span><span class="p">)</span>

<span class="n">reader</span><span class="o">.</span><span class="n">loadTree</span><span class="p">(</span><span class="s1">'component_step_cell'</span><span class="p">)</span>
<span class="n">reader</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">'orbital_magnetic_moment'</span><span class="p">)</span>

<span class="n">track_step_index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">reader</span><span class="o">.</span><span class="n">getTracks</span><span class="p">(</span><span class="s1">'FIRST_STEP_INDEX'</span><span class="p">),</span> <span class="n">reader</span><span class="o">.</span><span class="n">getTracks</span><span class="p">(</span><span class="s1">'LAST_STEP_INDEX'</span><span class="p">)]))</span>

<span class="n">step_presence</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">getTree</span><span class="p">(</span><span class="s1">'component_step_cell_PRESENCE'</span><span class="p">)</span>
<span class="n">step_valid</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">step_presence</span><span class="p">[</span><span class="s1">'INDEX'</span><span class="p">],</span> <span class="n">step_presence</span><span class="p">[</span><span class="s1">'LENGTH'</span><span class="p">]]))</span>
</code></pre></div>
<p>First of all, we need to import the Python module and create an instance for reading the output file
<code class="docutils literal notranslate">QuadrupoleTrapSimulation.root</code>. The data we’re interested in is located in the <code class="docutils literal notranslate">component_step_cell</code> tree.
As we will see later, the <code class="docutils literal notranslate">component_step_cell_PRESENCE</code> tree is important in this example because it defines the
step entries that contain valid data (i.e. where the output was filled by the simulation, according to the definition
in the configuration file.) Because we’re only interested in a single output field <code class="docutils literal notranslate">orbital_magnetic_moment</code>, we
can select it before accessing any data in order to reduce memory footprint.</p>
<p>Our analysis requires to compute the magnetic moment deviation for each single track. This requires to consider the
relation between step and track data. One method which is used here is to use the <code class="docutils literal notranslate">(FIRST|LAST)_STEP_INDEX</code> field of
the track structure to select the first and last step index which belongs to a given track. However, because
not all of these steps will contain data in this case, some further adjustment is required: We also check the contents
of the <code class="docutils literal notranslate">component_step_cell_PRESENCE</code> tree from above, and see if the first step index needs to be moved ahead to
the first valid data point. Similarly, we check if the last step index needs to be moved back.</p>
<div class="highlight">
<div class="code-header">
<span class="code-lang">python</span>
<button aria-label="Copy this code" class="copy tooltipped tooltipped-nw"><svg aria-hidden="true" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/xvg"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button>
</div>
<pre><code><span class="k">for</span> <span class="n">first_step_index</span><span class="p">,</span> <span class="n">last_step_index</span> <span class="ow">in</span> <span class="n">track_step_index</span><span class="p">:</span>

    <span class="n">max_moment</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">min_moment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">reader</span><span class="p">):</span>
        <span class="n">step_index</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">iev</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">step_index</span> <span class="o">&lt;</span> <span class="n">first_step_index</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="k">for</span> <span class="n">first_valid</span><span class="p">,</span><span class="n">valid_length</span> <span class="ow">in</span> <span class="n">step_valid</span><span class="p">:</span>

            <span class="n">last_valid</span> <span class="o">=</span> <span class="n">first_valid</span> <span class="o">+</span> <span class="n">valid_length</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">step_index</span> <span class="o">&gt;=</span> <span class="n">first_valid</span> <span class="ow">and</span> <span class="n">step_index</span> <span class="o">&lt;=</span> <span class="n">last_valid</span><span class="p">:</span>

                <span class="n">moment</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">orbital_magnetic_moment</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">moment</span> <span class="o">&gt;</span> <span class="n">max_moment</span><span class="p">:</span>
                    <span class="n">max_moment</span> <span class="o">=</span> <span class="n">moment</span>
                <span class="k">if</span> <span class="n">moment</span> <span class="o">&lt;</span> <span class="n">min_moment</span><span class="p">:</span>
                    <span class="n">min_moment</span> <span class="o">=</span> <span class="n">moment</span>

            <span class="k">if</span> <span class="n">first_valid</span> <span class="o">&gt;</span> <span class="n">first_step_index</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">step_index</span> <span class="o">&gt;=</span> <span class="n">last_step_index</span><span class="p">:</span>
             <span class="k">break</span>

    <span class="n">deviation</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_moment</span> <span class="o">-</span> <span class="n">min_moment</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">max_moment</span> <span class="o">+</span> <span class="n">min_moment</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"extrema for track &lt;</span><span class="si">{:g}</span><span class="s2">&gt;"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">deviation</span><span class="p">))</span>
</code></pre></div>
<p>With this information, the step iterator can be advanced to the first step before starting the data processing. It is
then very straightforward to iterate over the range of steps beloging to the current track by advancing the step
iterator accordingly. In this example we retrieve the value <code class="docutils literal notranslate">orbital_magnetic_moment</code> for each step, determine
its minimum/maximum over the entire track, and then calculate and print a mean deviation.</p>
<p>All output values should be in agreement with the C++ program.</p>
</section>
<section id="uproot-pandas">
<h3>uproot / Pandas<a aria-label="Copy link to section: uproot / Pandas." class="headerlink tooltipped tooltipped-ne" href="#uproot-pandas" role="button"><svg pointer-events="none" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h3>
<p>The same result can be achieved by using the <a class="reference external" href="https://pypi.org/project/uproot/">uproot<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a> package with <a class="reference external" href="https://pandas.pydata.org/">Pandas<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a> dataframes. In this case, PyROOT isn’t needed
and the analysis can run without <a class="reference external" href="https://root.cern.ch/">ROOT<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a> dependencies. Applying the knowledge about <em>Kassiopeia’s</em> output structure
that we gathered in the section above, we can write the following snippet:</p>
<div class="highlight">
<div class="code-header">
<span class="code-lang">python</span>
<button aria-label="Copy this code" class="copy tooltipped tooltipped-nw"><svg aria-hidden="true" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/xvg"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button>
</div>
<pre><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">uproot</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">uproot</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>

<span class="n">df0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">'TRACK_DATA'</span><span class="p">]</span><span class="o">.</span><span class="n">pandas</span><span class="o">.</span><span class="n">df</span><span class="p">()</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">'component_step_cell_PRESENCE'</span><span class="p">]</span><span class="o">.</span><span class="n">pandas</span><span class="o">.</span><span class="n">df</span><span class="p">()</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">'component_step_cell_DATA'</span><span class="p">]</span><span class="o">.</span><span class="n">pandas</span><span class="o">.</span><span class="n">df</span><span class="p">()</span>

<span class="k">for</span> <span class="n">first_step_index</span><span class="p">,</span> <span class="n">last_step_index</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df0</span><span class="p">[</span><span class="s1">'FIRST_STEP_INDEX'</span><span class="p">],</span> <span class="n">df0</span><span class="p">[</span><span class="s1">'LAST_STEP_INDEX'</span><span class="p">]):</span>

    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">'orbital_magnetic_moment'</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">first_valid</span><span class="p">,</span> <span class="n">valid_length</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="s1">'INDEX'</span><span class="p">],</span> <span class="n">df1</span><span class="p">[</span><span class="s1">'LENGTH'</span><span class="p">]):</span>

        <span class="n">last_valid</span> <span class="o">=</span> <span class="n">first_valid</span> <span class="o">+</span> <span class="n">valid_length</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">first_valid</span> <span class="o">&gt;=</span> <span class="n">first_step_index</span> <span class="ow">and</span> <span class="n">last_valid</span> <span class="o">&lt;=</span> <span class="n">last_step_index</span><span class="p">:</span>
            <span class="n">mask</span><span class="p">[</span><span class="n">first_valid</span><span class="p">:</span><span class="n">last_valid</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">first_valid</span> <span class="o">&gt;</span> <span class="n">last_step_index</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="n">steps_moment</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s1">'orbital_magnetic_moment'</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span>
    <span class="n">max_moment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">steps_moment</span><span class="p">)</span>
    <span class="n">min_moment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">steps_moment</span><span class="p">)</span>

    <span class="n">deviation</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_moment</span> <span class="o">-</span> <span class="n">min_moment</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">max_moment</span> <span class="o">+</span> <span class="n">min_moment</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"extrema for track &lt;</span><span class="si">{:g}</span><span class="s2">&gt;"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">deviation</span><span class="p">))</span>
</code></pre></div>
<p>Here the output file is opened with <code class="docutils literal notranslate">uproot.open()</code> and the relevant data trees are accessed via the <code class="docutils literal notranslate">pandas.df()</code>
interface. This is a pretty efficient way of accessing and iterating over the output fields. For our analysis, we loop
over the tracks in the <code class="docutils literal notranslate">TRACK_DATA</code> tree, select the valid step range (with the same caveat noted above), and simply
use <a class="reference external" href="https://numpy.org/">NumPy<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a>’s methods to determine the minimum/maximum of the magnetic moment.</p>
<p>Obviously this code is more compact than the <em>KassiopeiaReader</em> method from above. For large output files with many
steps, it is also much faster. The main convenience arises from using dataframes to represent the data, which allows
slicing of data segments, instead of using a step-by-step iterative approach.</p>
<p>The example above could be easily extended to allow multiple valid segments per track (using the <cite>PRESENCE</cite> tree) and
for other relations between runs, events, tracks, and steps. Consider for example a simulation where secondary particles
are produced over the course of a track, which need to be mapped to the primary event.</p>
</section>
</section>
<section id="vtk-output-files">
<h2>VTK output files<a aria-label="Copy link to section: VTK output files." class="headerlink tooltipped tooltipped-ne" href="#vtk-output-files" role="button"><svg pointer-events="none" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>The <a class="reference external" href="http://www.vtk.org/">VTK<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a> output format can be used in addition to the standard format and is mainly intended for visualization purposes.
The most flexible way to visualize simulation output is by using the <a class="reference external" href="http://www.paraview.org/">ParaView<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a> software, which can import the output
files created by <em>Kassiopeia</em>. The VTK format supports flexible configuration and can be set up independently of the
ROOT output. The VTK writer creates indepdendent files at the track and step level, which typically hold the position
as the main data field (required for 3D visualization), and any number of additional data fields.</p>
<section id="id13">
<h3>Data structure<a aria-label="Copy link to section: Data structure." class="headerlink tooltipped tooltipped-ne" href="#id13" role="button"><svg pointer-events="none" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h3>
<p>In the output file, several tree structures are present that open into a list of leafs, corresponding to the simulation
data. Here is an example view in <a class="reference external" href="http://www.paraview.org/">ParaView<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a>:</p>
<a class="reference internal image-reference" href="_images/paraview_sheet.png"><img alt="_images/paraview_sheet.png" src="_images/paraview_sheet.png" style="width: 500pt;"/></a>
<p>In this example, the step and track output only contains one data field in addition to the particle position. For the
step output, the file contains the fields of <cite>component_step_world</cite> and the position at each point. Each point
corresponds to one step in the simulation. As with the ROOT output, the step data itself is continuous and not split
into individual tracks. However, because the 3D representation of the steps is stored as a <code class="docutils literal notranslate">vtkPolyLine</code>, the
visualization can dinstignuish between individual tracks: Each track in the simulation corresponds to a polyline in the
VTK step file.</p>
</section>
</section>
<section id="id14">
<h2>Accessing simulation data<a aria-label="Copy link to section: Accessing simulation data." class="headerlink tooltipped tooltipped-ne" href="#id14" role="button"><svg pointer-events="none" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>Because the <a class="reference external" href="http://www.vtk.org/">VTK<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a> output is mainly intended for visualization, we will only cover the use of the standard software
<a class="reference external" href="http://www.paraview.org/">ParaView<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a> in this guide. In principle, VTK data files can also be used to store and access simulation output (and e.g.
read their contents using Python), but this approach is less flexible than with <a class="reference external" href="https://root.cern.ch/">ROOT<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a> output and not advised.</p>
<section id="using-paraview">
<h3>Using ParaView<a aria-label="Copy link to section: Using ParaView." class="headerlink tooltipped tooltipped-ne" href="#using-paraview" role="button"><svg pointer-events="none" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h3>
<p>ParaView offers a quite sophisticated interface for various kinds of visualization. With the output files generated
by the quadrupole trap simulation, one may reproduce the following image by loading the VTK step file
(<code class="docutils literal notranslate">output/Kassiopeia/QuadrupoleTrapSimulationStep.vtp</code>) and the geometry file created by the <cite>geometry_painter</cite> after
the simulation (<code class="docutils literal notranslate">output/TheBag/geometry_painter.vtp</code>):</p>
<a class="reference internal image-reference" href="_images/paraview_render.png"><img alt="_images/paraview_render.png" src="_images/paraview_render.png" style="width: 500pt;"/></a>
<p>The geometry is shown as colored surfaces according to the configuration in the XML file; the colors are defined by the
<code class="docutils literal notranslate">&lt;appearance .../&gt;</code> elements. To make the tracks visible, the <em>Slice</em> operation was applied which cuts away one side
of the close surfaces, and the opacity was recuced to 50%. The individual steps are shown as points and colored by
their electric potential.</p>
<p>ParaView allows to change the data represenation by choosing different color maps and normalization, applying cuts and
other data operations, and combining multiple source files. In addition to 2D and 3D render views, the user can also
investigate the underlying data with typical plotting tools like shown here:</p>
<a class="reference internal image-reference" href="_images/paraview_histogram.png"><img alt="_images/paraview_histogram.png" src="_images/paraview_histogram.png" style="width: 500pt;"/></a>
<p>For a full documentation, see:</p>
<blockquote>
<div><p><a class="reference external" href="https://www.paraview.org/Wiki/The_ParaView_Tutorial">https://www.paraview.org/Wiki/The_ParaView_Tutorial<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a></p>
<p><a class="reference external" href="https://docs.paraview.org/en/latest/">https://docs.paraview.org/en/latest/<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a></p>
</div></blockquote>
</section>
</section>
<section id="ascii-output-files">
<h2>ASCII output files<a aria-label="Copy link to section: ASCII output files." class="headerlink tooltipped tooltipped-ne" href="#ascii-output-files" role="button"><svg pointer-events="none" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>The ASCII output writer creates a simple, space-separated file that contains all the output values defined in the
configuration file. Each row corresponds to one step and each column to one output field. A new file is created
for each track, with the label <code class="docutils literal notranslate">Track#.txt</code> added to the configured output file name. This format is useful for
working with plotting tools such as <a class="reference external" href="http://www.gnuplot.info/">Gnuplot<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a>, or for importing or comparing the output to other applications.</p>
<p>A typical output file looks like this:</p>
<div class="highlight">
<div class="code-header">
<span class="code-lang"></span>
<button aria-label="Copy this code" class="copy tooltipped tooltipped-nw"><svg aria-hidden="true" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/xvg"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button>
</div>
<pre><code>step_id     continuous_time continuous_length       time    position_x      position_y      position_z
0   3.79467e-13     3.18284e-07     3.79467e-13     -0.000395068    -0.000194398    -0.0025
1   3.79467e-13     3.18288e-07     7.58933e-13     -0.000395383    -0.000194364    -0.0025
2   3.79467e-13     3.18292e-07     1.1384e-12      -0.000395686    -0.000194452    -0.0025
3   3.79467e-13     3.18297e-07     1.51787e-12     -0.000395933    -0.00019465     -0.0025
4   3.79467e-13     3.18301e-07     1.89733e-12     -0.000396085    -0.000194928    -0.0025
5   3.79467e-13     3.18305e-07     2.2768e-12      -0.000396119    -0.000195242    -0.0025
</code></pre></div>
<p>However, because the storage is rather inefficient it should not be used for large-scale simulations. File sizes on
the order of several Gigabytes can be easily produced by a typical Monte-Carlo simulation!</p>
</section>
</section>
<section class="flex justify-between pt-4 mt-12">
<div class="mr-auto">
<span class="uppercase text-sm font-medium text-gray-600 tracking-wider block mb-2">Previous</span>
<a class="block text-blue-700 hover:text-pink-600 focus:text-pink-600 hover:underline focus:underline" href="kgeobag_complex.html" title="Go to previous page">← Complex Shapes in KGeoBag</a>
</div>
<div class="ml-auto">
<span class="uppercase text-sm font-medium text-gray-600 tracking-wider block mb-2 text-right">Next</span>
<a class="block text-blue-700 hover:text-pink-600 focus:text-pink-600 hover:underline focus:underline" href="tools.html" title="Go to next page">Additional Simulation Tools →</a>
</div>
</section>
</main>
<footer class="mt-20 px-5 md:ml-fluid mb-4 flex-shrink-0 text-sm text-gray-700" role="contentinfo">© Copyright 2021, The Kassiopeia developers. Made with <a href="https://www.sphinx-doc.org">Sphinx 3.4.3</a></footer>
</div>
<div class="sticky bottom-0 md:hidden print:hidden bg-white">
<div class="flex justify-center items-center">
<button aria-labelledby="menuLabel" class="text-3xl p-4 flex items-center focus:bg-gray-200" id="openNavBtn">
<svg aria-hidden="true" class="fill-current h-8 w-8" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg>
<span class="pl-2 text-sm font-medium uppercase tracking-wide text-gray-700" id="menuLabel">Menu</span>
</button><button aria-labelledby="searchLabel" class="text-3xl p-4 flex items-center focus:bg-gray-200" id="openSearchBtn">
<svg aria-hidden="true" class="fill-current h-8 w-8" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg>
<span class="pl-2 text-sm font-medium uppercase tracking-wide text-gray-700" id="searchLabel">Search</span>
</button>
</div>
</div>
<div class="w-full fixed bottom-0 left-0 z-10 bg-gray-900 overflow-x-hidden pt-10 flex flex-col items-center md:hidden" data-menu="closed" id="search-pane">
<h4 class="text-xl text-white mb-4" id="search-label">Enter search term</h4><form action="search.html" class="flex w-full justify-between items-center max-w-sm px-12" id="searchbox" method="get">
<input aria-labelledby="search-label" class="p-2 flex-1" name="q" placeholder="Search the docs" type="search"/>
<button aria-label="Get search results" class="p-2 text-white bg-gray-700 hover:bg-gray-200 hover:text-pink-500 focus:bg-gray-200 focus:text-pink-500 tooltipped tooltipped-sw">
<svg aria-hidden="true" class="fill-current stroke-current h-6 w-6" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg>
</button>
</form>
<button aria-label="Close menu" class="text-4xl text-gray-200 p-4 bottom-0 hover:text-pink-500 md:hidden focus:text-pink-500 self-center" id="closeSearchBtn" title="Close menu">
<svg aria-hidden="true" class="fill-current stroke-current h-6 w-6" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</div>
<div class="fixed bottom-0 right-0 opacity-0 p-4 m-4 bg-gray-900 text-gray-100 transition transform duration-500 translate-y-full" id="snackbar"></div>
<div class="fixed inset-0 bg-black bg-opacity-50" id="screen" style="display: none;"></div>
</div>
<script data-url_root="./" id="documentation_options" src="_static/documentation_options.js">
</script>
<script src="_static/jquery.js"></script>
<script src="_static/underscore.js"></script>
<script src="_static/doctools.js"></script>
<script defer="" src="_static/theme.js"></script>
</body>
</html>